{"version":3,"sources":["data/branch.ts","util/color.ts","data/item.ts","data/action.ts","data/split.ts","data/compress.ts","data/storage.ts","data/delta.ts","components/ExpandButton.tsx","store/routing/selectors.ts","components/action/ActionSummary.tsx","store/application/selectors.ts","data/limit.ts","store/routing/reducers.ts","store/application/reducers.ts","store/store.ts","store/initial.ts","store/setting/reducers.ts","store/routing/actions.ts","store/application/actions.ts","util/benchmark.ts","components/split/Split.tsx","components/split/SplitList.tsx","components/branch/Branch.tsx","components/branch/BranchList.tsx","components/Layout.tsx","sections/SideNav.tsx","store/setting/selectors.ts","store/setting/actions.ts","sections/Header.tsx","sections/Footer.tsx","components/action/DeltaList.tsx","components/action/ActionItem.tsx","components/action/ActionList.tsx","sections/Actions.tsx","dialog/Alert.tsx","components/item/ItemEdit.tsx","components/item/ItemDisplay.tsx","components/item/ItemList.tsx","sections/Items.tsx","data/resource.ts","data/autosave.ts","dialog/IODialog.tsx","sections/Help.tsx","App.tsx","index.tsx"],"names":["newBranch","name","expanded","splits","deflateRouteBranch","branch","map","deflateRouteSplit","inflateBranchData","inflateSplitData","compressBranch","itemNameToIndex","nameEncoded","encodeLengthPrepended","splitsEncoded","encodeArray","split","compressSplit","decompressBranch","compressedString","currentIndex","itemNames","decodeLengthPrepended","indexAfterName","nameError","decodeArray","str","idx","decompressSplit","indexAfterSplits","splitsError","linerize","c","randomColor","hex","r1","Math","floor","random","r2","g1","g2","b1","b2","getForegroundAndBackground","background","htmlColor","window","getComputedStyle","div","document","getElementById","style","color","computed","replace","i","Number","trim","htmlColorToRGB","r","g","b","shouldMakeTextWhiteForRGB","newItem","deflateRouteItem","item","inflateItemData","compressItem","colorEncoded","decompressItem","indexAfterColor","newAction","deltaString","deltaError","deltas","cloneAction","action","stringToDelta","deflateRouteAction","inflateActionData","compressAction","deltaStringEncoded","error","hasError","hasErrorEncoded","encodeBoolean","deltaToCompressedString","decompressAction","decodeBoolean","indexAfterHasError","hasErrorError","deltaStringRaw","indexAfterDeltaString","deltaStringError","compressedStringToDelta","deltaDecompressError","deltaToString","newSplit","actions","cloneSplit","actionsEncoded","indexAfterActions","actionsError","compressState","state","deflateRouteState","projectName","branches","items","projectNameEncoded","forEach","index","branchesEncoded","itemsEncoded","decompressState","compressedStateString","indexAfterProjectName","projectNameError","indexAfterItems","itemsError","indexAfterBranches","branchesError","length","data","inflateRouteData","lengthPrependedString","indexOf","len","substring","isInteger","val","array","encoder","join","decoder","element","nextIndex","push","deflateCompressedState","zlib","deflateSync","toString","inflateEncodedState","stateEncoded","inflateSync","Buffer","from","KEY","SETTING_KEY","activeBranch","activeSplit","activeAction","newEmptyRouteState","exportAsEncoded","exportAsJson","JSON","stringify","importAsEncoded","compressed","importAsJson","parse","storeToLocalStorage","settings","exportAsCompressed","localStorage","setItem","saveSettings","downloadToFile","extension","blob","Blob","type","a","createElement","fileName","download","href","URL","createObjectURL","dataset","downloadurl","display","body","appendChild","click","removeChild","setTimeout","revokeObjectURL","loadfromLocalStorage","getItem","settingsString","console","undefined","readFromFile","file","callback","reader","FileReader","onloadend","result","readAsText","deleteItemInDelta","deleteName","startsWith","value","renameItemInDelta","oldName","newName","itemToString","e","deltaObj","errors","nameEnd","op","endsWith","parseRefItem","parseValueItem","stringToItem","itemError","typeToOperator","processedValue","quantity","itemMap","itemToCompressedString","inverseItemMap","indexEnd","indexNum","ref","refIndex","refIndexNum","compressedStringToItem","num","ExpandButton","setExpanded","className","onClick","getRouteState","routeState","getProjectName","getActiveBranch","getActiveSplit","getActiveRouteSplit","s","getSplit","getActiveSplitName","getActiveSplitActions","getActiveSplitActionCount","getActiveSplitAction","actionIndex","getActiveSplitActionName","isActiveSplitActionExpanded","getActiveSplitActionDeltaString","getActiveSplitActionDeltaError","getActiveSplitActionDeltas","getActiveAction","getActiveActionName","getBranches","getBranch","branchIndex","getBranchCount","getBranchName","isBranchExpanded","getSplits","splitIndex","getSplitCount","getSplitName","isSplitExpanded","getActions","getAction","getActionCount","isActionNote","getActionName","getActionDeltas","getActionDeltaString","getGlobalActionIndex","splitCount","getTotalActionCount","getItems","getItemColorByName","match","filter","getItemByName","getItemNameByIndex","getItemColorByIndex","getItemCount","mapStateToPropsForActionSummaryItemRender","ownProps","isNote","ActionSummaryItem","connect","displayName","colSpan","connector","nodes","getApplicationState","applicationState","getInfo","info","isResourcesSectionCollapsed","resourcesCollapsed","isHeaderCollapsed","headerCollapsed","isSideSectionCollapsed","sideCollapsed","isEditingNav","editingNav","isEditingActions","editingActions","isEditingItems","editingItems","getSplitClipboard","splitClipboard","getRouteResources","resources","getResourceCalcProgress","progress","getResourceCalcError","getActionResourceByGlobalIndex","globalIndex","content","isOnlyShowingChangedResources","showOnlyChangedResources","isShowingHelp","showHelp","BRANCH_LIMIT","SPLIT_LIMIT","ITEM_LIMIT","validateBranch","branchLength","validateSplit","validateItem","validateAction","parseDeltaString","delta","invalidNames","names","validNames","sort","j","getInvalidItemNamesIn","Object","keys","message","setRouteState","payload","setProjectName","setActiveBranchAndSplit","setActiveAction","createBranch","splice","setBranchName","setBranchExpanded","deleteBranch","swapBranches","temp","mergeNextIntoBranch","oldSplitSize","concat","breakBranchAt","hiSplits","slice","createSplit","templateSplit","setSplitName","setSplitExpanded","deleteSplit","swapSplits","moveFirstSplitToPreviousBranch","movedSplitIndex","moveLastSplitToNextBranch","beforeMoveIndex","pop","createItem","setItemName","setItemColor","swapItems","deleteItem","createAction","routeAction","setActionName","setActionExpanded","setActionDeltaString","deleteAction","swapActions","reparseAllDeltaStrings","changeActiveSplit","current","changed","changeBy","changedBranch","changedSplit","markResourceDirty","currentProgress","setHeaderCollapsed","collapsed","setSideCollapsed","setResourcesCollapsed","setEditingNav","editing","setEditingActions","setEditingItems","setInfo","setSplitClipboard","setResourceContent","setResourceError","markResourceDirtyAt","markResourceDirtyAtSplit","setShowOnlyChangedResources","setShowingHelp","initialState","settingState","autoSave","onlyShowChangedItems","itemFilter","noResources","shrinkSide","createSlice","reducers","routingReducers","applicationReducers","setSettingState","setItemFilter","setAutoSaveEnabled","enabled","store","configureStore","reducer","benchStart","Date","getTime","benchEnd","start","isLastBranch","copiedSplit","splitToCopy","dispatch","bindActionCreators","splitNode","appActions","isLast","isFirstBranch","isFirst","expandButtonCell","handleCreateSplit","showAlert","startTime","title","placeholder","onChange","target","disabled","execute","currentBranchName","nextBranchName","splitNodes","branchCount","branchNode","branchNodes","SplitLayout","direction","base","size","min","max","children","other","Array","isArray","firstStyle","secondStyle","first","second","baseFirst","baseSize","otherSize","height","width","overflow","float","CenterLayout","minWidth","maxWidth","minHeight","maxHeight","heightAfterMin","heightAfterMinMax","widthAfterMin","widthAfterMinMax","paddingVertical","paddingHorizontal","position","top","paddingLeft","BoxLayout","WindowLayout","left","buttonSection","getSettingState","isAutoSaveEnabled","getItemFilter","autoSaveEnabled","projectNameSection","exportButton","showIODialog","saveButton","helpButton","allButtons","text","DeltaItem","foreground","displayValueRef","displayValue","backgroundColor","deltaItems","Fragment","actionNode","expandButton","active","actionNodes","splitName","Alert","alertActions","padding","bottom","right","alertAction","hideAlert","itemCount","useState","renamed","setRenamed","change","filterString","getActiveGlobalIndex","filteredIndices","_","lowerCaseFilter","toLowerCase","indices","itemIndex","includes","getFilteredItemIndices","itemIndices","itemSection","row","activeActionName","total","onlyShowChanging","resourceInfo","id","checked","htmlFor","handle","stopResourceCalcClock","clearInterval","update","getState","currentlyNeedToUpdate","before","resourceBefore","actionCount","getActionIndexFromGlobal","getActionDeltaError","branchName","actionName","resourceError","after","getAmountInBefore","n","oldAmount","newAmount","calculateChange","updateAt","stopAutoSaveClock","save","downloadName","setFile","importFunc","theFile","importer","string","files","Help","mapStateToProps","resourceCollapsed","mapDispatchToProps","App","props","alertContent","showIOAlert","windowWidth","innerWidth","addEventListener","this","updateWindowWidth","bind","storedState","setInterval","setState","removeEventListener","mainWindowLayout","show","headerAndSideSection","renderHeaderAndSide","mainSection","React","Component","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.4bc5d691.chunk.js","sourcesContent":["import { decodeArray, decodeLengthPrepended, encodeArray, encodeLengthPrepended } from \"./compress\";\nimport { SplitData, RouteSplit, deflateRouteSplit, inflateSplitData, compressSplit, decompressSplit } from \"./split\";\nexport type BranchData = {\n\tname: string,\n\tsplits: SplitData[],\n}\nexport type RouteBranch = {\n\tname: string,\n\texpanded: boolean,\n\tsplits: RouteSplit[],\n}\n\nexport function newBranch(): RouteBranch {\n\treturn {\n\t\tname: \"\",\n\t\texpanded: true,\n\t\tsplits: [],\n\t};\n}\n\nexport function deflateRouteBranch(branch: RouteBranch): BranchData {\n\treturn {\n\t\tname: branch.name || \"\",\n\t\tsplits: (branch.splits || []).map(deflateRouteSplit)\n\t};\n}\n\nexport function inflateBranchData(branch: BranchData): RouteBranch {\n\treturn {\n\t\tname: branch.name || \"\",\n\t\texpanded: true,\n\t\tsplits: (branch.splits || []).map(inflateSplitData),\n\t};\n}\n\nexport function compressBranch(branch: BranchData, itemNameToIndex: Record<string, number>): string {\n\tconst { name, splits } = branch;\n\tconst nameEncoded = encodeLengthPrepended(name);\n\tconst splitsEncoded = encodeArray(splits, split => compressSplit(split, itemNameToIndex));\n\treturn `${nameEncoded}${splitsEncoded}`;\n}\n\nexport function decompressBranch(compressedString: string, currentIndex: number, itemNames: string[]): [BranchData, number, string | null] {\n\tconst [name, indexAfterName, nameError] = decodeLengthPrepended(compressedString, currentIndex);\n\tif (nameError !== null) {\n\t\treturn [deflateRouteBranch(newBranch()), -1, `Fail to decompress branch name: ${nameError}`];\n\t}\n\tconst [splits, indexAfterSplits, splitsError] = decodeArray(compressedString, indexAfterName, (str, idx) => decompressSplit(str, idx, itemNames));\n\tif (splitsError !== null) {\n\t\treturn [deflateRouteBranch(newBranch()), -1, `Fail to decompress branch splits: ${splitsError}`];\n\t}\n\tconst branch: BranchData = {\n\t\tname,\n\t\tsplits,\n\t};\n\treturn [branch, indexAfterSplits, null];\n}","function shouldMakeTextWhiteForRGB(r: number, g: number, b: number): boolean {\n\t//https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\n\tconst L = 0.2126 * linerize(r) + 0.7152 * linerize(g) + 0.0722 * linerize(b);\n\treturn L < 1.8;\n}\n\nfunction linerize(c: number): number {\n\tc = c / 255.0;\n\tif (c <= 0.03928) {\n\t\tc = c / 12.92;\n\t} else {\n\t\tc = (c + 0.055) / 1.055 ^ 2.4;\n\t}\n\treturn c;\n}\n\nfunction htmlColorToRGB(htmlColor: string): number[] {\n\t//https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\n\tif (!window.getComputedStyle) {\n\t\treturn [255, 255, 255];\n\t}\n\tconst div = document.getElementById(\"temp\");\n\tif (div == null) {\n\t\treturn [255, 255, 255];\n\t}\n\tdiv.style.color = \"white\";\n\tdiv.style.color = htmlColor;\n\tconst computed = window.getComputedStyle(div).color;\n\tif (computed === \"rgb(255, 255, 255)\") {\n\t\treturn [255, 255, 255];\n\t}\n\tconst rgb = computed.replace(\"rgb(\", \"\").replace(\")\", \"\").split(\",\").map(i => Number(i.trim()));\n\treturn rgb;\n}\n\nexport function randomColor(): string {\n\tconst hex = \"0123456789abcdef\";\n\tconst r1 = hex[Math.floor(Math.random() * 12) + 4];\n\tconst r2 = hex[Math.floor(Math.random() * 4) * 4];\n\tconst g1 = hex[Math.floor(Math.random() * 12) + 4];\n\tconst g2 = hex[Math.floor(Math.random() * 4) * 4];\n\tconst b1 = hex[Math.floor(Math.random() * 12) + 4];\n\tconst b2 = hex[Math.floor(Math.random() * 4) * 4];\n\treturn `#${r1}${r2}${g1}${g2}${b1}${b2}`;\n}\n\nexport function getForegroundAndBackground(background?: string): [string, string] {\n\tif (!background) {\n\t\treturn [\"black\", \"white\"];\n\t}\n\tconst [r, g, b] = htmlColorToRGB(background);\n\tif (r === 255 && g === 255 && b === 255) {\n\t\treturn [\"black\", \"white\"];\n\t}\n\tif (shouldMakeTextWhiteForRGB(r, g, b)) {\n\t\treturn [\"white\", background];\n\t}\n\treturn [\"black\", background];\n}","import { randomColor } from \"util/color\";\nimport { decodeLengthPrepended, encodeLengthPrepended } from \"./compress\";\n\nexport type ItemData = {\n\tname: string,\n\tcolor: string,\n}\n\nexport type RouteItem = {\n\tname: string,\n\tcolor: string,\n}\n\nexport type ItemDelta = {\n\tvalue: number,\n\tchange: number,\n}\n\nexport function newItem(): RouteItem {\n\treturn {\n\t\tname: \"\",\n\t\tcolor: randomColor(),\n\t};\n}\n\nexport function deflateRouteItem(item: RouteItem): ItemData {\n\treturn {\n\t\tname: item.name || \"\",\n\t\tcolor: item.color || \"\",\n\t};\n}\n\nexport function inflateItemData(item: ItemData): RouteItem {\n\treturn {\n\t\tname: item.name || \"\",\n\t\tcolor: item.color || \"\",\n\t};\n}\n\nexport function compressItem(item: ItemData): string {\n\tconst { name, color } = item;\n\tconst nameEncoded = encodeLengthPrepended(name.replace(/:/g, \"_\"));\n\tconst colorEncoded = encodeLengthPrepended(color);\n\treturn `${nameEncoded}${colorEncoded}`;\n}\n\nexport function decompressItem(compressedString: string, currentIndex: number): [ItemData, number, string | null] {\n\tconst [name, indexAfterName, nameError] = decodeLengthPrepended(compressedString, currentIndex);\n\tif (nameError !== null) {\n\t\treturn [newItem(), -1, `Fail to decompress item name: ${nameError}`];\n\t}\n\tconst [color, indexAfterColor, colorError] = decodeLengthPrepended(compressedString, indexAfterName);\n\tif (colorError !== null) {\n\t\treturn [newItem(), -1, `Fail to decompress item color: ${nameError}`];\n\t}\n\tconst item: ItemData = { name, color };\n\treturn [item, indexAfterColor, null];\n}","import { decodeBoolean, decodeLengthPrepended, encodeBoolean, encodeLengthPrepended } from \"./compress\";\nimport { DeltaString, DeltaError, ActionDelta, stringToDelta, deltaToCompressedString, compressedStringToDelta, deltaToString } from \"./delta\";\n\nexport type ActionData = {\n\tname: string,\n\tdeltaString: DeltaString,\n}\n\nexport type RouteAction = {\n\tname: string,\n\texpanded: boolean,\n\tdeltaString: DeltaString,\n\tdeltaError: DeltaError,\n\tdeltas: ActionDelta | null,\n}\n\nexport function newAction(): RouteAction {\n\treturn {\n\t\tname: \"\",\n\t\texpanded: true,\n\t\tdeltaString: \"\",\n\t\tdeltaError: null,\n\t\tdeltas: {},\n\t};\n}\n\nexport function cloneAction(action: RouteAction): RouteAction {\n\tconst [deltas, deltaError] = stringToDelta(action.deltaString);\n\treturn {\n\t\tname: action.name,\n\t\texpanded: action.expanded,\n\t\tdeltaString: action.deltaString,\n\t\tdeltaError,\n\t\tdeltas,\n\t};\n}\n\nexport function deflateRouteAction(action: RouteAction): ActionData {\n\treturn {\n\t\tname: action.name || \"\",\n\t\tdeltaString: action.deltaString || \"\",\n\t};\n}\n\nexport function inflateActionData(action: ActionData): RouteAction {\n\tconst [deltas, deltaError] = stringToDelta(action.deltaString);\n\tconst routeAction = {\n\t\tname: action.name || \"\",\n\t\tdeltaString: action.deltaString || \"\",\n\t\texpanded: true,\n\t\tdeltas,\n\t\tdeltaError,\n\t};\n\treturn routeAction;\n}\n\nexport function compressAction(action: ActionData, itemNameToIndex: Record<string, number>): string {\n\tconst { name, deltaString } = action;\n\tconst nameEncoded = encodeLengthPrepended(name);\n\n\tconst [deltas, error] = stringToDelta(deltaString);\n\tconst hasError = error !== null || deltas === null;\n\tconst hasErrorEncoded = encodeBoolean(hasError);\n\tlet deltaStringEncoded;\n\tif (error !== null || deltas === null) {\n\t\tdeltaStringEncoded = encodeLengthPrepended(deltaString);\n\t} else {\n\t\tdeltaStringEncoded = encodeLengthPrepended(deltaToCompressedString(deltas, itemNameToIndex));\n\t}\n\n\treturn `${nameEncoded}${hasErrorEncoded}${deltaStringEncoded}`;\n}\n\nexport function decompressAction(compressedString: string, currentIndex: number, itemNames: string[]): [ActionData, number, string | null] {\n\tconst [name, indexAfterName, nameError] = decodeLengthPrepended(compressedString, currentIndex);\n\n\tif (nameError !== null) {\n\t\treturn [{ name: \"\", deltaString: \"\" }, -1, `Fail to decompress action name: ${nameError}`];\n\t}\n\tconst [hasError, indexAfterHasError, hasErrorError] = decodeBoolean(compressedString, indexAfterName);\n\tif (hasErrorError !== null) {\n\t\treturn [{ name: \"\", deltaString: \"\" }, -1, `Fail to decompress action delta error: ${hasErrorError}`];\n\t}\n\tconst [deltaStringRaw, indexAfterDeltaString, deltaStringError] = decodeLengthPrepended(compressedString, indexAfterHasError);\n\tif (deltaStringError !== null) {\n\t\treturn [{ name: \"\", deltaString: \"\" }, -1, `Fail to decompress action delta string: ${deltaStringError}`];\n\t}\n\tlet deltaString: string;\n\tif (hasError) {\n\t\tdeltaString = deltaStringRaw;\n\t} else {\n\t\tconst [deltas, deltaDecompressError] = compressedStringToDelta(deltaStringRaw, itemNames);\n\t\tif (deltaDecompressError !== null || deltas === null) {\n\t\t\treturn [{ name: \"\", deltaString: \"\" }, -1, `Fail to decompress action delta: ${deltaDecompressError}`];\n\t\t}\n\t\tdeltaString = deltaToString(deltas);\n\t}\n\n\tconst action: ActionData = { name, deltaString };\n\treturn [action, indexAfterDeltaString, null];\n}","import { ActionData, RouteAction, deflateRouteAction, inflateActionData, cloneAction, compressAction, decompressAction } from \"./action\";\nimport { decodeArray, decodeLengthPrepended, encodeArray, encodeLengthPrepended } from \"./compress\";\n\nexport type SplitData = {\n\tname: string,\n\tactions: ActionData[],\n}\n\nexport type RouteSplit = {\n\tname: string,\n\texpanded: boolean,\n\tactions: RouteAction[],\n}\n\nexport function newSplit(): RouteSplit {\n\treturn {\n\t\tname: \"\",\n\t\texpanded: true,\n\t\tactions: [],\n\t};\n}\n\nexport function cloneSplit(split: RouteSplit): RouteSplit {\n\treturn {\n\t\tname: split.name,\n\t\texpanded: split.expanded,\n\t\tactions: split.actions.map(cloneAction),\n\t};\n}\n\nexport function deflateRouteSplit(split: RouteSplit): SplitData {\n\treturn {\n\t\tname: split.name || \"\",\n\t\tactions: (split.actions || []).map(deflateRouteAction),\n\t};\n}\n\nexport function inflateSplitData(split: SplitData): RouteSplit {\n\treturn {\n\t\tname: split.name || \"\",\n\t\texpanded: false,\n\t\tactions: (split.actions || []).map(inflateActionData),\n\t};\n}\n\nexport function compressSplit(split: SplitData, itemNameToIndex: Record<string, number>): string {\n\tconst { name, actions } = split;\n\tconst nameEncoded = encodeLengthPrepended(name);\n\tconst actionsEncoded = encodeArray(actions, action => compressAction(action, itemNameToIndex));\n\treturn `${nameEncoded}${actionsEncoded}`;\n}\n\nexport function decompressSplit(compressedString: string, currentIndex: number, itemNames: string[]): [SplitData, number, string | null] {\n\tconst [name, indexAfterName, nameError] = decodeLengthPrepended(compressedString, currentIndex);\n\tif (nameError !== null) {\n\t\treturn [deflateRouteSplit(newSplit()), -1, `Fail to decompress split name: ${nameError}`];\n\t}\n\tconst [actions, indexAfterActions, actionsError] = decodeArray(compressedString, indexAfterName, (str, idx) => decompressAction(str, idx, itemNames));\n\tif (actionsError !== null) {\n\t\treturn [deflateRouteSplit(newSplit()), -1, `Fail to decompress split actions: ${actionsError}`];\n\t}\n\n\tconst split: SplitData = {\n\t\tname,\n\t\tactions,\n\t};\n\treturn [split, indexAfterActions, null];\n}\n\nexport function parseCoords(str: string): [number, number, number] | undefined {\n\tconst parts = str.split(\",\").map(s => s.trim());\n\tif (parts.length !== 3) {\n\t\treturn undefined;\n\t}\n\tconst coords = parts.map(i => Number(i));\n\tfor (const coord of coords) {\n\t\tif (!Number.isInteger(coord)) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\treturn [coords[0], coords[1], coords[2]];\n\n}","import { RouteState } from \"store/routing/type\";\nimport { deflateRouteState, inflateRouteData, RouteData } from \"./storage\";\nimport { compressBranch, decompressBranch } from \"./branch\";\nimport { compressItem, decompressItem } from \"./item\";\nimport zlib from \"zlib\";\n\ntype LengthPrependedString = string;\ntype CompressedStateString = string;\n\nexport function compressState(state: RouteState): CompressedStateString {\n\tconst { projectName, branches, items } = deflateRouteState(state);\n\tconst projectNameEncoded = encodeLengthPrepended(projectName);\n\n\tconst itemNameToIndex: Record<string, number> = {};\n\titems.forEach((item, index) => {\n\t\titemNameToIndex[item.name] = index;\n\t});\n\n\tconst branchesEncoded = encodeArray(branches, branch => compressBranch(branch, itemNameToIndex));\n\tconst itemsEncoded = encodeArray(items, compressItem);\n\treturn `${projectNameEncoded}${itemsEncoded}${branchesEncoded}`;\n}\n\nexport function decompressState(compressedStateString: CompressedStateString): [RouteState | null, string | null] {\n\tconst [projectName, indexAfterProjectName, projectNameError] = decodeLengthPrepended(compressedStateString, 0);\n\tif (projectNameError !== null) {\n\t\treturn [null, `Fail to decompress project name: ${projectNameError}`];\n\t}\n\tconst [items, indexAfterItems, itemsError] = decodeArray(compressedStateString, indexAfterProjectName, decompressItem);\n\tif (itemsError !== null) {\n\t\treturn [null, `Fail to decompress project items: ${itemsError}`];\n\t}\n\tconst itemNames = items.map(item => item.name);\n\tconst [branches, indexAfterBranches, branchesError] = decodeArray(compressedStateString, indexAfterItems, (str, idx) => decompressBranch(str, idx, itemNames));\n\tif (branchesError !== null) {\n\t\treturn [null, `Fail to decompress project branches: ${branchesError}`];\n\t}\n\tif (indexAfterBranches !== compressedStateString.length) {\n\t\treturn [null, \"Fail to decompress project: length mismatch\"];\n\t}\n\tconst data: RouteData = {\n\t\tprojectName,\n\t\tbranches,\n\t\titems,\n\t};\n\n\tconst state = inflateRouteData(data);\n\treturn [state, null];\n}\n\nexport function encodeLengthPrepended(str: string): LengthPrependedString {\n\tif (str.length === 0) {\n\t\treturn \":\";\n\t}\n\treturn `${str.length}:${str}`;\n}\n\nexport function decodeLengthPrepended(lengthPrependedString: LengthPrependedString, currentIndex: number): [string, number, string | null] {\n\tconst i = lengthPrependedString.indexOf(\":\", currentIndex);\n\tif (i < currentIndex) {\n\t\treturn [\"null\", -1, \"Fail to decode: length not found\"];\n\t}\n\tif (i === currentIndex) {\n\t\treturn [\"\", i + 1, null];\n\t}\n\tconst len = Number(lengthPrependedString.substring(currentIndex, i));\n\tif (!Number.isInteger(len)) {\n\t\treturn [\"null\", -1, `Fail to decode: invalid length: ${len}`];\n\t}\n\tif (i + len >= lengthPrependedString.length) {\n\t\treturn [\"null\", -1, `Fail to decode: length out of bound: ${len}`];\n\t}\n\tconst decoded = lengthPrependedString.substring(i + 1, i + 1 + len);\n\treturn [decoded, i + len + 1, null];\n}\n\nexport function encodeBoolean(val: boolean): string {\n\treturn val ? \"T\" : \"F\";\n}\n\nexport function decodeBoolean(str: string, currentIndex: number): [boolean, number, string | null] {\n\tif (currentIndex < 0 || currentIndex >= str.length) {\n\t\treturn [false, -1, \"Fail to decode: index out of bound\"];\n\t}\n\tif (str[currentIndex] === \"T\") {\n\t\treturn [true, currentIndex + 1, null];\n\t}\n\tif (str[currentIndex] === \"F\") {\n\t\treturn [false, currentIndex + 1, null];\n\t}\n\treturn [false, -1, `Fail to decode: invalid boolean: ${str[currentIndex]}`];\n}\n\nexport function encodeArray<T>(array: T[], encoder: (element: T) => string): string {\n\treturn `[${array.map(encoder).join(\"\")}]`;\n}\n\nexport function decodeArray<T>(compressedString: string, currentIndex: number, decoder: (str: string, idx: number) => [T, number, string | null]): [T[], number, string | null] {\n\tif (currentIndex < 0 || currentIndex >= compressedString.length) {\n\t\treturn [[], -1, \"Fail to decode array: index out of bound\"];\n\t}\n\tif (compressedString[currentIndex] !== \"[\") {\n\t\treturn [[], -1, \"Fail to decode array: invalid array\"];\n\t}\n\tconst array: T[] = [];\n\tcurrentIndex++;\n\twhile (currentIndex < compressedString.length && compressedString[currentIndex] !== \"]\") {\n\t\tconst [element, nextIndex, error] = decoder(compressedString, currentIndex);\n\t\tif (error !== null) {\n\t\t\treturn [[], -1, `Fail to decode array at element ${array.length}: ${error}`];\n\t\t}\n\t\tcurrentIndex = nextIndex;\n\t\tarray.push(element);\n\t}\n\tif (currentIndex >= compressedString.length) {\n\t\treturn [[], -1, \"Fail to decode array: array not properly closed\"];\n\t}\n\treturn [array, currentIndex + 1, null];\n}\n\ntype EncodedStateString = string;\n\nexport function deflateCompressedState(compressedStateString: CompressedStateString): EncodedStateString {\n\treturn zlib.deflateSync(compressedStateString).toString(\"base64\");\n}\nexport function inflateEncodedState(stateEncoded: EncodedStateString): CompressedStateString {\n\treturn zlib.inflateSync(Buffer.from(stateEncoded, \"base64\")).toString();\n}\n\n","import { BranchData, deflateRouteBranch, inflateBranchData } from \"./branch\";\nimport { ItemData, deflateRouteItem, inflateItemData } from \"./item\";\nimport { RouteState } from \"store/routing/type\";\nimport { compressState, decompressState, deflateCompressedState, inflateEncodedState } from \"./compress\";\nimport { SettingState } from \"store/setting/type\";\nexport type RouteData = {\n\tprojectName: string,\n\tbranches: BranchData[],\n\titems: ItemData[],\n}\n\nconst OLD_KEYS = [\"RRT_STATE_v1\"];\nconst KEY = \"RRT_COMPRESS_STATE\";\nconst SETTING_KEY = \"RRT_SETTINGS\";\n\nexport function deflateRouteState(state: RouteState): RouteData {\n\treturn {\n\t\tbranches: (state.branches || []).map(deflateRouteBranch),\n\t\titems: (state.items || []).map(deflateRouteItem),\n\t\tprojectName: state.projectName || \"\",\n\t};\n}\n\nexport function inflateRouteData(data: RouteData): RouteState {\n\treturn {\n\t\tprojectName: data.projectName || \"\",\n\t\tactiveBranch: -1,\n\t\tactiveSplit: -1,\n\t\tactiveAction: -1,\n\t\tbranches: (data.branches || []).map(inflateBranchData),\n\t\titems: (data.items || []).map(inflateItemData),\n\t};\n}\n\nexport function newEmptyRouteState(): RouteState {\n\treturn {\n\t\tprojectName: \"Unnamed Project\",\n\t\tactiveBranch: -1,\n\t\tactiveSplit: -1,\n\t\tactiveAction: -1,\n\t\tbranches: [],\n\t\titems: [],\n\t};\n}\n\nexport function exportAsCompressed(state: RouteState): string {\n\treturn compressState(state);\n}\n\nexport function exportAsEncoded(state: RouteState): string {\n\treturn deflateCompressedState(compressState(state));\n}\n\nexport function exportAsTxt(): string {\n\t//TODO\n\treturn \"\";\n}\n\nexport function exportAsLss(): string {\n\t//TODO\n\treturn \"\";\n}\n\nexport function exportAsJson(state: RouteState): string {\n\treturn JSON.stringify(deflateRouteState(state));\n}\n\nexport function importAsCompressed(str: string): [RouteState | null, string | null] {\n\treturn decompressState(str);\n}\n\nexport function importAsEncoded(str: string): [RouteState | null, string | null] {\n\tconst compressed = inflateEncodedState(str);\n\treturn decompressState(compressed);\n}\n\nexport function importAsJson(str: string): [RouteState | null, string | null] {\n\treturn [inflateRouteData(JSON.parse(str) as RouteData), null];\n}\n\nexport function storeToLocalStorage(state: RouteState, settings: SettingState): void {\n\tconst compressed = exportAsCompressed(state);\n\tlocalStorage.setItem(KEY, compressed);\n\tsaveSettings(settings);\n}\n\nexport function downloadToFile(projectName: string, str: string, extension: string): void {\n\tconst blob = new Blob([str], { type: \"text\" });\n\tconst a = document.createElement(\"a\");\n\tconst fileName = projectName + \".\" + extension;\n\ta.download = fileName;\n\ta.href = URL.createObjectURL(blob);\n\ta.dataset.downloadurl = [\"text\", a.download, a.href].join(\":\");\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n\tsetTimeout(function () { URL.revokeObjectURL(a.href); }, 1500);\n}\n\nexport function clearLocalStorage(): void {\n\tOLD_KEYS.forEach(localStorage.removeItem);\n\tlocalStorage.removeItem(KEY);\n}\n\nexport function loadfromLocalStorage(): [RouteState | undefined, SettingState | undefined] {\n\tconst compressed = localStorage.getItem(KEY);\n\tconst settingsString = localStorage.getItem(SETTING_KEY);\n\tlet settings;\n\tif (settingsString === null) {\n\t\tconsole.error(\"Failed to load settings from localstorage\");\n\t\tsettings = undefined;\n\t} else {\n\t\tsettings = JSON.parse(settingsString);\n\t}\n\tif (compressed === null) {\n\t\tconsole.error(\"Failed to load from localstorage\");\n\t\treturn [undefined, settings];\n\t}\n\tconst [state, error] = importAsCompressed(compressed);\n\tif (error !== null || state === null) {\n\t\tconsole.error(`Failed to load from localstorage: ${error}`);\n\t\treturn [undefined, settings];\n\t}\n\treturn [state, settings];\n}\n\nexport function saveSettings(settings: SettingState): void {\n\tlocalStorage.setItem(SETTING_KEY, JSON.stringify(settings));\n}\n\nexport function readFromFile(file: File, callback: (content: string) => void): void {\n\tif (file) {\n\t\tconst reader = new FileReader();\n\t\treader.onloadend = () => {\n\t\t\tconst str = reader.result;\n\t\t\tcallback(str?.toString() || \"\");\n\t\t};\n\t\treader.readAsText(file);\n\t}\n}\n","export type ActionDelta = Record<string, DeltaItem>;\nexport type DeltaItem = {\n\ttype: DeltaType,\n\tvalue: number | string,\n}\nexport type DeltaType = \"add\" | \"set\" | \"ref_set\" | \"ref_add\" | \"ref_sub\";\nexport type DeltaOperator = \"+\" | \"-\" | \"=\" | \"?\";\nexport type DeltaString = string;\nexport type CompressedDeltaString = string;\nexport type DeltaError = string | null;\ntype DeltaItemString = string;\ntype CompressedDeltaItemString = string;\n\nexport function deleteItemInDelta(deltas: ActionDelta, deleteName: string): void {\n\tfor (const name in deltas) {\n\t\tif (deltas[name].type.startsWith(\"ref\")) {\n\t\t\tif (deltas[name].value === deleteName) {\n\t\t\t\tdelete deltas[name];\n\t\t\t}\n\t\t}\n\t}\n\tif (deleteName in deltas) {\n\t\tdelete deltas[deleteName];\n\t}\n}\n\nexport function renameItemInDelta(deltas: ActionDelta, oldName: string, newName: string): void {\n\tfor (const name in deltas) {\n\t\tif (deltas[name].type.startsWith(\"ref\")) {\n\t\t\tif (deltas[name].value === oldName) {\n\t\t\t\tdeltas[name].value = newName;\n\t\t\t}\n\t\t}\n\t}\n\tif (oldName in deltas) {\n\t\tdeltas[newName] = deltas[oldName];\n\t\tdelete deltas[oldName];\n\t}\n}\n\nexport function deltaToString(deltas: ActionDelta): DeltaString {\n\tconst array = [];\n\tfor (const name in deltas) {\n\t\tarray.push(itemToString(name, deltas[name]));\n\t}\n\treturn array.join(\", \");\n}\n\nexport function stringToDelta(str: DeltaString): [ActionDelta | null, DeltaError] {\n\tif (!str || !str.length) {\n\t\treturn [{}, null];\n\t}\n\tif (!str.trim()) {\n\t\treturn [{}, null];\n\t}\n\n\tconst array = str.split(\",\").map(e => e.trim());\n\tconst deltaObj: ActionDelta = {};\n\tconst errors: string[] = [];\n\tarray.forEach(str => {\n\t\tconst [item, itemError] = stringToItem(str.trim() as DeltaItemString);\n\t\tif (item !== null) {\n\t\t\tif (item.name in deltaObj) {\n\t\t\t\terrors.push(`Duplicate: ${item.name}`);\n\t\t\t} else {\n\t\t\t\tdeltaObj[item.name] = {\n\t\t\t\t\ttype: item.type,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t};\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (itemError !== null) {\n\t\t\t\terrors.push(itemError);\n\t\t\t}\n\t\t}\n\t});\n\treturn errors.length > 0 ? [null, errors.join(\"; \")] : [deltaObj, null];\n}\n\nfunction itemToString(name: string, item: DeltaItem): DeltaItemString {\n\tconst { type, value } = item;\n\tconst [op, processedValue] = typeToOperator(type, value);\n\tlet quantity = processedValue;\n\tif (type.startsWith(\"ref\")) {\n\t\tquantity = `[${processedValue}]`;\n\t}\n\treturn `[${name}]${op}${quantity}`;\n}\n\nfunction stringToItem(str: DeltaItemString): [(DeltaItem & { name: string }) | null, DeltaError] {\n\t//\\[*?<name>](+|=|-)<quantity>\n\tif (!str || !str.length) {\n\t\treturn [null, null];//no item, skip\n\t}\n\tif (!str.startsWith(\"[\")) {\n\t\treturn [null, `Invalid: ${str}`];\n\t}\n\tconst nameEnd = str.indexOf(\"]\");\n\tif (nameEnd < 0) {\n\t\treturn [null, `Item name bracket not closed: ${str}`];\n\t}\n\tconst name = str.substring(1, nameEnd);\n\tif (str.length <= nameEnd + 1) {\n\t\treturn [null, `Item [${name}] missing operator and quantity`];\n\t}\n\tconst op = str[nameEnd + 1];\n\tconst value = str.substring(nameEnd + 2);\n\tif (value.length === 0) {\n\t\treturn [null, `Item [${name}] has empty value`];\n\t}\n\tif (value.startsWith(\"[\")) {\n\t\tif (!value.endsWith(\"]\")) {\n\t\t\treturn [null, `Item reference bracket not closed: ${value}`];\n\t\t}\n\t\tconst ref = value.substring(1, value.length - 1);\n\t\treturn parseRefItem(name, op as DeltaOperator, ref);\n\t} else {\n\t\treturn parseValueItem(name, op as DeltaOperator, value);\n\t}\n}\n\nexport function deltaToCompressedString(deltas: ActionDelta, itemMap: Record<string, number>): CompressedDeltaString {\n\tconst array = [];\n\tfor (const name in deltas) {\n\t\tarray.push(itemToCompressedString(name, itemMap, deltas[name]));\n\t}\n\treturn array.join(\",\");\n}\n\nexport function compressedStringToDelta(str: CompressedDeltaString, inverseItemMap: string[]): [ActionDelta | null, DeltaError] {\n\tif (!str || !str.length) {\n\t\treturn [{}, null];\n\t}\n\tif (!str.trim()) {\n\t\treturn [{}, null];\n\t}\n\n\tconst array = str.split(\",\").map(e => e.trim());\n\tconst deltaObj: ActionDelta = {};\n\tconst errors: string[] = [];\n\tarray.forEach(str => {\n\t\tconst [item, itemError] = compressedStringToItem(str.trim() as CompressedDeltaItemString, inverseItemMap);\n\t\tif (item !== null) {\n\t\t\tdeltaObj[item.name] = {\n\t\t\t\ttype: item.type,\n\t\t\t\tvalue: item.value,\n\t\t\t};\n\t\t} else {\n\t\t\tif (itemError !== null) {\n\t\t\t\terrors.push(itemError);\n\t\t\t}\n\t\t}\n\t});\n\treturn errors.length > 0 ? [null, errors.join(\"; \")] : [deltaObj, null];\n}\n\nfunction itemToCompressedString(name: string, itemMap: Record<string, number>, item: DeltaItem): CompressedDeltaItemString {\n\tconst { type, value } = item;\n\tconst [op, processedValue] = typeToOperator(type, value);\n\tlet quantity = processedValue;\n\tif (type.startsWith(\"ref\")) {\n\t\tif (processedValue in itemMap) {\n\t\t\tquantity = `:${itemMap[processedValue]}`;\n\t\t} else {\n\t\t\tquantity = `:${processedValue}`;\n\t\t}\n\t}\n\tlet ref: string | number = name;\n\tif (name in itemMap) {\n\t\tref = itemMap[name];\n\t} else {\n\t\tref = ref.replace(/:/g, \"\");\n\t}\n\treturn `${ref}:${op}${quantity}`;\n}\n\nfunction compressedStringToItem(str: CompressedDeltaItemString, inverseItemMap: string[]): [(DeltaItem & { name: string }) | null, DeltaError] {\n\tif (!str || !str.length) {\n\t\treturn [null, null];//no item, skip\n\t}\n\tconst indexEnd = str.indexOf(\":\");\n\tif (indexEnd < 0) {\n\t\treturn [null, `Item index not found: ${str}`];\n\t}\n\tconst index = str.substring(0, indexEnd);\n\tif (str.length <= indexEnd + 1) {\n\t\treturn [null, `Item [${index}] missing operator and quantity`];\n\t}\n\tconst indexNum = Number(index);\n\tlet name: string;\n\tif (!Number.isInteger(indexNum)) {\n\t\tname = index;\n\t} else if (indexNum < 0 || indexNum >= inverseItemMap.length) {\n\t\treturn [null, `Invalid index: ${index}`];\n\t} else {\n\t\tname = inverseItemMap[indexNum];\n\t}\n\n\tconst op = str[indexEnd + 1];\n\tconst value = str.substring(indexEnd + 2);\n\tif (value.length === 0) {\n\t\treturn [null, `Item [${name}] has empty value`];\n\t}\n\n\tif (value.startsWith(\":\")) {\n\t\tconst refIndex = value.substring(1);\n\t\tconst refIndexNum = Number(refIndex);\n\t\tlet ref: string;\n\t\tif (!Number.isInteger(refIndexNum)) {\n\t\t\tref = refIndex;\n\t\t} else if (refIndexNum < 0 || refIndexNum >= inverseItemMap.length) {\n\t\t\treturn [null, `Invalid ref index: ${refIndex}`];\n\t\t} else {\n\t\t\tref = inverseItemMap[refIndexNum];\n\t\t}\n\t\treturn parseRefItem(name, op as DeltaOperator, ref);\n\t} else {\n\t\treturn parseValueItem(name, op as DeltaOperator, value);\n\t}\n}\n\nexport function typeToOperator(type: DeltaType, value: string | number): [DeltaOperator, string | number] {\n\tswitch (type) {\n\t\tcase \"add\":\n\t\t\tif (value >= 0) {\n\t\t\t\treturn [\"+\", value];\n\t\t\t} else {\n\t\t\t\treturn [\"-\", -value];\n\t\t\t}\n\t\tcase \"set\":\n\t\tcase \"ref_set\":\n\t\t\treturn [\"=\", value];\n\t\tcase \"ref_add\":\n\t\t\treturn [\"+\", value];\n\t\tcase \"ref_sub\":\n\t\t\treturn [\"-\", value];\n\t\tdefault: return [\"?\", value];\n\t}\n}\n\nfunction parseRefItem(name: string, op: DeltaOperator, value: string): [(DeltaItem & { name: string }) | null, DeltaError] {\n\tlet type: DeltaType;\n\tswitch (op) {\n\t\tcase \"+\": type = \"ref_add\"; break;\n\t\tcase \"-\": type = \"ref_sub\"; break;\n\t\tcase \"=\": type = \"ref_set\"; break;\n\t\tdefault: return [null, `Item [${name}]: unknown operator \"${op}\"`];\n\t}\n\treturn [{\n\t\tname,\n\t\ttype,\n\t\tvalue,\n\t}, null];\n}\n\nfunction parseValueItem(name: string, op: DeltaOperator, value: string): [(DeltaItem & { name: string }) | null, DeltaError] {\n\tlet type: DeltaType;\n\tlet num = Number(value);\n\tif (!Number.isInteger(num)) {\n\t\treturn [null, `Item [${name}]: invalid quantity \"${value}`];\n\t}\n\tswitch (op) {\n\t\tcase \"+\": type = \"add\"; break;\n\t\tcase \"-\": type = \"add\"; num = -num; break;\n\t\tcase \"=\": type = \"set\"; break;\n\t\tdefault: return [null, `Item [${name}]: unknown operator \"${op}\"`];\n\t}\n\treturn [{\n\t\tname,\n\t\ttype,\n\t\tvalue: num,\n\t}, null];\n}","type Props = {\n\texpanded: boolean,\n\tsetExpanded: (expanded: boolean) => void,\n}\n\nconst ExpandButton: React.FunctionComponent<Props> = ({ expanded, setExpanded }: Props) => {\n\treturn (\n\t\t<button className=\"icon-button\" onClick={() => setExpanded(!expanded)}>{expanded ? \"-\" : \"+\"}</button>\n\t);\n};\n\nexport default ExpandButton;","import { RouteAction } from \"data/action\";\nimport { RouteBranch } from \"data/branch\";\nimport { DeltaString, DeltaError, ActionDelta } from \"data/delta\";\nimport { RouteItem } from \"data/item\";\nimport { RouteState } from \"./type\";\nimport { RouteSplit } from \"data/split\";\nimport { ReduxGlobalState } from \"store/store\";\n\nexport function getRouteState(state: ReduxGlobalState): RouteState {\n\treturn state.routeState;\n}\n\nexport function getProjectName(state: ReduxGlobalState): string {\n\treturn getRouteState(state).projectName;\n}\n\nexport function getActiveBranch(state: ReduxGlobalState): number {\n\treturn getRouteState(state).activeBranch;\n}\n\nexport function getActiveSplit(state: ReduxGlobalState): number {\n\treturn getRouteState(state).activeSplit;\n}\n\nexport function getActiveGlobalIndex(state: ReduxGlobalState): number | undefined {\n\tconst branch = getActiveBranch(state);\n\tconst split = getActiveSplit(state);\n\tconst action = getActiveAction(state);\n\tif (branch >= 0 && split >= 0 && action >= 0) {\n\t\treturn getGlobalActionIndex(state, branch, split, action);\n\t}\n\treturn undefined;\n}\n\nfunction getActiveRouteSplit(state: ReduxGlobalState): RouteSplit | undefined {\n\tconst b = getActiveBranch(state);\n\tconst s = getActiveSplit(state);\n\tif (b >= 0 && s >= 0) {\n\t\treturn getSplit(state, b, s);\n\t}\n\treturn undefined;\n}\n\nexport function getActiveSplitName(state: ReduxGlobalState): string | undefined {\n\treturn getActiveRouteSplit(state)?.name;\n}\n\nfunction getActiveSplitActions(state: ReduxGlobalState): RouteAction[] | undefined {\n\treturn getActiveRouteSplit(state)?.actions;\n}\n\nexport function getActiveSplitActionCount(state: ReduxGlobalState): number | undefined {\n\treturn getActiveSplitActions(state)?.length;\n}\n\nfunction getActiveSplitAction(state: ReduxGlobalState, actionIndex: number): RouteAction | undefined {\n\tconst actions = getActiveSplitActions(state);\n\treturn actions === undefined ? undefined : actions[actionIndex];\n}\n\nexport function getActiveSplitActionName(state: ReduxGlobalState, actionIndex: number): string | undefined {\n\treturn getActiveSplitAction(state, actionIndex)?.name;\n}\n\nexport function isActiveSplitActionExpanded(state: ReduxGlobalState, actionIndex: number): boolean | undefined {\n\treturn getActiveSplitAction(state, actionIndex)?.expanded;\n}\n\nexport function getActiveSplitActionDeltaString(state: ReduxGlobalState, actionIndex: number): DeltaString | undefined {\n\treturn getActiveSplitAction(state, actionIndex)?.deltaString;\n}\n\nexport function getActiveSplitActionDeltaError(state: ReduxGlobalState, actionIndex: number): DeltaError | undefined {\n\tconst error = getActiveSplitAction(state, actionIndex)?.deltaError;\n\treturn error ? error : undefined;\n}\n\nexport function getActiveSplitActionDeltas(state: ReduxGlobalState, actionIndex: number): ActionDelta | undefined {\n\tconst deltas = getActiveSplitAction(state, actionIndex)?.deltas;\n\treturn deltas ? deltas : undefined;\n}\n\nexport function getActiveAction(state: ReduxGlobalState): number {\n\treturn getRouteState(state).activeAction;\n}\n\nexport function getActiveActionName(state: ReduxGlobalState): string | undefined {\n\tconst activeAction = getActiveAction(state);\n\tif (activeAction < 0) {\n\t\treturn undefined;\n\t}\n\tconst action = getActiveSplitAction(state, activeAction);\n\treturn action?.name;\n}\n\nfunction getBranches(state: ReduxGlobalState): RouteBranch[] {\n\treturn getRouteState(state).branches;\n}\n\nfunction getBranch(state: ReduxGlobalState, branchIndex: number): RouteBranch {\n\treturn getBranches(state)[branchIndex];\n}\n\nexport function getBranchCount(state: ReduxGlobalState): number {\n\treturn getBranches(state).length;\n}\n\nexport function getBranchName(state: ReduxGlobalState, branchIndex: number): string {\n\treturn getBranch(state, branchIndex).name;\n}\n\nexport function isBranchExpanded(state: ReduxGlobalState, branchIndex: number): boolean {\n\treturn getBranch(state, branchIndex).expanded;\n}\n\nfunction getSplits(state: ReduxGlobalState, branchIndex: number): RouteSplit[] {\n\treturn getBranch(state, branchIndex).splits;\n}\n\nexport function getSplit(state: ReduxGlobalState, branchIndex: number, splitIndex: number): RouteSplit {\n\treturn getSplits(state, branchIndex)[splitIndex];\n}\n\nexport function getSplitCount(state: ReduxGlobalState, branchIndex: number): number {\n\treturn getSplits(state, branchIndex).length;\n}\n\nexport function getSplitName(state: ReduxGlobalState, branchIndex: number, splitIndex: number): string {\n\treturn getSplit(state, branchIndex, splitIndex).name;\n}\n\nexport function isSplitExpanded(state: ReduxGlobalState, branchIndex: number, splitIndex: number): boolean {\n\treturn getSplit(state, branchIndex, splitIndex).expanded;\n}\n\nfunction getActions(state: ReduxGlobalState, branchIndex: number, splitIndex: number): RouteAction[] {\n\treturn getSplit(state, branchIndex, splitIndex).actions;\n}\n\nfunction getAction(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): RouteAction {\n\treturn getActions(state, branchIndex, splitIndex)[actionIndex];\n}\n\nexport function getActionCount(state: ReduxGlobalState, branchIndex: number, splitIndex: number): number {\n\treturn getActions(state, branchIndex, splitIndex).length;\n}\n\nexport function isActionNote(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): boolean {\n\treturn getAction(state, branchIndex, splitIndex, actionIndex).deltaString === \"\";\n}\n\nexport function getActionName(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): string {\n\treturn getAction(state, branchIndex, splitIndex, actionIndex).name;\n}\n\nexport function getActionDeltas(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): ActionDelta | null {\n\treturn getAction(state, branchIndex, splitIndex, actionIndex).deltas;\n}\n\nexport function getActionDeltaError(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): DeltaError {\n\treturn getAction(state, branchIndex, splitIndex, actionIndex).deltaError;\n}\n\nexport function getActionDeltaString(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): string {\n\treturn getAction(state, branchIndex, splitIndex, actionIndex).deltaString;\n}\n\nexport function getGlobalActionIndex(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): number {\n\tlet i = 0;\n\tfor (let b = 0; b < branchIndex; b++) {\n\t\tconst splitCount = getSplitCount(state, b);\n\t\tfor (let s = 0; s < splitCount; s++) {\n\t\t\ti += getActionCount(state, b, s);\n\t\t}\n\t}\n\tfor (let s = 0; s < splitIndex; s++) {\n\t\ti += getActionCount(state, branchIndex, s);\n\t}\n\treturn i + actionIndex;\n}\n\nexport function getTotalActionCount(state: ReduxGlobalState): number {\n\tlet i = 0;\n\tgetBranches(state).forEach(branch => {\n\t\tbranch.splits.forEach(split => {\n\t\t\ti += split.actions.length;\n\t\t});\n\t});\n\treturn i;\n}\n\nexport function getActionIndexFromGlobal(state: ReduxGlobalState, globalIndex: number): [number, number, number] {\n\tlet i = globalIndex;\n\tfor (let b = 0; b < getBranchCount(state); b++) {\n\t\tfor (let s = 0; s < getSplitCount(state, b); s++) {\n\t\t\tconst actionCount = getActionCount(state, b, s);\n\t\t\tif (i < actionCount) {\n\t\t\t\treturn [b, s, i];\n\t\t\t}\n\t\t\ti -= actionCount;\n\t\t}\n\t}\n\treturn [-1, -1, -1];\n}\n\nfunction getItems(state: ReduxGlobalState): RouteItem[] {\n\treturn getRouteState(state).items;\n}\n\nfunction getItemByName(state: ReduxGlobalState, name: string): RouteItem | undefined {\n\tconst match = getItems(state).filter(item => item.name === name);\n\tif (match.length === 0) {\n\t\treturn undefined;\n\t}\n\treturn match[0];\n}\n\nexport function getItemColorByName(state: ReduxGlobalState, name: string): string | undefined {\n\treturn getItemByName(state, name)?.color;\n}\n\nexport function getFilteredItemIndices(state: ReduxGlobalState, filter: string[]): number[] {\n\tif (filter.length === 0) {\n\t\treturn getItems(state).map((_, i) => i);\n\t}\n\tconst lowerCaseFilter = filter.map(s => s.toLowerCase());\n\tconst indices: number[] = [];\n\tgetItems(state).forEach((item, itemIndex) => {\n\t\tfor (let i = 0; i < lowerCaseFilter.length; i++) {\n\t\t\tif (item.name.toLowerCase().includes(lowerCaseFilter[i])) {\n\t\t\t\tindices.push(itemIndex);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\treturn indices;\n}\n\nexport function getItemNameByIndex(state: ReduxGlobalState, i: number): string {\n\treturn getItems(state)[i].name;\n}\n\nexport function getItemColorByIndex(state: ReduxGlobalState, i: number): string {\n\treturn getItems(state)[i].color;\n}\n\nexport function getItemCount(state: ReduxGlobalState): number {\n\treturn getItems(state).length;\n}\n\nexport function getInvalidItemNamesIn(state: ReduxGlobalState, names: string[]): string[] {\n\tconst validNames = getItems(state).map(item => item.name).sort();\n\tnames.sort();\n\tlet i = 0;\n\tlet j = 0;\n\tconst invalidNames = [];\n\twhile (i < validNames.length && j < names.length) {\n\t\tif (names[j] < validNames[i]) {\n\t\t\tinvalidNames.push(names[j]);\n\t\t\tj++;\n\t\t} else if (names[j] > validNames[i]) {\n\t\t\ti++;\n\t\t} else {\n\t\t\ti++;\n\t\t\tj++;\n\t\t}\n\t}\n\tfor (; j < names.length; j++) {\n\t\tinvalidNames.push(names[j]);\n\t}\n\treturn invalidNames;\n}\n\n","import { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tgetActionCount,\n\tgetActionName,\n\tisActionNote\n} from \"store/routing/selectors\";\nimport { ReduxGlobalState } from \"store/store\";\n\ntype RenderExternalProps = {\n\tbranchIndex: number,\n\tsplitIndex: number,\n\tactionIndex: number,\n}\nconst mapStateToPropsForActionSummaryItemRender = (state: ReduxGlobalState, ownProps: RenderExternalProps) => ({\n\tisNote: isActionNote(state, ownProps.branchIndex, ownProps.splitIndex, ownProps.actionIndex),\n\tname: getActionName(state, ownProps.branchIndex, ownProps.splitIndex, ownProps.actionIndex),\n});\n\nconst renderConnector = connect(mapStateToPropsForActionSummaryItemRender);\n\ntype RenderProps = ConnectedProps<typeof renderConnector> & RenderExternalProps;\n\nconst ActionSummaryItemRender: React.FunctionComponent<RenderProps> = ({ isNote, name }: RenderProps) => {\n\tconst displayName = name || \"[Unnamed Action]\";\n\treturn <tr>\n\t\t<td />\n\t\t<td />\n\t\t<td className=\"icon-button-width\" >&gt;</td>\n\t\t<td colSpan={8} >\n\t\t\t{isNote ? <em>{displayName}</em> : displayName}\n\t\t</td>\n\t</tr>;\n};\n\nconst ActionSummaryItem = connect(mapStateToPropsForActionSummaryItemRender)(ActionSummaryItemRender);\n\ntype ExternalProps = {\n\tbranchIndex: number,\n\tsplitIndex: number,\n}\nconst mapStateToProps = (state: ReduxGlobalState, ownProps: ExternalProps) => ({\n\tlength: getActionCount(state, ownProps.branchIndex, ownProps.splitIndex),\n});\n\nconst connector = connect(mapStateToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const ActionSummary: React.FunctionComponent<Props> = ({ length, branchIndex, splitIndex }: Props) => {\n\tconst nodes = [];\n\tfor (let i = 0; i < length; i++) {\n\t\tnodes.push(<ActionSummaryItem\n\t\t\tkey={i}\n\t\t\tbranchIndex={branchIndex}\n\t\t\tsplitIndex={splitIndex}\n\t\t\tactionIndex={i}\n\t\t/>);\n\t}\n\treturn <>{nodes}</>;\n};\n\nexport default connector(ActionSummary);","import { ReduxGlobalState } from \"store/store\";\nimport { ApplicationState } from \"./type\";\nimport { RouteSplit } from \"data/split\";\nimport { ActionResource, ResourceError, RouteResources } from \"data/resource\";\nimport { getGlobalActionIndex } from \"store/routing/selectors\";\n\nfunction getApplicationState(state: ReduxGlobalState): ApplicationState {\n\treturn state.applicationState;\n}\n\nexport function getInfo(state: ReduxGlobalState): string {\n\treturn getApplicationState(state).info;\n}\n\nexport function isSideSectionShrunk(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).shrinkSide;\n}\n\nexport function isResourcesSectionCollapsed(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).resourcesCollapsed;\n}\n\nexport function isHeaderCollapsed(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).headerCollapsed;\n}\n\nexport function isSideSectionCollapsed(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).sideCollapsed;\n}\n\nexport function isEditingNav(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).editingNav;\n}\n\nexport function isEditingActions(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).editingActions;\n}\n\nexport function isEditingItems(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).editingItems;\n}\n\nexport function getSplitClipboard(state: ReduxGlobalState): RouteSplit | undefined {\n\treturn getApplicationState(state).splitClipboard;\n}\n\nfunction getRouteResources(state: ReduxGlobalState): RouteResources {\n\treturn getApplicationState(state).resources;\n}\n\nexport function getResourceCalcProgress(state: ReduxGlobalState): number {\n\treturn getRouteResources(state).progress;\n}\n\nexport function getResourceCalcError(state: ReduxGlobalState): ResourceError {\n\treturn getRouteResources(state).error;\n}\n\nexport function getActionResourceByGlobalIndex(state: ReduxGlobalState, globalIndex: number): ActionResource | undefined {\n\treturn getRouteResources(state).content[globalIndex];\n}\n\nexport function getActionResource(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): ActionResource | undefined {\n\treturn getActionResourceByGlobalIndex(state, getGlobalActionIndex(state, branchIndex, splitIndex, actionIndex));\n}\n\nexport function isOnlyShowingChangedResources(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).showOnlyChangedResources;\n}\n\nexport function isShowingHelp(state: ReduxGlobalState): boolean {\n\treturn getApplicationState(state).showHelp;\n}","export const BRANCH_LIMIT = 64;\nexport const SPLIT_LIMIT = 128;\nexport const ACTION_LIMIT = 32;\nexport const ITEM_LIMIT = 512;","import { PayloadAction } from \"@reduxjs/toolkit\";\nimport { newAction } from \"data/action\";\nimport { newBranch } from \"data/branch\";\nimport { deleteItemInDelta, deltaToString, renameItemInDelta, stringToDelta } from \"data/delta\";\nimport { newItem } from \"data/item\";\nimport { ACTION_LIMIT, BRANCH_LIMIT, ITEM_LIMIT, SPLIT_LIMIT } from \"data/limit\";\nimport { cloneSplit, newSplit, RouteSplit } from \"data/split\";\nimport { ReduxGlobalState } from \"store/store\";\nimport {\n\tgetActionCount,\n\tgetActionDeltas,\n\tgetActionDeltaString,\n\tgetActiveAction,\n\tgetActiveBranch,\n\tgetActiveSplit,\n\tgetBranchCount,\n\tgetInvalidItemNamesIn,\n\tgetItemCount,\n\tgetSplitCount\n} from \"./selectors\";\nimport { RouteState } from \"./type\";\n\nfunction validateBranch(state: ReduxGlobalState, branchIndex: number): boolean {\n\tconst branchLength = getBranchCount(state);\n\treturn branchIndex >= 0 && branchIndex < branchLength;\n}\n\nfunction validateSplit(state: ReduxGlobalState, branchIndex: number, splitIndex: number): boolean {\n\tif (!validateBranch(state, branchIndex)) {\n\t\treturn false;\n\t}\n\treturn splitIndex >= 0 && splitIndex < getSplitCount(state, branchIndex);\n}\n\nfunction validateItem(state: ReduxGlobalState, index: number): boolean {\n\treturn index >= 0 && index < getItemCount(state);\n}\n\nfunction validateAction(state: ReduxGlobalState, branchIndex: number, splitIndex: number, actionIndex: number): boolean {\n\tif (!validateSplit(state, branchIndex, splitIndex)) {\n\t\treturn false;\n\t}\n\treturn actionIndex >= 0 && actionIndex < getActionCount(state, branchIndex, splitIndex);\n}\n\nfunction parseDeltaString(state: ReduxGlobalState, deltaString: string, branchIndex: number, splitIndex: number, actionIndex: number): void {\n\tconst [delta, error] = stringToDelta(deltaString);\n\tif (error) {\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltaError = error;\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltas = null;\n\t} else {\n\t\tif (delta !== null) {\n\t\t\tconst names = Object.keys(delta);\n\t\t\tconst invalidNames = getInvalidItemNamesIn(state, names);\n\t\t\tif (invalidNames.length > 0) {\n\t\t\t\tconst message = `Undefined item(s): ${invalidNames.join(\", \")}`;\n\t\t\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltaError = message;\n\t\t\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltas = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltaError = null;\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltas = delta;\n\t}\n}\n\nexport default {\n\tsetRouteState(state: ReduxGlobalState, action: PayloadAction<{ routeState: RouteState }>): void {\n\t\tstate.routeState = action.payload.routeState;\n\t},\n\tsetProjectName(state: ReduxGlobalState, action: PayloadAction<{ projectName: string }>): void {\n\t\tstate.routeState.projectName = action.payload.projectName;\n\t},\n\tsetActiveBranchAndSplit(state: ReduxGlobalState, action: PayloadAction<{ activeBranch: number, activeSplit: number }>): void {\n\t\tstate.routeState.activeBranch = action.payload.activeBranch;\n\t\tstate.routeState.activeSplit = action.payload.activeSplit;\n\t\tstate.routeState.activeAction = -1;\n\t},\n\tsetActiveAction(state: ReduxGlobalState, action: PayloadAction<{ activeAction: number }>): void {\n\t\tstate.routeState.activeAction = action.payload.activeAction;\n\t},\n\tcreateBranch(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number }>): void {\n\t\tconst { branchIndex } = action.payload;\n\t\tconst branchLength = getBranchCount(state);\n\t\tif (branchLength >= BRANCH_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tconst branch = newBranch();\n\t\tif (!validateBranch(state, branchIndex)) {\n\t\t\tstate.routeState.branches.push(branch);\n\t\t} else {\n\t\t\tstate.routeState.branches.splice(branchIndex, 0, branch);\n\t\t\tconst activeBranch = getActiveBranch(state);\n\t\t\tif (activeBranch >= branchIndex) {\n\t\t\t\tstate.routeState.activeBranch = activeBranch + 1;\n\t\t\t}\n\t\t}\n\t},\n\tsetBranchName(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, name: string }>): void {\n\t\tconst { branchIndex, name } = action.payload;\n\t\tstate.routeState.branches[branchIndex].name = name;\n\t},\n\tsetBranchExpanded(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, expanded: boolean }>): void {\n\t\tconst { branchIndex, expanded } = action.payload;\n\t\tstate.routeState.branches[branchIndex].expanded = expanded;\n\t},\n\tdeleteBranch(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number }>): void {\n\t\tconst { branchIndex } = action.payload;\n\t\tstate.routeState.branches.splice(branchIndex, 1);\n\t\tconst activeBranch = getActiveBranch(state);\n\t\tif (activeBranch === branchIndex) {\n\t\t\tstate.routeState.activeBranch = -1;\n\t\t} else if (activeBranch > branchIndex) {\n\t\t\tstate.routeState.activeBranch = activeBranch - 1;\n\t\t}\n\t},\n\tswapBranches(state: ReduxGlobalState, action: PayloadAction<{ i: number, j: number }>): void {\n\t\tconst { i, j } = action.payload;\n\t\tif (!validateBranch(state, i) || !validateBranch(state, j)) {\n\t\t\treturn;\n\t\t}\n\t\tconst temp = state.routeState.branches[i];\n\t\tstate.routeState.branches[i] = state.routeState.branches[j];\n\t\tstate.routeState.branches[j] = temp;\n\t\tconst activeBranch = getActiveBranch(state);\n\t\tif (activeBranch === i) {\n\t\t\tstate.routeState.activeBranch = j;\n\t\t} else if (activeBranch === j) {\n\t\t\tstate.routeState.activeBranch = i;\n\t\t}\n\t},\n\tmergeNextIntoBranch(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number }>): void {\n\t\tconst { branchIndex } = action.payload;\n\t\tconst branchLength = getBranchCount(state);\n\t\tif (branchIndex === branchLength - 1 || !validateBranch(state, branchIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tconst oldSplitSize = getSplitCount(state, branchIndex);\n\t\tconst nextSplitSize = getSplitCount(state, branchIndex + 1);\n\t\tif (oldSplitSize + nextSplitSize >= SPLIT_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tstate.routeState.branches[branchIndex].splits = state.routeState.branches[branchIndex].splits.concat(state.routeState.branches[branchIndex + 1].splits);\n\t\tstate.routeState.branches.splice(branchIndex + 1, 1);\n\t\tconst activeBranch = getActiveBranch(state);\n\t\tif (activeBranch === branchIndex + 1) {\n\t\t\tstate.routeState.activeBranch = activeBranch - 1;\n\t\t\tstate.routeState.activeSplit += oldSplitSize;\n\t\t}\n\t},\n\tbreakBranchAt(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, splitIndex: number }>): void {\n\t\tconst branchLength = getBranchCount(state);\n\t\tif (branchLength >= BRANCH_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tconst { branchIndex, splitIndex } = action.payload;\n\t\tif (!validateSplit(state, branchIndex, splitIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tconst hiSplits = state.routeState.branches[branchIndex].splits.slice(splitIndex);\n\t\tstate.routeState.branches[branchIndex].splits = state.routeState.branches[branchIndex].splits.slice(0, splitIndex);\n\t\tconst branch = newBranch();\n\t\tbranch.expanded = true;\n\t\tbranch.splits = hiSplits;\n\t\tstate.routeState.branches.splice(branchIndex + 1, 0, branch);\n\t\tconst activeBranch = getActiveBranch(state);\n\t\tconst activeSplit = getActiveSplit(state);\n\t\tif (activeBranch === branchIndex && activeSplit >= splitIndex) {\n\t\t\tstate.routeState.activeBranch = activeBranch + 1;\n\t\t\tstate.routeState.activeSplit -= splitIndex;\n\t\t}\n\t},\n\tcreateSplit(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, splitIndex: number, templateSplit?: RouteSplit }>): void {\n\t\tconst { branchIndex, splitIndex, templateSplit } = action.payload;\n\t\tif (!validateBranch(state, branchIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tconst splitLength = getSplitCount(state, branchIndex);\n\t\tif (splitLength >= SPLIT_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tconst split = templateSplit ? cloneSplit(templateSplit) : newSplit();\n\t\tif (!validateSplit(state, branchIndex, splitIndex)) {\n\t\t\tstate.routeState.branches[branchIndex].splits.push(split);\n\t\t} else {\n\t\t\tstate.routeState.branches[branchIndex].splits.splice(splitIndex, 0, split);\n\t\t\tif (getActiveBranch(state) === branchIndex) {\n\t\t\t\tconst activeSplit = getActiveSplit(state);\n\t\t\t\tif (activeSplit >= splitIndex) {\n\t\t\t\t\tstate.routeState.activeSplit = activeSplit + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tsetSplitName(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, splitIndex: number, name: string }>): void {\n\t\tconst { branchIndex, splitIndex, name } = action.payload;\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].name = name;\n\t},\n\tsetSplitExpanded(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, splitIndex: number, expanded: boolean }>): void {\n\t\tconst { branchIndex, splitIndex, expanded } = action.payload;\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].expanded = expanded;\n\t},\n\tdeleteSplit(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, splitIndex: number }>): void {\n\t\tconst { branchIndex, splitIndex } = action.payload;\n\t\tif (!validateSplit(state, branchIndex, splitIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tstate.routeState.branches[branchIndex].splits.splice(splitIndex, 1);\n\t\tif (getActiveBranch(state) === branchIndex) {\n\t\t\tconst activeSplit = getActiveSplit(state);\n\t\t\tif (activeSplit === splitIndex) {\n\t\t\t\tstate.routeState.activeSplit = -1;\n\t\t\t} else if (activeSplit > splitIndex) {\n\t\t\t\tstate.routeState.activeSplit = activeSplit - 1;\n\t\t\t}\n\t\t}\n\t},\n\tswapSplits(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number, i: number, j: number }>): void {\n\t\tconst { branchIndex, i, j } = action.payload;\n\t\tif (!validateSplit(state, branchIndex, i) || !validateSplit(state, branchIndex, j)) {\n\t\t\treturn;\n\t\t}\n\t\tconst temp = state.routeState.branches[branchIndex].splits[i];\n\t\tstate.routeState.branches[branchIndex].splits[i] = state.routeState.branches[branchIndex].splits[j];\n\t\tstate.routeState.branches[branchIndex].splits[j] = temp;\n\t\tif (getActiveBranch(state) === branchIndex) {\n\t\t\tconst activeSplit = getActiveSplit(state);\n\t\t\tif (activeSplit === i) {\n\t\t\t\tstate.routeState.activeSplit = j;\n\t\t\t} else if (activeSplit === j) {\n\t\t\t\tstate.routeState.activeSplit = i;\n\t\t\t}\n\t\t}\n\t},\n\tmoveFirstSplitToPreviousBranch(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number }>): void {\n\t\tconst { branchIndex } = action.payload;\n\t\tif (!validateBranch(state, branchIndex) || !validateBranch(state, branchIndex - 1)) {\n\t\t\treturn;\n\t\t}\n\t\tif (getSplitCount(state, branchIndex) <= 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst movedSplitIndex = getSplitCount(state, branchIndex - 1);\n\t\tstate.routeState.branches[branchIndex - 1].splits.push(state.routeState.branches[branchIndex].splits[0]);\n\t\tstate.routeState.branches[branchIndex].splits.splice(0, 1);\n\t\tif (getActiveBranch(state) === branchIndex) {\n\t\t\tif (getActiveSplit(state) === 0) {\n\t\t\t\tstate.routeState.activeBranch = branchIndex - 1;\n\t\t\t\tstate.routeState.activeSplit = movedSplitIndex;\n\t\t\t} else {\n\t\t\t\tstate.routeState.activeSplit -= 1;\n\t\t\t}\n\t\t}\n\t},\n\tmoveLastSplitToNextBranch(state: ReduxGlobalState, action: PayloadAction<{ branchIndex: number }>): void {\n\t\tconst { branchIndex } = action.payload;\n\t\tif (!validateBranch(state, branchIndex) || !validateBranch(state, branchIndex + 1)) {\n\t\t\treturn;\n\t\t}\n\t\tif (getSplitCount(state, branchIndex) <= 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst beforeMoveIndex = getSplitCount(state, branchIndex) - 1;\n\t\tstate.routeState.branches[branchIndex + 1].splits.splice(0, 0, state.routeState.branches[branchIndex].splits[beforeMoveIndex]);\n\t\tstate.routeState.branches[branchIndex].splits.pop();\n\t\tif (getActiveBranch(state) === branchIndex) {\n\t\t\tif (getActiveSplit(state) === beforeMoveIndex) {\n\t\t\t\tstate.routeState.activeBranch = branchIndex + 1;\n\t\t\t\tstate.routeState.activeSplit = 0;\n\t\t\t}\n\t\t} else if (getActiveBranch(state) === branchIndex + 1) {\n\t\t\tstate.routeState.activeSplit += 1;\n\t\t}\n\t},\n\tcreateItem(state: ReduxGlobalState, action: PayloadAction<{ index: number }>): void {\n\t\tconst { index } = action.payload;\n\t\tconst item = newItem();\n\t\tconst itemLength = getItemCount(state);\n\t\tif (itemLength >= ITEM_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tif (!validateItem(state, index)) {\n\t\t\tstate.routeState.items.push(item);\n\t\t} else {\n\t\t\tstate.routeState.items.splice(index, 0, item);\n\t\t}\n\t},\n\tsetItemName(state: ReduxGlobalState, action: PayloadAction<{ index: number, name: string }>): void {\n\t\tconst { index, name } = action.payload;\n\t\tconst oldName = state.routeState.items[index].name;\n\t\tstate.routeState.items[index].name = name;\n\t\tfor (let b = 0; b < getBranchCount(state); b++) {\n\t\t\tfor (let s = 0; s < getSplitCount(state, b); s++) {\n\t\t\t\tfor (let a = 0; a < getActionCount(state, b, s); a++) {\n\t\t\t\t\tconst deltas = getActionDeltas(state, b, s, a);\n\t\t\t\t\tif (deltas !== null) {\n\t\t\t\t\t\trenameItemInDelta(deltas, oldName, name);\n\t\t\t\t\t\tstate.routeState.branches[b].splits[s].actions[a].deltaString = deltaToString(deltas);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tsetItemColor(state: ReduxGlobalState, action: PayloadAction<{ index: number, color: string }>): void {\n\t\tconst { index, color } = action.payload;\n\t\tstate.routeState.items[index].color = color;\n\t},\n\tswapItems(state: ReduxGlobalState, action: PayloadAction<{ i: number, j: number }>): void {\n\t\tconst { i, j } = action.payload;\n\t\tif (!validateItem(state, i) || !validateItem(state, j)) {\n\t\t\treturn;\n\t\t}\n\t\tconst temp = state.routeState.items[i];\n\t\tstate.routeState.items[i] = state.routeState.items[j];\n\t\tstate.routeState.items[j] = temp;\n\t},\n\tdeleteItem(state: ReduxGlobalState, action: PayloadAction<{ index: number }>): void {\n\t\tconst { index } = action.payload;\n\t\tlet name: string;\n\t\tif (!validateItem(state, index)) {\n\t\t\tconst item = state.routeState.items.pop();\n\t\t\tif (item === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tname = item.name;\n\t\t} else {\n\t\t\tconst item = state.routeState.items[index];\n\t\t\tstate.routeState.items.splice(index, 1);\n\t\t\tname = item.name;\n\t\t}\n\t\tfor (let b = 0; b < getBranchCount(state); b++) {\n\t\t\tfor (let s = 0; s < getSplitCount(state, b); s++) {\n\t\t\t\tfor (let a = 0; a < getActionCount(state, b, s); a++) {\n\t\t\t\t\tconst deltas = getActionDeltas(state, b, s, a);\n\t\t\t\t\tif (deltas !== null) {\n\t\t\t\t\t\tdeleteItemInDelta(deltas, name);\n\t\t\t\t\t\tconst deltaString = deltaToString(deltas);\n\t\t\t\t\t\tstate.routeState.branches[b].splits[s].actions[a].deltaString = deltaString;\n\t\t\t\t\t\tif (deltaString === \"\" &&\n\t\t\t\t\t\t\tgetActiveBranch(state) === b &&\n\t\t\t\t\t\t\tgetActiveSplit(state) === s &&\n\t\t\t\t\t\t\tgetActiveAction(state) === a) {\n\t\t\t\t\t\t\tstate.routeState.activeAction = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcreateAction(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, actionIndex: number }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { actionIndex } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\t\tif (!validateSplit(state, branchIndex, splitIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tconst actionCount = getActionCount(state, branchIndex, splitIndex);\n\t\tif (actionCount >= ACTION_LIMIT) {\n\t\t\treturn;\n\t\t}\n\t\tconst routeAction = newAction();\n\t\tif (!validateAction(state, branchIndex, splitIndex, actionIndex)) {\n\t\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions.push(routeAction);\n\t\t} else {\n\t\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions.splice(actionIndex, 0, routeAction);\n\t\t\tconst activeBranch = getActiveBranch(state);\n\t\t\tconst activeSplit = getActiveSplit(state);\n\t\t\tif (activeBranch === branchIndex && activeSplit === splitIndex) {\n\t\t\t\tconst activeAction = getActiveAction(state);\n\t\t\t\tif (activeAction >= actionIndex) {\n\t\t\t\t\tstate.routeState.activeAction += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tsetActionName(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, actionIndex: number, name: string }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { actionIndex, name } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\t\tif (!validateAction(state, branchIndex, splitIndex, actionIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].name = name;\n\t},\n\tsetActionExpanded(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, actionIndex: number, expanded: boolean }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { actionIndex, expanded } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\t\tif (!validateAction(state, branchIndex, splitIndex, actionIndex)) {\n\t\t\treturn;\n\t\t}\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].expanded = expanded;\n\t},\n\tsetActionDeltaString(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, actionIndex: number, deltaString: string }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { actionIndex, deltaString } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\n\t\tif (!validateAction(state, branchIndex, splitIndex, actionIndex)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (deltaString === \"\" &&\n\t\t\tgetActiveBranch(state) === branchIndex &&\n\t\t\tgetActiveSplit(state) === splitIndex &&\n\t\t\tgetActiveAction(state) === actionIndex) {\n\t\t\tstate.routeState.activeAction = -1;\n\t\t}\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].expanded = true;\n\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[actionIndex].deltaString = deltaString;\n\t\tparseDeltaString(state, deltaString, branchIndex, splitIndex, actionIndex);\n\n\t},\n\tdeleteAction(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, actionIndex: number }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { actionIndex } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\n\t\tif (!validateAction(state, branchIndex, splitIndex, actionIndex)) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions.splice(actionIndex, 1);\n\t\tif (getActiveBranch(state) === branchIndex && getActiveSplit(state) === splitIndex) {\n\t\t\tconst activeAction = getActiveAction(state);\n\t\t\tif (activeAction === actionIndex) {\n\t\t\t\tstate.routeState.activeAction = -1;\n\t\t\t} else if (activeAction > actionIndex) {\n\t\t\t\tstate.routeState.activeAction -= 1;\n\t\t\t}\n\t\t}\n\t},\n\tswapActions(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number, i: number, j: number }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tconst { i, j } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\n\t\tif (!validateAction(state, branchIndex, splitIndex, i) || !validateAction(state, branchIndex, splitIndex, j)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst temp = state.routeState.branches[branchIndex].splits[splitIndex].actions[i];\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[i] = state.routeState.branches[branchIndex].splits[splitIndex].actions[j];\n\t\tstate.routeState.branches[branchIndex].splits[splitIndex].actions[j] = temp;\n\t\tif (getActiveBranch(state) === branchIndex && getActiveSplit(state) === splitIndex) {\n\t\t\tconst activeAction = getActiveAction(state);\n\t\t\tif (activeAction === i) {\n\t\t\t\tstate.routeState.activeAction = j;\n\t\t\t} else if (activeAction === j) {\n\t\t\t\tstate.routeState.activeAction = i;\n\t\t\t}\n\t\t}\n\t},\n\treparseAllDeltaStrings(state: ReduxGlobalState): void {\n\t\tfor (let b = 0; b < getBranchCount(state); b++) {\n\t\t\tfor (let s = 0; s < getSplitCount(state, b); s++) {\n\t\t\t\tfor (let a = 0; a < getActionCount(state, b, s); a++) {\n\t\t\t\t\tparseDeltaString(state, getActionDeltaString(state, b, s, a), b, s, a);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tchangeActiveSplit(state: ReduxGlobalState, action: PayloadAction<{ changeBy: number }>): void {\n\t\tconst activeBranch = getActiveBranch(state);\n\t\tconst activeSplit = getActiveSplit(state);\n\t\tif (activeBranch < 0 || activeSplit < 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet current = 0;\n\t\tfor (let b = 0; b < activeBranch; b++) {\n\t\t\tcurrent += getSplitCount(state, b);\n\t\t}\n\t\tcurrent += activeSplit;\n\t\tlet changed = current + action.payload.changeBy;\n\t\tlet changedBranch = -1;\n\t\tlet changedSplit = -1;\n\t\tfor (let b = 0; b < getBranchCount(state); b++) {\n\t\t\tconst splitCount = getSplitCount(state, b);\n\t\t\tif (changed < splitCount) {\n\t\t\t\tchangedBranch = b;\n\t\t\t\tchangedSplit = changed;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tchanged -= splitCount;\n\t\t\t}\n\t\t}\n\n\t\tstate.routeState.activeBranch = changedBranch;\n\t\tstate.routeState.activeSplit = changedSplit;\n\t\tstate.routeState.activeAction = -1;\n\t}\n};","import { PayloadAction } from \"@reduxjs/toolkit\";\nimport { ReduxGlobalState } from \"store/store\";\nimport {\n\tgetResourceCalcProgress,\n\tgetResourceCalcError\n} from \"./selectors\";\nimport { RouteSplit } from \"data/split\";\nimport { getActiveBranch, getActiveSplit, getGlobalActionIndex } from \"store/routing/selectors\";\nimport { ActionResource, ResourceError } from \"data/resource\";\n\nfunction markResourceDirty(state: ReduxGlobalState, globalIndex: number): void {\n\tconst currentProgress = getResourceCalcProgress(state);\n\tif (currentProgress >= 0 && currentProgress < globalIndex) {\n\t\treturn;\n\t}\n\tstate.applicationState.resources.progress = globalIndex;\n\tconst error = getResourceCalcError(state);\n\tif (error !== null) {\n\t\tconst { branch, split, action } = error;\n\t\tconst errorGlobalIndex = getGlobalActionIndex(state, branch, split, action);\n\t\tif (errorGlobalIndex >= globalIndex) {\n\t\t\tstate.applicationState.resources.error = null;\n\t\t}\n\t}\n}\n\nexport default {\n\tsetHeaderCollapsed(state: ReduxGlobalState, action: PayloadAction<{ collapsed: boolean }>): void {\n\t\tstate.applicationState.headerCollapsed = action.payload.collapsed;\n\t},\n\tsetSideCollapsed(state: ReduxGlobalState, action: PayloadAction<{ collapsed: boolean }>): void {\n\t\tstate.applicationState.sideCollapsed = action.payload.collapsed;\n\t},\n\tsetResourcesCollapsed(state: ReduxGlobalState, action: PayloadAction<{ collapsed: boolean }>): void {\n\t\tstate.applicationState.resourcesCollapsed = action.payload.collapsed;\n\t},\n\tsetEditingNav(state: ReduxGlobalState, action: PayloadAction<{ editing: boolean }>): void {\n\t\tstate.applicationState.editingNav = action.payload.editing;\n\t},\n\tsetEditingActions(state: ReduxGlobalState, action: PayloadAction<{ editing: boolean }>): void {\n\t\tstate.applicationState.editingActions = action.payload.editing;\n\t},\n\tsetEditingItems(state: ReduxGlobalState, action: PayloadAction<{ editing: boolean }>): void {\n\t\tstate.applicationState.editingItems = action.payload.editing;\n\t},\n\tsetInfo(state: ReduxGlobalState, action: PayloadAction<{ info: string }>): void {\n\t\tstate.applicationState.info = action.payload.info;\n\t},\n\tsetSplitClipboard(state: ReduxGlobalState, action: PayloadAction<{ split: RouteSplit }>): void {\n\t\tstate.applicationState.splitClipboard = action.payload.split;\n\t},\n\tsetResourceContent(state: ReduxGlobalState, action: PayloadAction<{ globalIndex: number, content: ActionResource }>): void {\n\t\tconst { globalIndex, content } = action.payload;\n\t\tstate.applicationState.resources.content[globalIndex] = content;\n\t\tstate.applicationState.resources.progress = globalIndex + 1;\n\t},\n\tsetResourceError(state: ReduxGlobalState, action: PayloadAction<{ error: ResourceError }>): void {\n\t\tstate.applicationState.resources.error = action.payload.error;\n\t},\n\tmarkResourceDirtyAt(state: ReduxGlobalState, action: PayloadAction<{ globalIndex: number }>): void {\n\t\tconst { globalIndex } = action.payload;\n\t\tmarkResourceDirty(state, globalIndex);\n\t},\n\tmarkResourceDirtyAtSplit(state: ReduxGlobalState, action: PayloadAction<{ branchIndex?: number, splitIndex?: number }>): void {\n\t\tlet { branchIndex, splitIndex } = action.payload;\n\t\tbranchIndex = branchIndex ?? getActiveBranch(state);\n\t\tsplitIndex = splitIndex ?? getActiveSplit(state);\n\n\t\tconst globalIndex = getGlobalActionIndex(state, branchIndex, splitIndex, 0);\n\t\tmarkResourceDirty(state, globalIndex);\n\t},\n\tsetShowOnlyChangedResources(state: ReduxGlobalState, action: PayloadAction<{ showOnlyChangedResources: boolean }>): void {\n\t\tstate.applicationState.showOnlyChangedResources = action.payload.showOnlyChangedResources;\n\t},\n\tsetShowingHelp(state: ReduxGlobalState, action: PayloadAction<{ showHelp: boolean }>): void {\n\t\tstate.applicationState.showHelp = action.payload.showHelp;\n\t}\n};","import { createSlice, configureStore } from \"@reduxjs/toolkit\";\nimport { RouteState } from \"store/routing/type\";\nimport routingReducers from \"store/routing/reducers\";\nimport applicationReducers from \"store/application/reducers\";\nimport settingReducers from \"store/setting/reducers\";\nimport testInitialState from \"store/initial\";\nimport { SettingState } from \"store/setting/type\";\nimport { ApplicationState } from \"store/application/type\";\n\nexport type ReduxGlobalState = {\n\trouteState: RouteState,\n\tsettingState: SettingState,\n\tapplicationState: ApplicationState,\n};\n\nconst initialState = testInitialState as ReduxGlobalState;\n\nconst slice = createSlice({\n\tname: \"state\",\n\tinitialState,\n\treducers: {\n\t\t...routingReducers,\n\t\t...applicationReducers,\n\t\t...settingReducers,\n\t},\n});\n\nexport const actions = slice.actions;\n\nconst store = configureStore({\n\treducer: slice.reducer\n});\n\nexport default store;\n","\nexport default {\n\trouteState: {\n\t\tprojectName: \"Unnamed Project\",\n\t\tactiveBranch: -1,\n\t\tactiveSplit: -1,\n\t\tactiveAction: -1,\n\t\tbranches: [],\n\t\titems: [],\n\t},\n\tsettingState: {\n\t\tautoSave: true,\n\t\tonlyShowChangedItems: false,\n\t\titemFilter: \"\",\n\t},\n\tapplicationState: {\n\t\tsideCollapsed: false,\n\t\theaderCollapsed: true,\n\t\tresourcesCollapsed: false,\n\t\tnoResources: false,\n\t\tshrinkSide: false,\n\t\teditingNav: false,\n\t\teditingActions: false,\n\t\teditingItems: false,\n\t\tinfo: \"\",\n\t\tsplitClipboard: undefined,\n\t\tresources: {\n\t\t\terror: null,\n\t\t\tcontent: [],\n\t\t\tprogress: -1,\n\t\t},\n\t\tshowOnlyChangedResources: false,\n\t\tshowHelp: false,\n\t}\n};","import { PayloadAction } from \"@reduxjs/toolkit\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { SettingState } from \"./type\";\n\nexport default {\n\tsetSettingState(state: ReduxGlobalState, action: PayloadAction<{ settingState: SettingState }>): void {\n\t\tstate.settingState = action.payload.settingState;\n\t},\n\tsetItemFilter(state: ReduxGlobalState, action: PayloadAction<{ filter: string }>): void {\n\t\tstate.settingState.itemFilter = action.payload.filter;\n\t},\n\tsetAutoSaveEnabled(state: ReduxGlobalState, action: PayloadAction<{ enabled: boolean }>): void {\n\t\tstate.settingState.autoSave = action.payload.enabled;\n\t}\n};","import { actions } from \"store/store\";\n\nexport const {\n\tsetRouteState,\n\tsetActiveBranchAndSplit,\n\tsetActiveAction,\n\tcreateBranch,\n\tsetBranchName,\n\tsetBranchExpanded,\n\tdeleteBranch,\n\tswapBranches,\n\tmergeNextIntoBranch,\n\tbreakBranchAt,\n\tcreateSplit,\n\tsetSplitName,\n\tsetSplitExpanded,\n\tdeleteSplit,\n\tswapSplits,\n\tmoveFirstSplitToPreviousBranch,\n\tmoveLastSplitToNextBranch,\n\tcreateItem,\n\tsetItemName,\n\tsetItemColor,\n\tswapItems,\n\tdeleteItem,\n\tcreateAction,\n\tsetActionName,\n\tsetActionExpanded,\n\tdeleteAction,\n\tswapActions,\n\tsetActionDeltaString,\n\tsetProjectName,\n\treparseAllDeltaStrings,\n\tchangeActiveSplit,\n} = actions;\n","import { actions } from \"store/store\";\n\nexport const {\n\tsetHeaderCollapsed,\n\tsetSideCollapsed,\n\tsetResourcesCollapsed,\n\tsetEditingNav,\n\tsetEditingActions,\n\tsetEditingItems,\n\tsetInfo,\n\tsetSplitClipboard,\n\tsetResourceContent,\n\tsetResourceError,\n\tmarkResourceDirtyAt,\n\tmarkResourceDirtyAtSplit,\n\tsetShowOnlyChangedResources,\n\tsetShowingHelp,\n} = actions;","export type millisecond = number;\n\nexport function benchStart(): millisecond {\n\treturn new Date().getTime();\n}\n\nexport function benchEnd(start: millisecond): millisecond {\n\treturn new Date().getTime() - start;\n}","import { connect, ConnectedProps } from \"react-redux\";\nimport ActionSummary from \"components/action/ActionSummary\";\nimport ExpandButton from \"components/ExpandButton\";\nimport {\n\tgetBranchCount,\n\tgetSplitCount,\n\tgetSplitName,\n\tisSplitExpanded,\n\tgetSplit,\n} from \"store/routing/selectors\";\nimport { isEditingNav } from \"store/application/selectors\";\nimport {\n\tsetSplitExpanded,\n\tsetSplitName,\n\tdeleteSplit,\n\tbreakBranchAt,\n\tcreateSplit,\n\tswapSplits,\n\tmoveFirstSplitToPreviousBranch,\n\tmoveLastSplitToNextBranch,\n\tsetActiveBranchAndSplit,\n} from \"store/routing/actions\";\nimport {\n\tsetInfo,\n\tsetSplitClipboard,\n\tsetEditingActions,\n\tsetEditingNav,\n\tmarkResourceDirtyAtSplit,\n\tsetShowingHelp,\n} from \"store/application/actions\";\nimport { getSplitClipboard } from \"store/application/selectors\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { benchStart, benchEnd } from \"util/benchmark\";\nimport { SPLIT_LIMIT } from \"data/limit\";\nimport { AppAction } from \"App\";\nimport { RouteSplit } from \"data/split\";\nimport { ReduxGlobalState } from \"store/store\";\n\ntype ExternalProps = {\n\tbranchIndex: number,\n\tsplitIndex: number,\n\tappActions: AppAction,\n}\nconst mapStateToProps = (state: ReduxGlobalState, { branchIndex, splitIndex }: ExternalProps) => ({\n\tname: getSplitName(state, branchIndex, splitIndex),\n\texpanded: isSplitExpanded(state, branchIndex, splitIndex),\n\tisLastBranch: getBranchCount(state) === branchIndex + 1,\n\tediting: isEditingNav(state),\n\tcopiedSplit: getSplitClipboard(state),\n\tsplitToCopy: getSplit(state, branchIndex, splitIndex),\n\tsplitCount: getSplitCount(state, branchIndex),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetSplitExpanded,\n\t\tsetSplitName,\n\t\tbreakBranchAt,\n\t\tsetInfo,\n\t\tdeleteSplit,\n\t\tcreateSplit,\n\t\tsetSplitClipboard,\n\t\tswapSplits,\n\t\tmoveFirstSplitToPreviousBranch,\n\t\tmoveLastSplitToNextBranch,\n\t\tsetActiveBranchAndSplit,\n\t\tsetEditingActions,\n\t\tmarkResourceDirtyAtSplit,\n\t\tsetShowingHelp,\n\t\tsetEditingNav,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const Split: React.FunctionComponent<Props> = ({\n\tbranchIndex, splitIndex, name, expanded, isLastBranch, editing, actions, appActions, copiedSplit, splitToCopy, splitCount,\n}: Props) => {\n\tconst isLast = splitIndex === splitCount - 1;\n\tconst isFirstBranch = branchIndex === 0;\n\tconst isFirst = splitIndex === 0;\n\tconst displayName = name || \"[Unnamed Split]\";\n\tconst expandButtonCell =\n\t\t<td className=\"icon-button-width\">\n\t\t\t<ExpandButton expanded={expanded} setExpanded={(expanded: boolean) => {\n\t\t\t\tactions.setSplitExpanded({ branchIndex, splitIndex, expanded });\n\t\t\t}} />\n\t\t</td>;\n\tconst handleCreateSplit = (templateSplit?: RouteSplit) => {\n\t\tif (splitCount >= SPLIT_LIMIT) {\n\t\t\tconst message = `You have reached the maximum number of splits per branch (${SPLIT_LIMIT})`;\n\t\t\tappActions.showAlert(message, undefined);\n\t\t\tactions.setInfo({ info: message });\n\t\t} else {\n\t\t\tconst startTime = benchStart();\n\t\t\tactions.createSplit({\n\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\tsplitIndex: splitIndex + 1,\n\t\t\t\ttemplateSplit: templateSplit,\n\t\t\t});\n\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\tsplitIndex: splitIndex,\n\t\t\t});\n\t\t\tactions.setEditingNav({ editing: true });\n\t\t\tactions.setInfo({ info: `Split created. (${benchEnd(startTime)} ms)` });\n\t\t}\n\t};\n\tlet splitNode;\n\tif (editing) {\n\t\tsplitNode =\n\t\t\t<tr>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"Break branch\" onClick={() => {\n\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\tactions.breakBranchAt({ branchIndex, splitIndex });\n\t\t\t\t\t\tactions.setInfo({ info: `Branch broken. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t}}>{\"/\"}</button>\n\t\t\t\t</td>\n\t\t\t\t<td colSpan={4}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"full-width\"\n\t\t\t\t\t\tplaceholder=\"Split Name\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tactions.setSplitName({ branchIndex, splitIndex, name: e.target.value });\n\t\t\t\t\t\t}} />\n\t\t\t\t</td>\n\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!(isFirst && isFirstBranch) &&\n\t\t\t\t\t\t<button className=\"icon-button\" disabled={isFirst && isFirstBranch} title=\"Move up\" onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tif (isFirst) {\n\t\t\t\t\t\t\t\tactions.moveFirstSplitToPreviousBranch({ branchIndex });\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Split moved into previous branch. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tactions.swapSplits({ branchIndex, i: splitIndex, j: splitIndex - 1 });\n\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\t\t\t\t\t\tsplitIndex: splitIndex - 1,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Split moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}} >&uarr;</button>\n\t\t\t\t\t}\n\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!(isLast && isLastBranch) &&\n\t\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast && isLastBranch} onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tif (isLast) {\n\t\t\t\t\t\t\t\tactions.moveLastSplitToNextBranch({ branchIndex });\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Split moved into next branch. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tactions.swapSplits({ branchIndex, i: splitIndex, j: splitIndex + 1 });\n\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\t\t\t\t\t\tsplitIndex: splitIndex,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Split moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}} >&darr;</button>\n\t\t\t\t\t}\n\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"Copy\" onClick={() => {\n\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\tactions.setSplitClipboard({ split: splitToCopy });\n\t\t\t\t\t\tactions.setInfo({ info: `Split copied. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t}} >c</button>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{copiedSplit !== undefined &&\n\t\t\t\t\t\t<button className=\"icon-button\" title=\"Paste Split Below\" disabled={copiedSplit === undefined} onClick={() => {\n\t\t\t\t\t\t\thandleCreateSplit(copiedSplit);\n\t\t\t\t\t\t}} >p</button>\n\t\t\t\t\t}\n\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\n\t\t\t\t\t\tappActions.showAlert(\n\t\t\t\t\t\t\t`Delete split \"${name}\"? All actions inside this split will also be deleted. This is NOT reversible!`,\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tname: \"Delete\",\n\t\t\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\t\tactions.deleteSplit({ branchIndex, splitIndex });\n\t\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\t\t\t\t\t\t\tsplitIndex: splitIndex,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tactions.setInfo({ info: `Split deleted. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t);\n\t\t\t\t\t}}>X</button>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Split Below\" onClick={() => {\n\t\t\t\t\t\thandleCreateSplit(undefined);\n\t\t\t\t\t}}>*</button>\n\t\t\t\t</td>\n\t\t\t</tr>;\n\t} else {\n\t\tsplitNode =\n\t\t\t<tr>\n\t\t\t\t<td className=\"icon-button-width\" />\n\t\t\t\t{expandButtonCell}\n\t\t\t\t<td colSpan={9}>\n\t\t\t\t\t<u className=\"split-link\" onClick={() => {\n\t\t\t\t\t\tactions.setActiveBranchAndSplit({\n\t\t\t\t\t\t\tactiveBranch: branchIndex,\n\t\t\t\t\t\t\tactiveSplit: splitIndex,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tactions.setEditingActions({ editing: false });\n\t\t\t\t\t\tactions.setShowingHelp({ showHelp: false });\n\t\t\t\t\t}}>{displayName}</u>\n\t\t\t\t</td>\n\t\t\t</tr>;\n\t}\n\tif (!expanded || editing) {\n\t\treturn splitNode;\n\t}\n\n\treturn <>{splitNode}<ActionSummary branchIndex={branchIndex} splitIndex={splitIndex} /></>;\n};\n\nexport default connector(Split);","import { connect, ConnectedProps } from \"react-redux\";\nimport Split from \"./Split\";\n// import { createSplitAt, mergeNextBranchWithCurrentBranch } from \"../../data\";\nimport {\n\tgetBranchCount,\n\tgetBranchName,\n\tgetSplitCount\n} from \"store/routing/selectors\";\nimport { getSplitClipboard, isEditingNav } from \"store/application/selectors\";\nimport {\n\tcreateSplit,\n\tmergeNextIntoBranch,\n} from \"store/routing/actions\";\nimport {\n\tsetInfo,\n\tmarkResourceDirtyAtSplit,\n\tsetEditingNav,\n} from \"store/application/actions\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { benchEnd, benchStart } from \"util/benchmark\";\nimport { SPLIT_LIMIT } from \"data/limit\";\nimport { RouteSplit } from \"data/split\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\n\ntype ExternalProps = {\n\tbranchIndex: number,\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, { branchIndex }: ExternalProps) => ({\n\tlength: getSplitCount(state, branchIndex),\n\tediting: isEditingNav(state),\n\tisLastBranch: getBranchCount(state) === branchIndex + 1,\n\tcurrentBranchName: getBranchName(state, branchIndex),\n\tnextBranchName: branchIndex === getBranchCount(state) - 1 ? undefined : getBranchName(state, branchIndex + 1),\n\tcopiedSplit: getSplitClipboard(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tcreateSplit,\n\t\tsetInfo,\n\t\tmergeNextIntoBranch,\n\t\tmarkResourceDirtyAtSplit,\n\t\tsetEditingNav,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const SplitList: React.FunctionComponent<Props> = ({\n\tbranchIndex, isLastBranch, length, editing, copiedSplit, currentBranchName, nextBranchName, actions, appActions\n}: Props) => {\n\tconst splitNodes = [];\n\tfor (let i = 0; i < length; i++) {\n\t\tsplitNodes.push(<Split\n\t\t\tkey={`split_${i}_`}\n\t\t\tbranchIndex={branchIndex}\n\t\t\tsplitIndex={i}\n\t\t\tappActions={appActions}\n\t\t/>);\n\t}\n\tconst handleCreateSplit = (templateSplit?: RouteSplit) => {\n\t\tif (length >= SPLIT_LIMIT) {\n\t\t\tconst message = `You have reached the maximum number of splits per branch (${SPLIT_LIMIT})`;\n\t\t\tappActions.showAlert(message);\n\t\t\tactions.setInfo({ info: message });\n\t\t} else {\n\t\t\tconst startTime = benchStart();\n\t\t\tactions.createSplit({\n\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\tsplitIndex: length,\n\t\t\t\ttemplateSplit: templateSplit,\n\t\t\t});\n\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\tbranchIndex: branchIndex,\n\t\t\t\tsplitIndex: length,\n\t\t\t});\n\t\t\tactions.setEditingNav({ editing: true });\n\t\t\tactions.setInfo({ info: `Split created. (${benchEnd(startTime)} ms)` });\n\t\t}\n\t};\n\treturn <>\n\t\t{splitNodes}\n\t\t<tr>\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t{editing && !isLastBranch &&\n\t\t\t\t\t<button className=\"icon-button\" title=\"Merge branch\" disabled={isLastBranch} onClick={() => {\n\t\t\t\t\t\tappActions.showAlert(\n\t\t\t\t\t\t\t`Merge branch \"${nextBranchName}\" into \"${currentBranchName}\"?`,\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tname: \"Merge\",\n\t\t\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\t\tactions.mergeNextIntoBranch({ branchIndex });\n\t\t\t\t\t\t\t\t\tactions.setInfo({ info: `Branch merged. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t);\n\t\t\t\t\t}}>^</button>\n\t\t\t\t}\n\t\t\t</td>\n\t\t\t<td colSpan={10}>\n\t\t\t\t<button onClick={() => {\n\t\t\t\t\thandleCreateSplit(undefined);\n\t\t\t\t}}>New Split</button>\n\t\t\t\t<button className=\"space-left-small\" disabled={copiedSplit === undefined} onClick={() => {\n\t\t\t\t\thandleCreateSplit(copiedSplit);\n\t\t\t\t}}>Paste Split</button>\n\t\t\t</td>\n\t\t</tr>\n\t</>;\n};\n\nexport default connector(SplitList);","import { connect, ConnectedProps } from \"react-redux\";\nimport ExpandButton from \"../ExpandButton\";\nimport SplitList from \"components/split/SplitList\";\nimport {\n\tisBranchExpanded,\n\tgetBranchName,\n\tgetBranchCount\n} from \"store/routing/selectors\";\nimport {\n\tcreateBranch,\n\tsetBranchName,\n\tsetBranchExpanded,\n\tdeleteBranch,\n\tswapBranches,\n} from \"store/routing/actions\";\nimport { isEditingNav } from \"store/application/selectors\";\nimport {\n\tsetInfo,\n\tsetEditingNav,\n\tmarkResourceDirtyAtSplit,\n} from \"store/application/actions\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { benchEnd, benchStart } from \"util/benchmark\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { BRANCH_LIMIT } from \"data/limit\";\n\ntype ExternalProps = {\n\tindex: number,\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, { index }: ExternalProps) => ({\n\tname: getBranchName(state, index),\n\texpanded: isBranchExpanded(state, index),\n\tediting: isEditingNav(state),\n\tbranchCount: getBranchCount(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tcreateBranch,\n\t\tsetBranchName,\n\t\tsetBranchExpanded,\n\t\tdeleteBranch,\n\t\tsetInfo,\n\t\tswapBranches,\n\t\tsetEditingNav,\n\t\tmarkResourceDirtyAtSplit,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const Branch: React.FunctionComponent<Props> = ({ index, name, expanded, editing, actions, branchCount, appActions }: Props) => {\n\tconst displayName = name || \"[Unnamed Branch]\";\n\tconst isFirst = index === 0;\n\tconst isLast = index === branchCount - 1;\n\tconst expandButtonCell =\n\t\t<td className=\"icon-button-width\">\n\t\t\t<ExpandButton expanded={expanded} setExpanded={(expanded) => {\n\t\t\t\tactions.setBranchExpanded({ branchIndex: index, expanded });\n\t\t\t}} />\n\t\t</td>;\n\tlet branchNode;\n\tif (editing && !expanded) {\n\t\tbranchNode =\n\t\t\t<tr>\n\t\t\t\t{expandButtonCell}\n\t\t\t\t<td colSpan={6}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"full-width\"\n\t\t\t\t\t\tplaceholder=\"Branch Name\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tactions.setBranchName({ branchIndex: index, name: e.target.value });\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!isFirst &&\n\t\t\t\t\t\t<button className=\"icon-button\" title=\"Move up\" disabled={isFirst} onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.swapBranches({ i: index, j: index - 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\tbranchIndex: index - 1,\n\t\t\t\t\t\t\t\tsplitIndex: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tactions.setInfo({ info: `Branch moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}}>&uarr;</button>\n\t\t\t\t\t}\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!isLast &&\n\t\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast} onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.swapBranches({ i: index, j: index + 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\tbranchIndex: index,\n\t\t\t\t\t\t\t\tsplitIndex: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tactions.setInfo({ info: `Branch moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}}>&darr;</button>\n\t\t\t\t\t}\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\n\t\t\t\t\t\tappActions.showAlert(\n\t\t\t\t\t\t\t`Delete branch \"${name}\"? All splits inside this branch will also be deleted. This is NOT reversible!`,\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tname: \"Delete\",\n\t\t\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\t\tactions.deleteBranch({ branchIndex: index });\n\t\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\t\t\tbranchIndex: index,\n\t\t\t\t\t\t\t\t\t\tsplitIndex: 0,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tactions.setInfo({ info: `Branch deleted. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t);\n\t\t\t\t\t}}>X</button>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Branch Below\" onClick={() => {\n\t\t\t\t\t\tif (branchCount >= BRANCH_LIMIT) {\n\t\t\t\t\t\t\tconst message = `You have reached the maximum number of branches (${BRANCH_LIMIT})`;\n\t\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.createBranch({ branchIndex: index + 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\tbranchIndex: index + 1,\n\t\t\t\t\t\t\t\tsplitIndex: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tactions.setEditingNav({ editing: true });\n\t\t\t\t\t\t\tactions.setInfo({ info: `Branch created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}\n\t\t\t\t\t}}>*</button>\n\t\t\t\t</td>\n\t\t\t</tr>;\n\t} else {\n\t\tbranchNode =\n\t\t\t<tr>\n\t\t\t\t{expandButtonCell}\n\t\t\t\t<td colSpan={10}>\n\t\t\t\t\t<strong>{displayName}</strong> {editing && <em>collapse to edit</em>}\n\t\t\t\t</td>\n\t\t\t</tr>;\n\t}\n\tif (!expanded) {\n\t\treturn branchNode;\n\t}\n\treturn <>\n\t\t{branchNode}\n\t\t<SplitList\n\t\t\tbranchIndex={index}\n\t\t\tappActions={appActions}\n\t\t/>\n\t</>;\n\n};\n\nexport default connector(Branch);","import { connect, ConnectedProps } from \"react-redux\";\nimport Branch from \"./Branch\";\n\nimport {\n\tgetBranchCount\n} from \"store/routing/selectors\";\nimport {\n\tcreateBranch\n} from \"store/routing/actions\";\nimport {\n\tsetEditingNav,\n\tsetInfo,\n\tmarkResourceDirtyAtSplit,\n} from \"store/application/actions\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { BRANCH_LIMIT } from \"data/limit\";\nimport { benchStart, benchEnd } from \"util/benchmark\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\tlength: getBranchCount(state)\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tcreateBranch,\n\t\tsetEditingNav,\n\t\tsetInfo,\n\t\tmarkResourceDirtyAtSplit,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const BranchList: React.FunctionComponent<Props> = ({ length, actions, appActions }: Props) => {\n\t// if (length === 0) {\n\t// \treturn null;\n\t// }\n\tconst branchNodes = [];\n\tfor (let i = 0; i < length; i++) {\n\t\tbranchNodes.push(<Branch\n\t\t\tindex={i}\n\t\t\tkey={i}\n\t\t\tappActions={appActions}\n\t\t/>);\n\t}\n\treturn (\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t{branchNodes}\n\t\t\t\t<tr key=\"new_branch_button\">\n\t\t\t\t\t<td colSpan={11}>\n\t\t\t\t\t\t<button onClick={() => {\n\t\t\t\t\t\t\tif (length >= BRANCH_LIMIT) {\n\t\t\t\t\t\t\t\tconst message = `You have reached the maximum number of branches (${BRANCH_LIMIT})`;\n\t\t\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\tactions.createBranch({ branchIndex: length });\n\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({\n\t\t\t\t\t\t\t\t\tbranchIndex: length,\n\t\t\t\t\t\t\t\t\tsplitIndex: 0,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tactions.setEditingNav({ editing: true });\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Branch created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}>New Branch</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\n\t\t\t</tbody>\n\n\t\t</table>\n\t);\n};\n\nexport default connector(BranchList);","type SplitLayoutProps = {\n\tdirection?: \"vertical\" | \"horizontal\";\n\tbase?: \"first\" | \"second\";\n\tsize: string;\n\tmin?: string;\n\tmax?: string;\n} & Record<string, unknown>;\n\nexport const SplitLayout: React.FunctionComponent<SplitLayoutProps> = ({ direction = \"vertical\", base = \"first\", size, min, max, children, ...other }) => {\n\tif (!Array.isArray(children) || children.length !== 2) {\n\t\tconsole.error(\"Layout must contain 2 children\");\n\t\treturn null;\n\t}\n\tconst first = children[0];\n\tconst second = children[1];\n\tconst baseFirst = base === \"first\";\n\tlet firstStyle: Record<string, unknown>;\n\tlet secondStyle: Record<string, unknown>;\n\tlet baseSize = min ? `max( ${min} , ${size} )` : size;\n\tbaseSize = max ? `min( ${max} , ${baseSize})` : baseSize;\n\tconst otherSize = `calc(100% - ${baseSize})`;\n\n\tif (direction === \"horizontal\") {\n\t\tfirstStyle = {\n\t\t\theight: \"100%\",\n\t\t\twidth: baseFirst ? baseSize : otherSize,\n\t\t\toverflow: \"hidden\",\n\t\t\tfloat: \"left\",\n\t\t};\n\t\tsecondStyle = {\n\t\t\theight: \"100%\",\n\t\t\twidth: baseFirst ? otherSize : baseSize,\n\t\t\toverflow: \"hidden\",\n\t\t\tfloat: \"right\",\n\t\t};\n\t} else {\n\t\tfirstStyle = {\n\t\t\theight: baseFirst ? baseSize : otherSize,\n\t\t\twidth: \"100%\",\n\t\t\toverflow: \"hidden\",\n\t\t};\n\t\tsecondStyle = {\n\t\t\theight: baseFirst ? otherSize : baseSize,\n\t\t\twidth: \"100%\",\n\t\t\toverflow: \"hidden\",\n\t\t};\n\t}\n\treturn (\n\t\t<BoxLayout {...other}>\n\t\t\t<div style={firstStyle}>\n\t\t\t\t{first}\n\t\t\t</div>\n\t\t\t<div style={secondStyle}>\n\t\t\t\t{second}\n\t\t\t</div>\n\t\t</BoxLayout>\n\t);\n};\n\ntype CenterLayoutProps = {\n\twidth: string,\n\theight: string,\n\tminWidth?: string,\n\tmaxWidth?: string,\n\tminHeight?: string,\n\tmaxHeight?: string,\n} & Record<string, unknown>;\n\nexport const CenterLayout: React.FunctionComponent<CenterLayoutProps> = ({\n\twidth, height, minWidth, maxWidth, minHeight, maxHeight, children, ...other\n}) => {\n\tconst heightAfterMin = minHeight ? `max( ${height} , ${minHeight} )` : height;\n\tconst heightAfterMinMax = maxHeight ? `min( ${heightAfterMin}, ${maxHeight} )` : heightAfterMin;\n\n\tconst widthAfterMin = minWidth ? `max( ${width} , ${minWidth} )` : width;\n\tconst widthAfterMinMax = maxWidth ? `min( ${widthAfterMin}, ${maxWidth} )` : widthAfterMin;\n\n\tconst paddingVertical = `calc( ( 100% - ${heightAfterMinMax} ) / 2 )`;\n\tconst paddingHorizontal = `calc( ( 100% - ${widthAfterMinMax} ) / 2 )`;\n\treturn (\n\t\t<BoxLayout style={{\n\t\t\tposition: \"relative\"\n\t\t}}>\n\t\t\t<div style={{\n\t\t\t\tposition: \"absolute\",\n\t\t\t\ttop: paddingVertical,\n\t\t\t\tpaddingLeft: paddingHorizontal,\n\t\t\t\twidth: widthAfterMinMax,\n\t\t\t\theight: heightAfterMinMax,\n\t\t\t}} {...other}>\n\t\t\t\t{children}\n\t\t\t</div>\n\t\t</BoxLayout>\n\n\t);\n};\n\ntype AnyProps = {\n\tstyle?: Record<string, unknown>\n} & Record<string, unknown>\n\nexport const BoxLayout: React.FunctionComponent<AnyProps> = ({ style, children, ...other }) => {\n\treturn (\n\t\t<div style={{\n\t\t\t...style,\n\t\t\twidth: \"100%\",\n\t\t\theight: \"100%\",\n\t\t}} {...other}>\n\t\t\t{children}\n\t\t</div>\n\t);\n};\n\nexport const WindowLayout: React.FunctionComponent<AnyProps> = ({ style, children, ...other }) => {\n\t//console.log(other);\n\treturn (\n\t\t<div style={{\n\t\t\t...style,\n\t\t\tposition: \"fixed\",\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\twidth: \"100vw\",\n\t\t\theight: \"100vh\"\n\t\t}} {...other}>\n\t\t\t{children}\n\t\t</div>\n\t);\n};\n","import BranchList from \"components/branch/BranchList\";\nimport ExpandButton from \"components/ExpandButton\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tisEditingNav,\n\tisSideSectionCollapsed\n} from \"store/application/selectors\";\nimport {\n\tsetSideCollapsed,\n\tsetEditingNav\n} from \"store/application/actions\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { BoxLayout, SplitLayout } from \"components/Layout\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\tsideCollapsed: isSideSectionCollapsed(state),\n\tediting: isEditingNav(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetSideCollapsed,\n\t\tsetEditingNav\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const SideNav: React.FunctionComponent<Props> = ({\n\tsideCollapsed,\n\tactions,\n\tappActions,\n\tediting,\n}: Props) => {\n\tconst buttonSection =\n\t\t<span>\n\t\t\t<button className=\"space-left-small\" onClick={() => actions.setEditingNav({ editing: !editing })} >{editing ? \"Finish\" : \"Edit\"}</button>\n\t\t\t<button className=\"space-left-small\" disabled >Collapse All</button>\n\t\t</span>;\n\n\treturn (\n\t\t<SplitLayout base=\"first\" size=\"2rem\" className=\"component border overflow-hidden\">\n\t\t\t<BoxLayout className=\" component header-border\">\n\t\t\t\t<ExpandButton expanded={!sideCollapsed} setExpanded={(expanded) => {\n\t\t\t\t\tactions.setSideCollapsed({ collapsed: !expanded });\n\t\t\t\t}} />\n\t\t\t\t{!sideCollapsed && buttonSection}\n\t\t\t</BoxLayout>\n\t\t\t<BoxLayout className=\"overflow-auto\">\n\t\t\t\t{!sideCollapsed && <BranchList appActions={appActions} />}\n\t\t\t</BoxLayout>\n\t\t</SplitLayout>\n\t);\n};\n\nexport default connector(SideNav);","import { ReduxGlobalState } from \"store/store\";\nimport { SettingState } from \"./type\";\n\nexport function getSettingState(state: ReduxGlobalState): SettingState {\n\treturn state.settingState;\n}\n\nexport function isAutoSaveEnabled(state: ReduxGlobalState): boolean {\n\treturn getSettingState(state).autoSave;\n}\nexport function shouldOnlyShowChangedItem(state: ReduxGlobalState): boolean {\n\treturn getSettingState(state).onlyShowChangedItems;\n}\n\nexport function getItemFilter(state: ReduxGlobalState): string {\n\treturn getSettingState(state).itemFilter;\n}\n","import { actions } from \"store/store\";\n\nexport const {\n\tsetItemFilter,\n\tsetSettingState,\n\tsetAutoSaveEnabled,\n} = actions;","import { connect, ConnectedProps } from \"react-redux\";\nimport ExpandButton from \"components/ExpandButton\";\nimport {\n\tisEditingNav,\n\tisHeaderCollapsed,\n\tisSideSectionCollapsed\n} from \"store/application/selectors\";\nimport {\n\tgetProjectName, getRouteState\n} from \"store/routing/selectors\";\nimport {\n\tgetSettingState,\n\tisAutoSaveEnabled,\n} from \"store/setting/selectors\";\nimport {\n\tsetHeaderCollapsed,\n\tsetInfo,\n\tsetShowingHelp,\n\tsetEditingActions,\n\tsetEditingItems,\n\tsetEditingNav,\n} from \"store/application/actions\";\nimport {\n\tsetAutoSaveEnabled\n} from \"store/setting/actions\";\nimport {\n\tsetProjectName,\n\tsetRouteState,\n} from \"store/routing/actions\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { benchEnd, benchStart } from \"util/benchmark\";\nimport { newEmptyRouteState, saveSettings, storeToLocalStorage } from \"data/storage\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\tprojectName: getProjectName(state),\n\tautoSaveEnabled: isAutoSaveEnabled(state),\n\tsideCollapsed: isSideSectionCollapsed(state),\n\theaderCollapsed: isHeaderCollapsed(state),\n\trouteState: getRouteState(state),\n\tsettingState: getSettingState(state),\n\tediting: isEditingNav(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetHeaderCollapsed,\n\t\tsetInfo,\n\t\tsetAutoSaveEnabled,\n\t\tsetProjectName,\n\t\tsetShowingHelp,\n\t\tsetEditingActions,\n\t\tsetEditingItems,\n\t\tsetEditingNav,\n\t\tsetRouteState,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const Header: React.FunctionComponent<Props> = ({\n\tautoSaveEnabled, projectName, headerCollapsed, sideCollapsed, actions, routeState, settingState, editing, appActions,\n}) => {\n\n\tconst exportButton = <button className=\"vertical-center space-left-small\" onClick={() => appActions.showIODialog()}>Import/Export</button>;\n\n\tconst saveButton = <button className=\"vertical-center space-left-small\" onClick={() => {\n\t\tconst start = benchStart();\n\t\tstoreToLocalStorage(routeState, settingState);\n\t\tactions.setEditingActions({ editing: false });\n\t\tactions.setEditingItems({ editing: false });\n\t\tactions.setEditingNav({ editing: false });\n\t\tactions.setInfo({ info: `Project saved to local storage. (${benchEnd(start)} ms)` });\n\t}}>Save</button>;\n\n\tconst helpButton = <button className=\"vertical-center space-left-small\" onClick={() => {\n\t\tactions.setShowingHelp({ showHelp: true });\n\t}}>Help</button>;\n\n\tconst buttonSection =\n\t\t<span>\n\t\t\t{exportButton}\n\t\t\t{saveButton}\n\t\t\t{helpButton}\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => {\n\t\t\t\tconst enabled = !autoSaveEnabled;\n\t\t\t\tactions.setAutoSaveEnabled({ enabled });\n\t\t\t\tconst settings = { ...settingState, autoSave: enabled };\n\t\t\t\tsaveSettings(settings);\n\t\t\t}}>{autoSaveEnabled ? \"Auto Save: Enabled\" : \"Auto Save: Disabled\"}</button>\n\t\t\t<button className=\"vertical-center space-left-small\" disabled>Force Update Resources</button>\n\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => {\n\t\t\t\tappActions.showAlert(\"Do you really want to delete everything? This is not reversible!!!\", [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\tname: \"Reset\",\n\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\tconst start = benchStart();\n\t\t\t\t\t\t\tconst state = newEmptyRouteState();\n\t\t\t\t\t\t\tactions.setRouteState({ routeState: state });\n\t\t\t\t\t\t\tactions.setInfo({ info: `Reset completed. (${benchEnd(start)} ms)` });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}}>Reset</button>\n\t\t</span>;\n\n\tconst allButtons =\n\t\t<span>\n\t\t\t{!headerCollapsed && buttonSection}\n\t\t\t{headerCollapsed && <>{exportButton}{saveButton}{helpButton}</>}\n\t\t</span>;\n\tlet projectNameSection;\n\tif (editing) {\n\t\tprojectNameSection =\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tvalue={projectName}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tactions.setProjectName({ projectName: e.target.value });\n\t\t\t\t}}\n\t\t\t/>;\n\t} else {\n\t\tprojectNameSection = projectName;\n\t}\n\n\treturn (\n\t\t<div className=\"overflow-hidden\">\n\n\t\t\t{\n\t\t\t\t!sideCollapsed && <h3 className=\"overflow-hidden\">\n\t\t\t\t\t{projectNameSection}\n\n\t\t\t\t</h3>\n\t\t\t}\n\n\t\t\t<ExpandButton expanded={!headerCollapsed} setExpanded={(expanded) => actions.setHeaderCollapsed({ collapsed: !expanded })} />\n\n\t\t\t{!sideCollapsed && allButtons}\n\n\t\t</div>\n\n\t);\n};\n\nexport default connector(Header);","import { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tgetInfo\n} from \"store/application/selectors\";\nimport { ReduxGlobalState } from \"store/store\";\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\ttext: getInfo(state),\n});\n\nconst connector = connect(mapStateToProps);\n\ntype Props = ConnectedProps<typeof connector>;\n\nexport const Footer: React.FunctionComponent<Props> = ({ text }: Props) => {\n\treturn (\n\t\t<span className=\"vertical-center\">{text}</span>\n\t);\n};\n\nexport default connector(Footer);","import { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tgetActiveSplitActionDeltaError,\n\tgetActiveSplitActionDeltas,\n\tgetItemColorByName,\n} from \"store/routing/selectors\";\nimport { DeltaType, typeToOperator } from \"data/delta\";\nimport { getForegroundAndBackground } from \"util/color\";\nimport { ReduxGlobalState } from \"store/store\";\nimport React from \"react\";\n\ntype RenderProps = {\n\tname: string,\n\ttype: DeltaType,\n\tvalue: number | string,\n\tforeground: string,\n\tbackground: string,\n}\n\nconst DeltaItemRender: React.FunctionComponent<RenderProps> = ({ name, type, value, foreground, background }) => {\n\tconst displayName = name;\n\tconst [op, displayValue] = typeToOperator(type, value);\n\tlet displayValueRef;\n\tif (type.startsWith(\"ref\")) {\n\t\tdisplayValueRef = `[${displayValue}]`;\n\t} else {\n\t\tdisplayValueRef = displayValue;\n\t}\n\treturn (\n\t\t<><span style={{ backgroundColor: background, color: foreground }}>[{displayName}]</span>{op}{displayValueRef}</>\n\t);\n};\n\nconst mapStateToPropsForDeltaItemRender = (state: ReduxGlobalState, ownProps: { name: string }) => {\n\tconst color = getItemColorByName(state, ownProps.name) ?? \"\";\n\tconst [foreground, background] = getForegroundAndBackground(color);\n\treturn {\n\t\tforeground, background\n\t};\n};\n\nconst DeltaItem = connect(mapStateToPropsForDeltaItemRender)(DeltaItemRender);\n\ntype ExternalProps = {\n\tactionIndex: number\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, { actionIndex }: ExternalProps) => ({\n\tdeltaError: getActiveSplitActionDeltaError(state, actionIndex),\n\tdeltas: getActiveSplitActionDeltas(state, actionIndex),\n});\n\nconst connector = connect(mapStateToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const DeltaList: React.FunctionComponent<Props> = ({ deltas, deltaError }) => {\n\tconst deltaItems = [];\n\tif (deltaError === undefined) {\n\t\tfor (const name in deltas) {\n\t\t\tdeltaItems.push(\n\t\t\t\t<React.Fragment key={name}><DeltaItem name={name} {...deltas[name]} />, </React.Fragment>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn (\n\t\t<tr key=\"delta\">\n\t\t\t<td className=\"icon-button-width align-right\">\n\t\t\t\t&#916;\n\t\t\t</td>\n\t\t\t<td colSpan={6}>\n\t\t\t\t{deltaError !== undefined ?\n\t\t\t\t\t<span className=\"deltastr-error\">{deltaError}</span>\n\t\t\t\t\t:\n\t\t\t\t\tdeltaItems\n\t\t\t\t}\n\n\t\t\t</td>\n\n\t\t</tr>\n\t);\n};\n\nexport default connector(DeltaList);","import { connect, ConnectedProps } from \"react-redux\";\nimport DeltaList from \"./DeltaList\";\nimport {\n\tgetActiveSplitActionCount,\n\tgetActiveSplitActionDeltaError,\n\tgetActiveSplitActionDeltas,\n\tgetActiveSplitActionDeltaString,\n\tgetActiveSplitActionName,\n\tisActiveSplitActionExpanded\n} from \"store/routing/selectors\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport React from \"react\";\nimport ExpandButton from \"components/ExpandButton\";\nimport { isEditingActions } from \"store/application/selectors\";\nimport { ACTION_LIMIT } from \"data/limit\";\nimport {\n\tsetEditingActions,\n\tsetInfo,\n\tmarkResourceDirtyAtSplit,\n} from \"store/application/actions\";\nimport {\n\tcreateAction,\n\tsetActionName,\n\tsetActionExpanded,\n\tdeleteAction,\n\tswapActions,\n\tsetActionDeltaString,\n\tsetActiveAction,\n} from \"store/routing/actions\";\nimport { benchStart, benchEnd } from \"util/benchmark\";\n\ntype ExternalProps = {\n\tindex: number,\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, { index }: ExternalProps) => ({\n\tname: getActiveSplitActionName(state, index),\n\texpanded: isActiveSplitActionExpanded(state, index),\n\tlength: getActiveSplitActionCount(state),\n\tdeltaString: getActiveSplitActionDeltaString(state, index),\n\tdeltaError: getActiveSplitActionDeltaError(state, index),\n\tdeltas: getActiveSplitActionDeltas(state, index),\n\tediting: isEditingActions(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetInfo,\n\t\tcreateAction,\n\t\tsetEditingActions,\n\t\tsetActionName,\n\t\tsetActionExpanded,\n\t\tdeleteAction,\n\t\tswapActions,\n\t\tsetActionDeltaString,\n\t\tmarkResourceDirtyAtSplit,\n\t\tsetActiveAction,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const ActionItem: React.FunctionComponent<Props> = ({\n\tindex, name = \"\", expanded = false, editing, actions, deltaString = \"\", length = 0, appActions,\n}: Props) => {\n\tconst displayName = name || \"[Unnamed Action]\";\n\tconst isFirst = index === 0;\n\tconst isLast = index === length - 1;\n\tconst expandButton =\n\t\t<td className=\"icon-button-width\">\n\t\t\t{deltaString &&\n\t\t\t\t<ExpandButton expanded={expanded} setExpanded={(expanded) => {\n\t\t\t\t\tactions.setActionExpanded({ actionIndex: index, expanded });\n\t\t\t\t}} />\n\t\t\t}\n\t\t</td>;\n\tlet actionNode;\n\tif (editing) {\n\t\tactionNode =\n\t\t\t<tr>\n\t\t\t\t{expandButton}\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!isFirst &&\n\t\t\t\t\t\t<button className=\"icon-button\" disabled={isFirst} title=\"Move up\" onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.swapActions({ i: index, j: index - 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t\tactions.setInfo({ info: `Action moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}}>&uarr;</button>\n\t\t\t\t\t}\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t{!isLast &&\n\t\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast} onClick={() => {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.swapActions({ i: index, j: index + 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t\tactions.setInfo({ info: `Action moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}}>&darr;</button>\n\t\t\t\t\t}\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\n\t\t\t\t\t\tappActions.showAlert(\n\t\t\t\t\t\t\t`Delete action \"${name}\"? This is NOT reversible!`,\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tname: \"Delete\",\n\t\t\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t\t\t\tactions.deleteAction({ actionIndex: index });\n\t\t\t\t\t\t\t\t\tactions.setInfo({ info: `Action deleted. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t);\n\n\t\t\t\t\t}}>X</button>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Action Below\" onClick={() => {\n\t\t\t\t\t\tif (length >= ACTION_LIMIT) {\n\t\t\t\t\t\t\tconst message = `You have reached the maximum number of actions per split (${ACTION_LIMIT})`;\n\t\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\tactions.createAction({ actionIndex: index + 1 });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t\tactions.setEditingActions({ editing: true });\n\t\t\t\t\t\t\tactions.setInfo({ info: `Action created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t}\n\t\t\t\t\t}}>*</button>\n\t\t\t\t</td>\n\t\t\t\t<td className=\"action-name-width\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"action-name-width\"\n\t\t\t\t\t\tplaceholder=\"Action Title/Notes\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tactions.setActionName({ actionIndex: index, name: e.target.value });\n\t\t\t\t\t\t}} />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName=\"full-width\"\n\t\t\t\t\t\tplaceholder=\"Delta String\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={deltaString}\n\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\tactions.setActionDeltaString({ actionIndex: index, deltaString: e.target.value });\n\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t}} />\n\t\t\t\t</td>\n\n\t\t\t</tr>;\n\t} else {\n\t\tactionNode =\n\t\t\t<tr>\n\t\t\t\t{expandButton}\n\t\t\t\t<td colSpan={6}>\n\t\t\t\t\t<span>{deltaString ? <u className=\"split-link\" onClick={() => {\n\t\t\t\t\t\tactions.setActiveAction({ activeAction: index });\n\t\t\t\t\t}}>{displayName}</u> : <em>{displayName}</em>}\n\t\t\t\t\t</span>\n\t\t\t\t\t{!deltaString && <div className=\"action-note-spacer\" />}\n\t\t\t\t</td>\n\t\t\t</tr>;\n\t}\n\n\tif (!expanded || !deltaString) {\n\t\treturn actionNode;\n\t}\n\n\treturn <>\n\t\t{actionNode}\n\t\t<DeltaList actionIndex={index} />\n\t</>;\n};\n\nexport default connector(ActionItem);","import { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { AppAction } from \"App\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tgetActiveSplit,\n\tgetActiveSplitActionCount\n} from \"store/routing/selectors\";\nimport {\n\tcreateAction,\n} from \"store/routing/actions\";\nimport {\n\tsetEditingActions,\n\tsetInfo,\n\tmarkResourceDirtyAtSplit,\n} from \"store/application/actions\";\nimport { ReduxGlobalState } from \"store/store\";\n\nimport ActionItem from \"./ActionItem\";\nimport { ACTION_LIMIT } from \"data/limit\";\nimport { benchStart, benchEnd } from \"util/benchmark\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\tactive: getActiveSplit(state) >= 0,\n\tlength: getActiveSplitActionCount(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tcreateAction,\n\t\tsetEditingActions,\n\t\tsetInfo,\n\t\tmarkResourceDirtyAtSplit,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nexport const ActionList: React.FunctionComponent<Props> = ({ length, active, actions, appActions }: Props) => {\n\tif (!active || length === undefined) {\n\t\treturn <span>Click on a split to view its details</span>;\n\t}\n\tconst actionNodes = [];\n\tfor (let i = 0; i < length; i++) {\n\t\tactionNodes.push(<ActionItem\n\t\t\tkey={i}\n\t\t\tindex={i}\n\t\t\tappActions={appActions}\n\t\t/>);\n\t}\n\treturn (\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t{actionNodes}\n\t\t\t\t<tr key=\"new_action_button\">\n\t\t\t\t\t<td colSpan={7}>\n\t\t\t\t\t\t<button onClick={() => {\n\t\t\t\t\t\t\tif (length >= ACTION_LIMIT) {\n\t\t\t\t\t\t\t\tconst message = `You have reached the maximum number of actions per split (${ACTION_LIMIT})`;\n\t\t\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\tactions.createAction({ actionIndex: length });\n\t\t\t\t\t\t\t\tactions.markResourceDirtyAtSplit({});\n\t\t\t\t\t\t\t\tactions.setEditingActions({ editing: true });\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Action created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}>Add Action/Notes</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t);\n};\n\nexport default connector(ActionList);","import ActionList from \"components/action/ActionList\";\nimport {\n\tgetActiveSplitName,\n} from \"store/routing/selectors\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport {\n\tisEditingActions\n} from \"store/application/selectors\";\nimport {\n\tsetEditingActions\n} from \"store/application/actions\";\nimport {\n\tchangeActiveSplit,\n} from \"store/routing/actions\";\nimport { BoxLayout, SplitLayout } from \"components/Layout\";\n\ntype ExternalProps = {\n\tappActions: AppAction\n}\nconst mapStateToProps = (state: ReduxGlobalState) => {\n\treturn {\n\t\tsplitName: getActiveSplitName(state),\n\t\tediting: isEditingActions(state),\n\t};\n};\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetEditingActions,\n\t\tchangeActiveSplit,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps\n\nexport const Actions: React.FunctionComponent<Props> = ({\n\tediting, splitName, appActions, actions\n}: Props) => {\n\n\tconst buttonSection = splitName !== undefined &&\n\t\t<span>\n\t\t\t<button className=\"space-left-small\" onClick={() => {\n\t\t\t\tactions.setEditingActions({ editing: !editing });\n\t\t\t}}>\n\t\t\t\t{editing ? \"Finish\" : \"Edit\"}\n\t\t\t</button>\n\t\t\t<button className=\"space-left-small\" onClick={() => {\n\t\t\t\tactions.changeActiveSplit({ changeBy: -1 });\n\t\t\t}}>Previous Split</button>\n\t\t\t<button className=\"space-left-small\" onClick={() => {\n\t\t\t\tactions.changeActiveSplit({ changeBy: 1 });\n\t\t\t}}>Next Split</button>\n\t\t</span>;\n\n\treturn (\n\t\t<SplitLayout size=\"2rem\" className=\"component border\">\n\t\t\t<BoxLayout className=\"component header-border\">\n\t\t\t\t<strong> Split Detail {splitName && \" - \" + splitName}</strong>\n\t\t\t\t{buttonSection}\n\t\t\t</BoxLayout>\n\t\t\t<BoxLayout className=\"overflow-auto\">\n\t\t\t\t<ActionList appActions={appActions} />\n\t\t\t</BoxLayout>\n\t\t</SplitLayout>\n\t);\n};\n\nexport default connector(Actions);","import { ReactNode } from \"react\";\nimport { AlertOption } from \"App\";\nimport { CenterLayout, WindowLayout } from \"components/Layout\";\ntype Props = {\n\tcontent: ReactNode | undefined,\n\talertActions: AlertOption[],\n\tactions: {\n\t\thideAlert: () => void\n\t}\n}\n\nconst Alert: React.FunctionComponent<Props> = ({ content, alertActions, actions }: Props) => {\n\tif (content === undefined) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<WindowLayout style={{\n\t\t\tbackgroundColor: \"rgb( 0 , 0 , 0 , 0.6 )\"\n\t\t}}>\n\t\t\t<CenterLayout width=\"60%\" height=\"15rem\">\n\t\t\t\t<div className=\"component border\" style={{ backgroundColor: \"white\", height: \"100%\", padding: \"1rem\" }}>\n\t\t\t\t\t{content}\n\t\t\t\t\t<div style={{\n\t\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\t\tbottom: \"1rem\",\n\t\t\t\t\t\tright: \"1rem\"\n\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{alertActions.map((alertAction, i) => <button\n\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\tclassName=\"margin-small\"\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tif (alertAction.execute) {\n\t\t\t\t\t\t\t\t\talertAction.execute();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tactions.hideAlert();\n\t\t\t\t\t\t\t}}>\n\t\t\t\t\t\t\t{alertAction.name}\n\t\t\t\t\t\t</button>)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CenterLayout>\n\t\t</WindowLayout>\n\t);\n};\n\nexport default Alert;","import { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { getForegroundAndBackground } from \"util/color\";\n\nimport {\n\tgetItemColorByIndex,\n\tgetItemCount,\n\tgetItemNameByIndex\n} from \"store/routing/selectors\";\nimport {\n\tcreateItem,\n\tsetItemName,\n\tsetItemColor,\n\tdeleteItem,\n\tswapItems,\n\treparseAllDeltaStrings,\n} from \"store/routing/actions\";\nimport {\n\tsetInfo,\n\tmarkResourceDirtyAt,\n} from \"store/application/actions\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { AppAction } from \"App\";\nimport { benchEnd, benchStart } from \"util/benchmark\";\nimport { ITEM_LIMIT } from \"data/limit\";\nimport { useState } from \"react\";\n\ntype ExternalProps = {\n\tindex: number,\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, ownProps: ExternalProps) => {\n\tconst color = getItemColorByIndex(state, ownProps.index);\n\tconst [foreground, background] = getForegroundAndBackground(color);\n\treturn {\n\t\tname: getItemNameByIndex(state, ownProps.index),\n\t\tcolor,\n\t\tbackground,\n\t\tforeground,\n\t\titemCount: getItemCount(state),\n\t};\n};\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tcreateItem,\n\t\tsetItemName,\n\t\tsetItemColor,\n\t\tsetInfo,\n\t\tdeleteItem,\n\t\tswapItems,\n\t\tmarkResourceDirtyAt,\n\t\treparseAllDeltaStrings,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nconst ItemEdit: React.FunctionComponent<Props> = ({ name, color, foreground, background, index, itemCount, actions, appActions }) => {\n\tconst isLast = index === itemCount - 1;\n\tconst isFirst = index === 0;\n\tconst [renamed, setRenamed] = useState(\"\");\n\treturn (\n\t\t<tr>\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t{!isFirst &&\n\t\t\t\t\t<button className=\"icon-button\" disabled={isFirst} title=\"Move up\" onClick={() => {\n\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\tactions.swapItems({ i: index, j: index - 1 });\n\t\t\t\t\t\tactions.setInfo({ info: `Item moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t}}>&uarr;</button>\n\t\t\t\t}\n\n\t\t\t</td>\n\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t{!isLast &&\n\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast} onClick={() => {\n\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\tactions.swapItems({ i: index, j: index + 1 });\n\t\t\t\t\t\tactions.setInfo({ info: `Item moved. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t}}>&darr;</button>\n\t\t\t\t}\n\n\t\t\t</td>\n\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\n\t\t\t\t\tappActions.showAlert(\n\t\t\t\t\t\t`Delete item \"${name}\"? This item will also be removed from actions that currently have it. This is NOT reversible!`,\n\t\t\t\t\t\t[{\n\t\t\t\t\t\t\tname: \"Cancel\"\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tname: \"Delete\",\n\t\t\t\t\t\t\texecute: () => {\n\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\tactions.deleteItem({ index });\n\t\t\t\t\t\t\t\tactions.reparseAllDeltaStrings();\n\t\t\t\t\t\t\t\tactions.markResourceDirtyAt({ globalIndex: 0 });\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Item deleted. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t);\n\t\t\t\t}}>X</button>\n\t\t\t</td>\n\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t<button className=\"icon-button\" title=\"New Item Below\" onClick={() => {\n\t\t\t\t\tif (itemCount >= ITEM_LIMIT) {\n\t\t\t\t\t\tconst message = `You have reached the maximum number of items (${ITEM_LIMIT})`;\n\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\tactions.createItem({\n\t\t\t\t\t\t\tindex: index + 1\n\t\t\t\t\t\t});\n\t\t\t\t\t\tactions.setInfo({ info: `Item created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t}\n\t\t\t\t}}>*</button>\n\t\t\t</td>\n\t\t\t<td className=\"icon-button-width\"\n\t\t\t\tstyle={{\n\t\t\t\t\tbackgroundColor: background,\n\t\t\t\t\tcolor: foreground\n\t\t\t\t}}>\n\t\t\t\t{index + 1}.\n\t\t\t</td>\n\t\t\t<td className=\"icon-button-width\">\n\t\t\t\t<button disabled={!renamed || renamed === name} className=\"icon-button\" title=\"Apply rename\" onClick={() => {\n\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\tactions.setItemName({ index, name: renamed });\n\t\t\t\t\tactions.reparseAllDeltaStrings();\n\t\t\t\t\tactions.markResourceDirtyAt({ globalIndex: 0 });\n\n\t\t\t\t\tsetRenamed(\"\");\n\t\t\t\t\tactions.setInfo({ info: `Item renamed. (${benchEnd(startTime)} ms)` });\n\t\t\t\t}}>R</button>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<input\n\t\t\t\t\tclassName=\"full-width\"\n\t\t\t\t\tplaceholder={name || \"[Unnamed]\"}\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={renamed}\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tsetRenamed(e.target.value);\n\t\t\t\t\t}} />\n\n\t\t\t</td>\n\n\t\t\t<td>\n\t\t\t\t<input\n\n\t\t\t\t\tclassName=\"full-width\"\n\t\t\t\t\tplaceholder=\"Color (e.g, red, #FF0000, rgb(255, 0, 0)\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tvalue={color}\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tactions.setItemColor({ index, color: e.target.value });\n\t\t\t\t\t}} />\n\t\t\t</td>\n\n\t\t</tr>\n\t);\n};\n\nexport default connector(ItemEdit);","import { getForegroundAndBackground } from \"util/color\";\nimport { ItemDelta } from \"data/item\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { getItemColorByIndex, getItemNameByIndex } from \"store/routing/selectors\";\nimport { connect, ConnectedProps } from \"react-redux\";\n\ntype ExternalProps = {\n\tindex: number,\n\tdelta?: ItemDelta,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState, { index }: ExternalProps) => {\n\tconst color = getItemColorByIndex(state, index);\n\tconst [foreground, background] = getForegroundAndBackground(color);\n\treturn {\n\t\tname: getItemNameByIndex(state, index),\n\t\tforeground,\n\t\tbackground,\n\t};\n};\n\nconst connector = connect(mapStateToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nfunction deltaString(delta: ItemDelta): string {\n\tconst { value, change } = delta;\n\tif (change === 0) {\n\t\treturn `x${value}`;\n\t}\n\treturn `x${value} (${change >= 0 ? \"+\" : \"\"}${change})`;\n}\n\nconst ItemDisplay: React.FunctionComponent<Props> = ({ name, delta, foreground, background }: Props) => {\n\tconst displayName = name || \"[Unnamed Item]\";\n\treturn <td style={{ backgroundColor: background, color: foreground }}>\n\t\t<span className=\"item-span\" >{displayName}</span>\n\t\t<span className=\"item-span\" >{delta && deltaString(delta)}</span>\n\t</td>;\n};\n\nexport default connector(ItemDisplay);","import ItemEdit from \"./ItemEdit\";\nimport ItemDisplay from \"./ItemDisplay\";\nimport { AppAction } from \"App\";\nimport {\n\tgetActiveGlobalIndex,\n\tgetFilteredItemIndices,\n\tgetItemCount,\n\tgetItemNameByIndex,\n} from \"store/routing/selectors\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { getItemFilter } from \"store/setting/selectors\";\nimport { getActionResourceByGlobalIndex, isEditingItems, isOnlyShowingChangedResources } from \"store/application/selectors\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { ITEM_LIMIT } from \"data/limit\";\nimport {\n\tsetInfo,\n} from \"store/application/actions\";\nimport { createItem } from \"store/routing/actions\";\nimport { benchStart, benchEnd } from \"util/benchmark\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => {\n\tconst filterString = getItemFilter(state);\n\tconst filter = !filterString ? [] : filterString.split(\",\").map(s => s.trim());\n\n\tconst globalIndex = getActiveGlobalIndex(state);\n\tconst deltas = globalIndex !== undefined ? getActionResourceByGlobalIndex(state, globalIndex) : undefined;\n\n\tlet filteredIndices = getFilteredItemIndices(state, filter);\n\tconst showOnlyChanged = isOnlyShowingChangedResources(state);\n\tif (showOnlyChanged && deltas && Object.keys(deltas).length !== 0) {\n\t\tfilteredIndices = filteredIndices.filter(i => {\n\t\t\tconst name = getItemNameByIndex(state, i);\n\t\t\treturn name in deltas && deltas[name].change !== 0;\n\t\t});\n\t}\n\n\treturn {\n\t\titemIndices: filteredIndices,\n\t\tediting: isEditingItems(state),\n\t\titemCount: getItemCount(state),\n\t\tgetItemNameByIndex: (i: number) => getItemNameByIndex(state, i),\n\t\tdeltas,\n\t};\n};\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetInfo,\n\t\tcreateItem,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nconst ItemList: React.FunctionComponent<Props> = ({ itemIndices, deltas, getItemNameByIndex, editing, actions, appActions, itemCount }) => {\n\tlet itemSection;\n\n\tif (editing) {\n\t\titemSection = itemIndices.map(i =>\n\t\t\t<ItemEdit\n\t\t\t\tkey={i}\n\t\t\t\tindex={i}\n\t\t\t\tappActions={appActions}\n\t\t\t/>\n\t\t);\n\t} else {\n\t\titemSection = [];\n\t\tfor (let i = 0; i < itemIndices.length; i += 4) {\n\t\t\tconst row =\n\t\t\t\t<tr key={i}>\n\t\t\t\t\t{[i, i + 1, i + 2, i + 3].map(i => {\n\t\t\t\t\t\tif (i >= itemIndices.length) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst index = itemIndices[i];\n\t\t\t\t\t\tconst name = getItemNameByIndex(index);\n\t\t\t\t\t\tconst delta = deltas ? deltas[name] : undefined;\n\t\t\t\t\t\treturn <ItemDisplay key={i} index={itemIndices[i]} delta={delta} />;\n\t\t\t\t\t})}\n\t\t\t\t</tr>;\n\t\t\titemSection.push(row);\n\t\t}\n\t}\n\treturn (\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t{itemSection}\n\t\t\t\t<tr key=\"new_item_button\">\n\t\t\t\t\t<td colSpan={5}>\n\t\t\t\t\t\t<button onClick={() => {\n\t\t\t\t\t\t\tif (itemCount >= ITEM_LIMIT) {\n\t\t\t\t\t\t\t\tconst message = `You have reached the maximum number of items (${ITEM_LIMIT})`;\n\t\t\t\t\t\t\t\tappActions.showAlert(message);\n\t\t\t\t\t\t\t\tactions.setInfo({ info: message });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst startTime = benchStart();\n\t\t\t\t\t\t\t\tactions.createItem({\n\t\t\t\t\t\t\t\t\tindex: itemCount\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tactions.setInfo({ info: `Item created. (${benchEnd(startTime)} ms)` });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}>New Item</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\n\t\t</table>\n\t);\n};\n\nexport default connector(ItemList);","import ItemList from \"components/item/ItemList\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { AppAction } from \"App\";\nimport { ReduxGlobalState } from \"store/store\";\nimport {\n\tgetResourceCalcError,\n\tgetResourceCalcProgress,\n\tisResourcesSectionCollapsed,\n\tisEditingItems,\n\tisOnlyShowingChangedResources,\n\n} from \"store/application/selectors\";\nimport { setItemFilter } from \"store/setting/actions\";\nimport { getItemFilter } from \"store/setting/selectors\";\nimport {\n\tsetEditingItems,\n\tsetShowOnlyChangedResources,\n\tsetResourcesCollapsed,\n} from \"store/application/actions\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport {\n\tgetTotalActionCount,\n\tgetActiveActionName,\n} from \"store/routing/selectors\";\nimport React from \"react\";\nimport ExpandButton from \"components/ExpandButton\";\nimport { BoxLayout, SplitLayout } from \"components/Layout\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\tactiveActionName: getActiveActionName(state),\n\tresourcesCollapsed: isResourcesSectionCollapsed(state),\n\tediting: isEditingItems(state),\n\tprogress: getResourceCalcProgress(state),\n\ttotal: getTotalActionCount(state),\n\terror: getResourceCalcError(state),\n\tfilterString: getItemFilter(state),\n\tonlyShowChanging: isOnlyShowingChangedResources(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetEditingItems,\n\t\tsetItemFilter,\n\t\tsetShowOnlyChangedResources,\n\t\tsetResourcesCollapsed,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nconst Items: React.FunctionComponent<Props> = ({\n\tresourcesCollapsed, editing, actions, appActions, filterString, progress, total, error, onlyShowChanging, activeActionName\n}: Props) => {\n\tconst collapsed = resourcesCollapsed;\n\tconst expandButton = <ExpandButton\n\t\texpanded={!collapsed} setExpanded={(expanded) => actions.setResourcesCollapsed({ collapsed: !expanded })}\n\t/>;\n\tconst buttonSection =\n\t\t<>\n\t\t\t<button className=\"space-left-small\" onClick={() => actions.setEditingItems({ editing: !editing })}>{editing ? \"Finish\" : \"Edit\"}</button>\n\n\t\t\t<input\n\t\t\t\tclassName=\"space-left-small\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tvalue={filterString}\n\t\t\t\tplaceholder=\"Filter (use , to separate)\"\n\t\t\t\tonChange={(e) => actions.setItemFilter({ filter: e.target.value })}\n\t\t\t/>\n\t\t\t<button className=\"space-left-small icon-button\" title=\"Clear\" onClick={() => actions.setItemFilter({ filter: \"\" })}>X</button>\n\t\t\t{activeActionName && <>\n\t\t\t\t<input\n\t\t\t\t\tid=\"show_only_changed_checkbox\"\n\t\t\t\t\tclassName=\"space-left-small\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tchecked={onlyShowChanging}\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tactions.setShowOnlyChangedResources({ showOnlyChangedResources: e.target.checked });\n\t\t\t\t\t}} />\n\t\t\t\t<label htmlFor=\"show_only_changed_checkbox\">Show Only Changed</label></>\n\t\t\t}\n\t\t</>;\n\n\tlet resourceInfo;\n\tif (error === null) {\n\t\tif (progress === total || total === 0) {\n\t\t\tresourceInfo = <span>Resource up to date</span>;\n\t\t} else {\n\t\t\tresourceInfo = <span>Updating Resources... ({progress}/{total})</span>;\n\t\t}\n\t} else {\n\t\tresourceInfo = <span className=\"deltastr-error\" title={error.message}>{error.message}</span>;\n\t}\n\tconst title = <strong>Resources {activeActionName && ` - ${activeActionName}`}</strong>;\n\tif (resourcesCollapsed) {\n\t\treturn (\n\t\t\t<BoxLayout className=\"component border\">\n\t\t\t\t{expandButton}\n\t\t\t\t{title}\n\n\t\t\t</BoxLayout>\n\t\t);\n\t} else {\n\t\treturn (\n\t\t\t<SplitLayout size=\"3.2rem\" className=\"component border\">\n\t\t\t\t<BoxLayout className=\"component header-border overflow-hidden\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{expandButton}\n\t\t\t\t\t\t{title}\n\n\t\t\t\t\t\t{buttonSection}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{resourceInfo}\n\t\t\t\t\t</div>\n\t\t\t\t</BoxLayout>\n\t\t\t\t<BoxLayout className=\"overflow-auto\">\n\t\t\t\t\t<ItemList appActions={appActions} />\n\t\t\t\t</BoxLayout>\n\t\t\t</SplitLayout>\n\t\t);\n\t}\n\n};\n\nexport default connector(Items);","import { ActionDelta } from \"./delta\";\nimport store, { ReduxGlobalState } from \"store/store\";\nimport { getActionResourceByGlobalIndex, getResourceCalcError, getResourceCalcProgress } from \"store/application/selectors\";\nimport { getActionDeltaError, getActionDeltas, getActionIndexFromGlobal, getActionName, getBranchName, getGlobalActionIndex, getSplitName, getTotalActionCount } from \"store/routing/selectors\";\nimport { markResourceDirtyAt, setResourceContent, setResourceError } from \"store/application/actions\";\n\nexport type RouteResources = {\n\terror: ResourceError,\n\tcontent: ActionResource[],\n\tprogress: number,\n}\n\nexport type ResourceError = {\n\tbranch: number,\n\tsplit: number,\n\taction: number,\n\tmessage: string,\n} | null;\n\nexport type ActionResource = Record<string, ActionResourceItem>\nexport type ActionResourceItem = {\n\tvalue: number,\n\tchange: number,\n}\n\nlet handle: NodeJS.Timeout | undefined = undefined;\n\nexport function startResourceCalcClock(): void {\n\tstopResourceCalcClock();\n\thandle = setInterval(update, 100);\n}\n\nexport function stopResourceCalcClock(): void {\n\tif (handle !== undefined) {\n\t\tclearInterval(handle);\n\t}\n}\n\nfunction update() {\n\tif (!store.getState()) {\n\t\treturn;\n\t}\n\tconst state = store.getState();\n\tconst currentlyNeedToUpdate = getResourceCalcProgress(state);\n\tconst total = getTotalActionCount(state);\n\tif (total !== 0 && currentlyNeedToUpdate < total) {\n\t\tupdateAt(state, currentlyNeedToUpdate);\n\t}\n}\n\nfunction updateAt(state: ReduxGlobalState, currentlyNeedToUpdate: number) {\n\tif (currentlyNeedToUpdate < 0) {\n\t\tcurrentlyNeedToUpdate = 0;\n\t}\n\n\tconst error = getResourceCalcError(state);\n\tif (error !== null) {\n\t\tconst { branch, split, action } = error;\n\t\tconst errorGlobalIndex = getGlobalActionIndex(state, branch, split, action);\n\t\tif (currentlyNeedToUpdate > errorGlobalIndex) {\n\t\t\tstore.dispatch(setResourceContent({ globalIndex: currentlyNeedToUpdate, content: {} }));\n\t\t\treturn;\n\t\t}\n\t}\n\tlet before: ActionResource = {};\n\tif (currentlyNeedToUpdate > 0) {\n\t\tconst resourceBefore = getActionResourceByGlobalIndex(state, currentlyNeedToUpdate - 1);\n\t\tif (resourceBefore === undefined) {\n\t\t\tstore.dispatch(markResourceDirtyAt({ globalIndex: currentlyNeedToUpdate - 1 }));\n\t\t\treturn;\n\t\t}\n\t\tbefore = resourceBefore;\n\t}\n\tconst [branch, split, action] = getActionIndexFromGlobal(state, currentlyNeedToUpdate);\n\tconst deltas = getActionDeltas(state, branch, split, action);\n\tconst deltaError = getActionDeltaError(state, branch, split, action);\n\tif (deltaError !== null || deltas === null) {\n\t\tconst branchName = getBranchName(state, branch);\n\t\tconst splitName = getSplitName(state, branch, split);\n\t\tconst actionName = getActionName(state, branch, split, action);\n\t\tconst resourceError: ResourceError = {\n\t\t\tbranch,\n\t\t\tsplit,\n\t\t\taction,\n\t\t\tmessage: `Error in branch \"${branchName}\", split \"${splitName}\", action \"${actionName}\"`,\n\t\t};\n\t\tstore.dispatch(setResourceError({ error: resourceError }));\n\t\tstore.dispatch(setResourceContent({ globalIndex: currentlyNeedToUpdate, content: {} }));\n\t\treturn;\n\t}\n\n\tconst after = calculateChange(before, deltas);\n\tstore.dispatch(setResourceContent({ globalIndex: currentlyNeedToUpdate, content: after }));\n}\n\nfunction calculateChange(before: ActionResource, deltas: ActionDelta): ActionResource {\n\tconst getAmountInBefore = (n: string) => n in before ? before[n].value : 0;\n\tconst after: ActionResource = {};\n\tfor (const name in before) {\n\t\tafter[name] = {\n\t\t\tvalue: before[name].value,\n\t\t\tchange: 0,\n\t\t};\n\t}\n\tfor (const name in deltas) {\n\t\tconst { type, value } = deltas[name];\n\t\tconst oldAmount = getAmountInBefore(name);\n\t\tlet newAmount: number;\n\t\tlet change: number;\n\t\tswitch (type) {\n\t\t\tcase \"add\":\n\t\t\t\tchange = Number(value) ?? 0;\n\t\t\t\tnewAmount = oldAmount + change;\n\t\t\t\tbreak;\n\t\t\tcase \"set\":\n\t\t\t\tnewAmount = Number(value) ?? 0;\n\t\t\t\tchange = newAmount - oldAmount;\n\t\t\t\tbreak;\n\t\t\tcase \"ref_add\":\n\t\t\t\tchange = getAmountInBefore(value.toString());\n\t\t\t\tnewAmount = oldAmount + change;\n\t\t\t\tbreak;\n\t\t\tcase \"ref_sub\":\n\t\t\t\tchange = -getAmountInBefore(value.toString());\n\t\t\t\tnewAmount = oldAmount + change;\n\t\t\t\tbreak;\n\t\t\tcase \"ref_set\":\n\t\t\t\tnewAmount = getAmountInBefore(value.toString());\n\t\t\t\tchange = newAmount - oldAmount;\n\t\t}\n\t\tafter[name] = {\n\t\t\tvalue: newAmount,\n\t\t\tchange,\n\t\t};\n\t}\n\treturn after;\n}","import { setInfo } from \"store/application/actions\";\nimport store from \"store/store\";\nimport { storeToLocalStorage } from \"./storage\";\n\nlet handle: NodeJS.Timeout | undefined = undefined;\n\nexport function startAutoSaveClock(): void {\n\tstopAutoSaveClock();\n\thandle = setInterval(save, 20000);\n}\n\nexport function stopAutoSaveClock(): void {\n\tif (handle !== undefined) {\n\t\tclearInterval(handle);\n\t}\n}\n\nfunction save() {\n\tif (!store.getState()) {\n\t\treturn;\n\t}\n\tconst state = store.getState();\n\tif (state.settingState.autoSave) {\n\t\tstoreToLocalStorage(state.routeState, state.settingState);\n\t\tstore.dispatch(setInfo({ info: `Last saved to local storage: ${new Date()}` }));\n\t}\n}","import { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport { AppAction } from \"App\";\nimport { downloadToFile, exportAsEncoded, exportAsJson, importAsEncoded, importAsJson, readFromFile } from \"data/storage\";\nimport { useState } from \"react\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { setRouteState } from \"store/routing/actions\";\nimport { getProjectName, getRouteState } from \"store/routing/selectors\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { setInfo, markResourceDirtyAt } from \"store/application/actions\";\nimport { RouteState } from \"store/routing/type\";\n\ntype ExternalProps = {\n\tappActions: AppAction,\n}\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\trouteState: getRouteState(state),\n\tdownloadName: getProjectName(state) || \"Routing\",\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetRouteState,\n\t\tsetInfo,\n\t\tmarkResourceDirtyAt,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector> & ExternalProps;\n\nconst IODialog: React.FunctionComponent<Props> = ({ routeState, downloadName, appActions, actions }) => {\n\tconst [file, setFile] = useState<FileList | null>(null);\n\n\tconst importFunc = (theFile: File, importer: (str: string) => [RouteState | null, string | null]): void => {\n\t\treadFromFile(theFile, result => {\n\t\t\tconst [state, error] = importer(result);\n\t\t\tif (error !== null || state === null) {\n\t\t\t\tappActions.showIODialog(false);\n\t\t\t\tappActions.showAlert(`Error on import: ${error}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tactions.setRouteState({ routeState: state });\n\t\t\tactions.markResourceDirtyAt({ globalIndex: 0 });\n\t\t\tappActions.showIODialog(false);\n\t\t\tactions.setInfo({ info: \"Imported.\" });\n\t\t});\n\t};\n\n\treturn <div>\n\t\t<div>\n\t\t\t<p><strong>Export</strong></p>\n\t\t\t<hr />\n\t\t\tExport As:\n\t\t\t<button className=\"space-left-small\" onClick={() => {\n\t\t\t\tconst string = exportAsEncoded(routeState);\n\t\t\t\tdownloadToFile(downloadName, string, \"txt\");\n\t\t\t}}>Base64 (.txt)</button>\n\t\t\t<button className=\"space-left-small\" disabled>Compressed (.txt)</button>\n\t\t\t<button className=\"space-left-small\" onClick={() => {\n\t\t\t\tconst string = exportAsJson(routeState);\n\t\t\t\tdownloadToFile(downloadName, string, \"json\");\n\t\t\t}}>JSON (.json) [Recommended]</button>\n\t\t\t<button className=\"space-left-small\" disabled>Text (.txt)</button>\n\t\t\t<button className=\"space-left-small\" disabled>LiveSplit (.lss)</button>\n\n\t\t\t<hr />\n\t\t\t<p><strong>Import</strong></p>\n\t\t\t<hr />\n\t\t\t<input className=\"vertical-center space-left-small\" type=\"file\" onChange={(e) => {\n\t\t\t\tsetFile(e.target.files);\n\t\t\t}} />\n\t\t\t<br />\n\t\t\tImport As:\n\t\t\t<button className=\"space-left-small\" disabled={file === null} onClick={() => {\n\t\t\t\tif (file === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\timportFunc(file[0], importAsEncoded);\n\t\t\t}}>Base64 (.txt)</button>\n\t\t\t<button className=\"space-left-small\" disabled>Compressed (.txt)</button>\n\t\t\t<button className=\"space-left-small\" disabled={file === null} onClick={() => {\n\t\t\t\tif (file === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\timportFunc(file[0], importAsJson);\n\t\t\t}}>JSON (.json)</button>\n\t\t</div>\n\t</div>;\n};\n\nexport default connector(IODialog);","import { BoxLayout } from \"components/Layout\";\nimport React from \"react\";\n\nconst Help: React.FunctionComponent = () =>\n\t<BoxLayout className=\"component border overflow-auto\">\n\t\t<div className=\"help-doc\">\n\t\t\t<h1>Resource Routing Tool</h1>\n\t\t\t<p>\n\t\t\t\tThis tool is very useful for tracking various resources needed in a speedrun.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tYou might say: <em> \"Why don't I just use a spreadsheet?\" </em>\n\t\t\t\tThis tool has some unique features that makes it better than a normal spreadsheet:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>The robust algorithm keeps the route <strong>consistent</strong> while <strong>moving splits and branches around.</strong></li>\n\t\t\t\t\t<li>Easy-to-use syntax to define and organize your items. <strong>No complex formulas</strong></li>\n\t\t\t\t\t<li>Export your route as TXT, JSON, or to <strong>LiveSplit</strong> [WIP]</li>\n\t\t\t\t</ul>\n\t\t\t</p>\n\t\t\t<h2>Getting Started</h2>\n\t\t\t<p>\n\t\t\t\tThe data structure of the tool is very intuitive: there are <strong>branches</strong>, <strong>splits</strong>, and <strong>actions</strong>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tIf you are into speedrun. You already know what a split is. Branches are basically groups of splits.\n\t\t\t\tActions are what you do in the split that affects the resources you track.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tFor example, a typical section of the run could be like this:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Tutorial Levels</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\tMain Area\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>Dungeon A</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\tDungeon B\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li>Pick up 5 of Item 1</li>\n\t\t\t\t\t\t\t\t\t<li>Fight Monster X</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\tDungeon C\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li>Use 3 of Item 2</li>\n\t\t\t\t\t\t\t\t\t<li>Fight Monster Y</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>Final Boss</li>\n\t\t\t\t</ul>\n\t\t\t</p>\n\t\t\t<h2>Branch and Splits</h2>\n\t\t\t<p>\n\t\t\t\tYou can use the side panel to organize your branches and splits.\n\t\t\t\tUse the \"Edit\" button to enter editing mode, where you can move branches and splits, rename them, or delete them.\n\t\t\t\tWhen you click on a split, you will enter that split and can then edit the actions in the splits.\n\t\t\t</p>\n\n\t\t\t<h2>Items and Delta String</h2>\n\t\t\t<p>During the run, each action may affect the current resources the player possesses.\n\t\t\t\tThis tool is organized in the same way.</p>\n\t\t\t<p>\n\t\t\t\tEach action in a split has a <strong>delta string</strong> that is used to define the resources changes as a result of that action.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo define a delta string, you first must define the items. Follow the steps below to define an item:\n\t\t\t\t<ol>\n\t\t\t\t\t<li>Click on \"New Item\" under the \"Resources\" section</li>\n\t\t\t\t\t<li>Click on \"Edit\" next to \"Resources\"</li>\n\t\t\t\t\t<li>Enter the item name and press the \"R\" button next to the text box to rename the item</li>\n\t\t\t\t\t<li>Click on \"Finish\" to exit the editing mode</li>\n\t\t\t\t</ol>\n\t\t\t\tNow that you have defined your first item. It's time to write some delta strings.\n\t\t\t</p>\n\t\t\t<h2>Delta String Syntax</h2>\n\t\t\t<p>The basic syntax for the delta string is <code>[(item)](operator)(quantity)</code></p>\n\t\t\t<ol>\n\t\t\t\t<li><code>item</code>: The name of the item</li>\n\t\t\t\t<li><code>operator</code>: One of <code>+</code>, <code>-</code>, <code>=</code></li>\n\t\t\t\t<li><code>quantity</code>: How much to change</li>\n\t\t\t</ol>\n\t\t\t<p>For example, <code>[Apple]+5</code> means adding 5 apples to the resources during this action.\n\t\t\t(Given that <code>Apple</code> is defined in the Resources section)</p>\n\t\t\t<p>Similarly, <code>[Orange]-3</code> means subtracting 3 oranges, and <code>[Banana]=5</code> means setting the quantity of bananas to 5</p>\n\t\t\t<p>\n\t\t\t\tYou can also use reference to the quantity of another item.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tFor example, <code>[Rock]+[Wood]</code> means adding as many woods to rocks. If you have 5 woods and 8 rocks, you will now have 5 woods and 13 rocks.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThe reference is done in parallel. So, <code>[Rock]=[Wood], [Wood]=[Rock]</code> will swap the quantities of woods and rocks.\n\t\t\t</p>\n\t\t\t<p>(Oh yeah, if you haven't already realize, use <code>,</code> to separate multiple items like the example above)</p>\n\t\t\t<h2>Track Resources</h2>\n\t\t\t<p>\n\t\t\t\tYou can use the Resources section to see all the resources defined.\n\t\t\t\tUse the filter text box to filter them.\n\t\t\t\tMultiple search word can be separated with comma (,). The search will give any item that contains any of the search words.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tWhen you click on an action. <strong>You are focused to that action. </strong> The Resources section will now also show how the items changed in during that action, as well as the quantity <strong>after</strong> the action is done.\n\t\t\t</p>\n\t\t\t<p>When your route gets longer. You may notice that the resource tracker takes time to finish calculating all the resources. When it's calculating, you can continue editing the route. However, the tracking result may not be accurate when it's not done calculating. Especially if it is something you just edited.</p>\n\t\t\t<h2>FAQ</h2>\n\t\t\t<p>I will put whatever questions people ask me here.</p>\n\t\t\t<p><strong>Q: Why are some buttons disabled?</strong></p>\n\t\t\t<p>A: I didn't finish implementing them</p>\n\t\t\t<h2>Other</h2>\n\t\t\t<p>Source on <a href=\"https://github.com/resource-routing/resource-routing.github.io\">Github</a></p>\n\t\t</div>\n\t</BoxLayout>\n\t;\n\nexport default Help;","import React from \"react\";\nimport \"./App.css\";\nimport SideNav from \"sections/SideNav\";\nimport Header from \"sections/Header\";\nimport Footer from \"sections/Footer\";\nimport Actions from \"sections/Actions\";\nimport {\n\tisHeaderCollapsed,\n\tisResourcesSectionCollapsed,\n\tisShowingHelp,\n\tisSideSectionCollapsed,\n} from \"store/application/selectors\";\nimport {\n\tsetInfo,\n\tmarkResourceDirtyAt,\n} from \"store/application/actions\";\nimport {\n\tsetRouteState,\n} from \"store/routing/actions\";\nimport { setSettingState } from \"store/setting/actions\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { bindActionCreators, Dispatch } from \"@reduxjs/toolkit\";\nimport Alert from \"dialog/Alert\";\nimport Items from \"sections/Items\";\nimport { startResourceCalcClock, stopResourceCalcClock } from \"data/resource\";\nimport { loadfromLocalStorage } from \"data/storage\";\nimport { ReduxGlobalState } from \"store/store\";\nimport { startAutoSaveClock, stopAutoSaveClock } from \"data/autosave\";\nimport IODialog from \"dialog/IODialog\";\nimport Help from \"sections/Help\";\nimport { BoxLayout, SplitLayout, WindowLayout } from \"components/Layout\";\n\nconst mapStateToProps = (state: ReduxGlobalState) => ({\n\theaderCollapsed: isHeaderCollapsed(state),\n\tsideCollapsed: isSideSectionCollapsed(state),\n\tresourceCollapsed: isResourcesSectionCollapsed(state),\n\tshowHelp: isShowingHelp(state),\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\n\tactions: bindActionCreators({\n\t\tsetRouteState,\n\t\tsetInfo,\n\t\tsetSettingState,\n\t\tmarkResourceDirtyAt,\n\t}, dispatch)\n});\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector>;\ntype State = {\n\talertContent?: React.ReactNode,\n\talertActions: AlertOption[],\n\tshowIOAlert: boolean,\n\twindowWidth: number,\n}\n\nexport type AlertOption = {\n\tname: string,\n\texecute?: () => void\n}\nexport type AppAction = {\n\tshowAlert: (content?: React.ReactNode, actions?: AlertOption[]) => void,\n\tshowIODialog: (show?: boolean) => void,\n}\n\nclass App extends React.Component<Props, State> {\n\tconstructor(props: Props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\talertContent: undefined,\n\t\t\talertActions: [],\n\t\t\tshowIOAlert: false,\n\t\t\twindowWidth: window.innerWidth,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"resize\", this.updateWindowWidth.bind(this));\n\t\tthis.updateWindowWidth();\n\t\tconst [storedState, settings] = loadfromLocalStorage();\n\t\tif (storedState) {\n\t\t\tthis.props.actions.setRouteState({ routeState: storedState });\n\t\t\tthis.props.actions.markResourceDirtyAt({ globalIndex: 0 });\n\t\t\tthis.props.actions.setInfo({ info: \"Loaded from local storage\" });\n\t\t} else {\n\t\t\tthis.props.actions.setInfo({ info: \"Failed to load from local storage. Loaded empty project.\" });\n\t\t}\n\t\tif (settings) {\n\t\t\tthis.props.actions.setSettingState({ settingState: settings });\n\t\t}\n\t\tstartResourceCalcClock();\n\t\tstartAutoSaveClock();\n\t}\n\n\tupdateWindowWidth() {\n\t\tthis.setState({ windowWidth: window.innerWidth });\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"resize\", this.updateWindowWidth.bind(this));\n\t\tstopResourceCalcClock();\n\t\tstopAutoSaveClock();\n\t}\n\n\tshowAlert(content: React.ReactNode = undefined, actions: AlertOption[] = [{ name: \"OK\" }]): void {\n\t\tthis.setState({\n\t\t\talertContent: content,\n\t\t\talertActions: actions,\n\t\t});\n\t}\n\n\trenderHeaderAndSide(headerCollapsed: boolean, appActions: AppAction): React.ReactNode {\n\t\treturn (\n\t\t\t<SplitLayout size={headerCollapsed ? \"3.5rem\" : \"10rem\"}>\n\t\t\t\t<BoxLayout className=\"component border\">\n\t\t\t\t\t<Header appActions={appActions} />\n\t\t\t\t</BoxLayout>\n\t\t\t\t<SideNav appActions={appActions} />\n\t\t\t</SplitLayout>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst appActions: AppAction = {\n\t\t\tshowAlert: this.showAlert.bind(this),\n\t\t\tshowIODialog: (show = true) => this.setState({ showIOAlert: show }),\n\t\t};\n\n\t\tconst {\n\t\t\tshowHelp,\n\t\t\theaderCollapsed,\n\t\t\tsideCollapsed,\n\t\t\tresourceCollapsed,\n\t\t} = this.props;\n\n\t\tconst headerAndSideSection = this.renderHeaderAndSide(headerCollapsed, appActions);\n\t\tconst mainSection = showHelp ? <Help /> : <Actions appActions={appActions} />;\n\t\tconst itemSection = <Items appActions={appActions} />;\n\t\tlet mainWindowLayout;\n\t\tif (this.state.windowWidth < 1000) {\n\t\t\tmainWindowLayout =\n\t\t\t\t<SplitLayout base=\"second\" size={resourceCollapsed ? \"1.8rem\" : \"30%\"} min={resourceCollapsed ? undefined : \"12rem\"}>\n\t\t\t\t\t<SplitLayout\n\t\t\t\t\t\tdirection=\"horizontal\"\n\t\t\t\t\t\tsize={sideCollapsed ? \"2rem\" : \"30%\"}\n\t\t\t\t\t\tmin={sideCollapsed ? \"2rem\" : \"16rem\"}\n\t\t\t\t\t\tmax={sideCollapsed ? \"2rem\" : \"24rem\"} >\n\t\t\t\t\t\t{headerAndSideSection}\n\t\t\t\t\t\t{mainSection}\n\t\t\t\t\t</SplitLayout>\n\t\t\t\t\t{itemSection}\n\t\t\t\t</SplitLayout>;\n\t\t} else {\n\t\t\tmainWindowLayout =\n\t\t\t\t<SplitLayout\n\t\t\t\t\tdirection=\"horizontal\"\n\t\t\t\t\tsize={sideCollapsed ? \"2rem\" : \"30%\"}\n\t\t\t\t\tmin={sideCollapsed ? \"2rem\" : \"16rem\"}\n\t\t\t\t\tmax={sideCollapsed ? \"2rem\" : \"24rem\"} >\n\t\t\t\t\t{headerAndSideSection}\n\t\t\t\t\t<SplitLayout base=\"second\" size={resourceCollapsed ? \"1.8rem\" : \"30%\"} min={resourceCollapsed ? undefined : \"12rem\"}>\n\t\t\t\t\t\t{mainSection}\n\t\t\t\t\t\t{itemSection}\n\t\t\t\t\t</SplitLayout>\n\t\t\t\t</SplitLayout>;\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<WindowLayout>\n\t\t\t\t\t<SplitLayout base=\"second\" size=\"1.5rem\">\n\t\t\t\t\t\t{mainWindowLayout}\n\t\t\t\t\t\t<BoxLayout className=\"component border\">\n\t\t\t\t\t\t\t<Footer />\n\t\t\t\t\t\t</BoxLayout>\n\t\t\t\t\t</SplitLayout>\n\t\t\t\t</WindowLayout>\n\t\t\t\t<Alert content={this.state.alertContent} alertActions={this.state.alertActions} actions={{\n\t\t\t\t\thideAlert: () => this.showAlert()\n\t\t\t\t}} />\n\t\t\t\t<Alert content={this.state.showIOAlert ? <IODialog appActions={appActions} /> : undefined} alertActions={[{ name: \"Close\" }]} actions={{\n\t\t\t\t\thideAlert: () => this.setState({ showIOAlert: false })\n\t\t\t\t}} />\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport store from \"store/store\";\nimport { Provider } from \"react-redux\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Provider store={store}>\n\t\t\t<App />\n\t\t</Provider>\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\n"],"sourceRoot":""}