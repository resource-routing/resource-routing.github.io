{"version":3,"sources":["sections/components/Box.js","sections/components/ExpandButton.js","sections/components/ActionSummary.js","sections/components/util/actiondelta.js","sections/components/util/storage.js","sections/components/util/data.js","sections/components/Split.js","sections/components/SplitList.js","sections/components/Branch.js","sections/components/BranchList.js","sections/SideNav.js","sections/components/util/benchmark.js","sections/Header.js","sections/components/util/layout.js","sections/Footer.js","sections/components/DeltaList.js","sections/components/ActionItem.js","sections/components/ActionList.js","sections/Actions.js","sections/Alert.js","sections/components/util/color.js","sections/components/ItemList.js","sections/Items.js","App.js","index.js"],"names":["Box","layout","children","borderClass","className","clsx","style","position","top","y","left","x","width","w","height","h","ExpandButton","expanded","setExpanded","onClick","ActionSummary","actions","b","s","map","action","i","deltaString","name","deltaToString","deltas","array","push","itemToString","join","item","op","type","value","quantity","startsWith","stringToDelta","str","length","trim","split","e","deltaObj","errors","forEach","nameEnd","indexOf","substring","endsWith","ref","num","Number","isInteger","parseDeltaItem","itemError","KEY","readFromLocalStorage","localStorage","getItem","stringToState","JSON","parse","state","sanitizeState","branches","branch","splits","delta","error","deltaError","undefined","projectName","activeSplit","activeBranch","activeAction","items","sanitizeIndex","sanitizeArray","sanitizeBranch","sanitizeItem","template","clean","sanitizeSplit","sanitizeAction","types","copy","key","t","includes","toString","sanitizeDelta","color","minimize","createBranchAt","index","branchesCopy","deepCopyBranches","newBranch","splice","newActiveBranch","swapBranches","j","temp","setBranchPropertyAt","property","createSplitAt","bIndex","splitTemplate","newSplit","newActiveSplit","swapSplits","si","sj","setSplitPropertyAt","sIndex","setActionPropertyAt","newDelta","applyActionDeltaStringEdit","getPreviousActionIndices","a","prevS","prevB","prevA","createItem","itemsCopy","deepCopyItems","newItem","setItemPropertyAt","itemIndex","oldValue","oldName","newName","renameItemInDelta","renameItemInDeltaString","deepCopyResources","resources","content","branchContent","splitContent","actionContent","deepCopyResourceContent","applyDelta","resource","Split","branchIndex","isLast","isLastBranch","isFirstBranch","editing","splitActions","setEditing","displayName","splitNode","title","doToBranches","lowSplits","slice","colSpan","placeholder","onChange","target","openSplit","copySplit","disabled","moveFirstSplitOfBranchToPreviousBranch","lastIndex","moveLastSplitOfBranchToNextBranch","displayAlert","hideAlert","deleteSplitAt","splitClipboard","concat","SplitList","splitNodes","oldSplitSize","len","Branch","branchNode","deleteBranchAt","BranchList","SideNav","props","enabled","this","setState","buttonSection","setEditEnabled","branchSection","bind","main","sideCollapsed","header","setSideCollapsed","React","Component","benchmarkTime","Date","getTime","benchmarkDelta","start","Header","autoSave","headerCollapsed","useState","file","setFile","exportButton","download","saveButton","saveStateToLocalStorage","setProjectName","prompt","console","log","files","startTime","storedStateCallback","reader","FileReader","onloadend","result","readAsText","readFromFile","storedState","loadStoredState","setAutoSave","allButtons","setHeaderCollapsed","calc","min","max","resourceCollapsed","windowWidth","windowHeight","HEADER_HEIGHT","FOOTER_HEIGHT","SIDE_HEADER_HEIGHT","RESOURCE_WIDTH_SHRINK","RESOURCE_HEADER_HEIGHT","shrink","window","innerWidth","noResources","centerHeight","sideWidth","mainWidth","resourceHeight","mapHeight","actionWidth","actionY","side","footer","hide","Footer","text","DeltaItem","create","parseColor","backgroundColor","DeltaList","deltaItems","ActionItem","splitIndex","actionNode","ActionList","actionList","resourceError","message","newAction","newActiveAction","Actions","resourcesCollapsed","splitName","actionSection","setResourcesCollapsed","Alert","okText","cancelText","onOk","onCancel","boxSizing","padding","bottom","right","shouldMakeTextWhiteForBackground","htmlColor","toLowerCase","replace","isNaN","getComputedStyle","div","document","getElementById","rgb","htmlColorToRGB","linerize","c","ItemDisplay","ItemEdit","doToItems","change","ItemList","filter","filterObj","f","itemSection","filteredItems","Items","resourceInfo","actionResources","lastActionResources","setFilter","collapsed","App","info","dimensions","dirtyBranch","dirtySplit","dirtyAction","autoSaveHandle","onAlertOk","onAlertCancel","alertOkText","alertCancelText","alertText","resourceUpdateHandle","clearTimeout","resourcesCopy","tryClearResourceErrorFrom","handle","setTimeout","doCalcResources","finishResourceUpdate","newResources","newContent","errorMessage","calculateResourcesAt","addEventListener","calculateDimensions","setInterval","clearInterval","setInformation","storedStateLoadFunction","recalculateResources","stringify","setItem","saveToLocalStorage","getStateToStore","itmes","removeEventListener","transitionFunction","doRecalculate","blob","Blob","createElement","fileName","href","URL","createObjectURL","dataset","downloadurl","display","body","appendChild","click","removeChild","revokeObjectURL","downloadToFile","downloadStateToFile","showAction","src","ReactDOM","render","StrictMode"],"mappings":"uRACe,SAASA,EAAT,GAAiD,IAAlCC,EAAiC,EAAjCA,OAAQC,EAAyB,EAAzBA,SAAUC,EAAe,EAAfA,YAC/C,OACC,qBAAKC,UAAWC,YAAK,YAAaF,GACjCG,MAAO,CACNC,SAAU,WACVC,IAAKP,EAAOQ,EACZC,KAAMT,EAAOU,EACbC,MAAOX,EAAOY,EACdC,OAAQb,EAAOc,GANjB,SAQEb,ICXW,SAASc,EAAT,GAAkD,IAA1BC,EAAyB,EAAzBA,SAAUC,EAAe,EAAfA,YAChD,OACC,wBAAQd,UAAU,cAAce,QAAS,kBAAMD,GAAaD,IAA5D,SAAwEA,EAAW,IAAM,MCF5E,SAASG,EAAT,GAA2C,IAAlBC,EAAiB,EAAjBA,QAASC,EAAQ,EAARA,EAAGC,EAAK,EAALA,EACnD,OAAOF,EAAQG,KAAI,SAACC,EAAQC,GAAT,OAClB,+BACC,uBAAS,uBACT,oBAAItB,UAAU,oBAAd,eACA,6BACGqB,EAAOE,YAAuCF,EAAOG,KAAhC,6BAAKH,EAAOG,WAJrC,YAAcN,EAAd,cAAqBC,EAArB,cAA4BG,EAA5B,S,MCFK,SAASG,EAAcC,GAC7B,IAAMC,EAAQ,GACd,IAAK,IAAMH,KAAQE,EAClBC,EAAMC,KAAKC,EAAaL,EAAME,EAAOF,KAEtC,OAAOG,EAAMG,KAAK,MAiBnB,SAASD,EAAaL,EAAMO,GAAO,IAE9BC,EADIC,EAAgBF,EAAhBE,KAAMC,EAAUH,EAAVG,MAEd,OAAQD,GACP,IAAK,MAEHD,EADGE,GAAS,EACP,IAEA,IAEN,MACD,IAAK,MACL,IAAK,UAGL,IAAK,UACJF,EAAK,IACL,MACD,IAAK,UACJA,EAAK,IACL,MACD,QAASA,EAAK,IAEf,IAAIG,EAAWD,EAIf,OAHID,EAAKG,WAAW,SACnBD,EAAQ,WAAOD,EAAP,MAEH,IAAN,OAAWV,EAAX,YAAmBQ,GAAnB,OAAwBG,GAGV,SAASE,EAAcC,GACrC,IAAKA,IAAQA,EAAIC,OAAQ,MAAO,CAAC,KAAM,sBACvC,IAAKD,EAAIE,OAAQ,MAAO,CAAC,KAAM,sBAE/B,IAAMb,EAAQW,EAAIG,MAAM,KAAKrB,KAAI,SAAAsB,GAAC,OAAIA,EAAEF,UAClCG,EAAW,GACbC,EAAS,GAeb,OAdAjB,EAAMkB,SAAQ,SAAAP,GAAQ,IAAD,EAiBtB,SAAwBA,GAEvB,IAAKA,IAAQA,EAAIC,OAAQ,MAAO,CAAC,KAAM,MACvC,IAAKD,EAAIF,WAAW,KAAM,MAAO,CAAC,KAAD,mBAAmBE,IACpD,IAAMQ,EAAUR,EAAIS,QAAQ,KAC5B,GAAID,EAAU,EAAG,MAAO,CAAC,KAAD,wCAAwCR,IAChE,IAAMd,EAAOc,EAAIU,UAAU,EAAGF,GAC9B,GAAIR,EAAIC,QAAUO,EAAU,EAAG,MAAO,CAAC,KAAD,gBAAgBtB,EAAhB,oCACtC,IAAMQ,EAAKM,EAAIQ,EAAU,GACnBZ,EAAQI,EAAIU,UAAUF,EAAU,GAEtC,GAAIZ,EAAME,WAAW,KAAM,CAC1B,IAAKF,EAAMe,SAAS,KAAM,MAAO,CAAC,KAAD,6CAA6Cf,IAC9E,IACID,EADEiB,EAAMhB,EAAMc,UAAU,EAAGd,EAAMK,OAAS,GAE9C,OAAQP,GACP,IAAK,IAAKC,EAAO,UAAW,MAC5B,IAAK,IAAKA,EAAO,UAAW,MAC5B,IAAK,IAAKA,EAAO,UAAW,MAC5B,QAAS,MAAO,CAAC,KAAD,gBAAgBT,EAAhB,gCAA4CQ,EAA5C,MAEjB,MAAO,CAAC,CACPR,KAAMA,EACNS,KAAMA,EACNC,MAAOgB,GACL,MAEH,IAEIjB,EAFAkB,EAAMC,OAAOlB,GACjB,IAAKkB,OAAOC,UAAUF,GAAM,MAAO,CAAC,KAAD,gBAAgB3B,EAAhB,gCAA4CU,IAE/E,OAAQF,GACP,IAAK,IAAKC,EAAO,MAAO,MACxB,IAAK,IAAKA,EAAO,MAAOkB,GAAOA,EAAK,MACpC,IAAK,IAAKlB,EAAO,MAAO,MACxB,QAAS,MAAO,CAAC,KAAD,gBAAgBT,EAAhB,gCAA4CQ,EAA5C,MAEjB,MAAO,CAAC,CACPR,KAAMA,EACNS,KAAMA,EACNC,MAAOiB,GACL,MAxDuBG,CAAehB,EAAIE,QADzB,mBACbT,EADa,KACPwB,EADO,KAEP,OAATxB,EACHY,EAASZ,EAAKP,MAAQ,CACrBS,KAAMF,EAAKE,KACXC,MAAOH,EAAKG,OAGK,OAAdqB,GACHX,EAAOhB,KAAK2B,MAKRX,EAAOL,OAAS,EAAI,CAAC,KAAMK,EAAOd,KAAK,OAAS,CAACa,EAAU,MCxEnE,IAAMa,EAAM,eAmCL,SAASC,IACf,IAAMnB,EAAMoB,aAAaC,QAAQH,GACjC,OACQI,EADJtB,EACkBuB,KAAKC,MAAMxB,GAEX,IAavB,SAASsB,EAActB,GACtB,OAGyByB,EAHDC,EAAc1B,IAIhC2B,SAASpB,SAAQ,SAAAqB,GAAM,OAAIA,EAAOC,OAAOtB,SAAQ,SAAAJ,GAAK,OAAIA,EAAMxB,QAAQ4B,SAAQ,SAAAxB,GACrF,GAAIA,EAAOE,YAAa,CAAC,IAAD,EACAc,EAAchB,EAAOE,aADrB,mBAChB6C,EADgB,KACTC,EADS,KAEnBA,GACHhD,EAAOiD,WAAaD,EACpBhD,EAAOK,OAAS,KAEhBL,EAAOiD,gBAAaC,EACpBlD,EAAOK,OAAS0C,QAGjB/C,EAAOiD,gBAAaC,EACpBlD,EAAOK,OAAS,YAIXqC,EAjBR,IAA0BA,EAoBnB,SAASC,EAAcD,GAC7B,IAAKA,EACJ,MAAO,CACNS,YAAa,mBACbC,aAAc,EACdC,cAAe,EACfC,cAAe,EACfV,SAAU,GACVW,MAAO,IAGT,IACIH,EAMAE,EAPED,EAAeG,EAAcd,EAAMW,aAAcX,EAAME,UAa7D,OAJCU,GADoB,KALpBF,GADqB,IAAlBC,GACY,EAEDG,EAAcd,EAAMU,YAAaV,EAAME,SAASS,GAAcP,UAI5D,EAEDU,EAAcd,EAAMY,aAAcZ,EAAME,SAASS,GAAcP,OAAOM,GAAaxD,QAAQsB,QAEpG,CACNiC,YAAaT,EAAMS,aAAe,mBAClCE,eACAD,cACAE,eACAV,SAAUa,EAAcf,EAAME,UAAU7C,IAAI2D,GAC5CH,MAAOE,EAAcf,EAAMa,OAAOxD,IAAI4D,IAIxC,SAASF,EAAcnD,GACtB,OAAOA,GAAS,GAGjB,SAASkD,EAAcvD,EAAGK,GACzB,OAAU,IAANL,GAAYA,IACXK,GAAUA,EAAMY,OACjBjB,EAAI,GACJA,GAAKK,EAAMY,QADI,EAEZjB,GAJoB,EAOrB,SAASyD,EAAeb,GAC9B,IAAMe,EAAW,CAChBzD,KAAM,GACNX,UAAU,EACVsD,OAAQ,IAET,IAAKD,EACJ,OAAO,eAAKe,GAEb,IAAMC,EAAK,eAAQD,GAUnB,OATIf,EAAO1C,OACV0D,EAAM1D,KAAO0C,EAAO1C,MAEjB0C,EAAOrD,WACVqE,EAAMrE,UAAW,GAEdqD,EAAOC,SACVe,EAAMf,OAASD,EAAOC,OAAO/C,IAAI+D,IAE3BD,EAGD,SAASC,EAAc1C,GAC7B,IAAMwC,EAAW,CAChBzD,KAAM,GACNX,UAAU,EACVI,QAAS,IAEV,IAAKwB,EACJ,OAAO,eAAKwC,GAEb,IAAMC,EAAK,eAAQD,GAUnB,OATIxC,EAAMjB,OACT0D,EAAM1D,KAAOiB,EAAMjB,MAEhBiB,EAAM5B,WACTqE,EAAMrE,UAAW,GAEd4B,EAAMxB,UACTiE,EAAMjE,QAAUwB,EAAMxB,QAAQG,IAAIgE,IAE5BF,EAGD,SAASE,EAAe/D,GAC9B,IAAM4D,EAAW,CAChBzD,KAAM,GACNX,UAAU,EACVU,YAAa,GACb+C,gBAAYC,EACZ7C,OAAQ,IAET,IAAKL,EACJ,OAAO,eAAK4D,GAEb,IAAMC,EAAK,eAAQD,GAgBnB,OAfI5D,EAAOG,OACV0D,EAAM1D,KAAOH,EAAOG,MAEjBH,EAAOE,cACV2D,EAAM3D,YAAcF,EAAOE,aAExBF,EAAOR,WACVqE,EAAMrE,UAAW,GAEdQ,EAAOiD,aACVY,EAAMZ,WAAajD,EAAOiD,YAEvBjD,EAAOK,SACVwD,EAAMxD,OAKD,SAAuB0C,GAC7B,IAAMiB,EAAQ,CAAC,MAAO,MAAO,UAAW,UAAW,WAC7CC,EAAO,GACb,IAAK,IAAMC,KAAOnB,EAAO,CACxB,IAAMoB,EAAIpB,EAAMmB,GAAKtD,KACjBuD,GAAKH,EAAMI,SAASD,KACb,QAANA,GAAqB,QAANA,EACdpC,OAAOC,UAAUe,EAAMmB,GAAKrD,SAC/BoD,EAAKC,GAAO,CACXtD,KAAMuD,EACNtD,MAAOkC,EAAMmB,GAAKrD,QAIpBoD,EAAKC,GAAO,CACXtD,KAAMuD,EACNtD,MAAOkC,EAAMmB,GAAKrD,MAAMwD,aAK5B,OAAOJ,EA1BSK,CAActE,EAAOK,SAE9BwD,EA2BD,SAASF,EAAajD,GAC5B,IAAMkD,EAAW,CAChBzD,KAAM,GACNoE,MAAO,IAER,IAAK7D,EAAM,OAAO,eAAKkD,GACvB,IAAMK,EAAI,eAAQL,GAOlB,OANIlD,EAAKP,OACR8D,EAAK9D,KAAOO,EAAKP,MAEdO,EAAK6D,QACRN,EAAKM,MAAQ7D,EAAK6D,OAEZN,EAGR,SAASO,EAAS9B,GAEjB,OADAA,EAAQC,EAAcD,GACf,2BACHA,GADJ,IAECE,SAAUF,EAAME,SAAS7C,KAAI,SAAA8C,GAAM,kCAE9BA,GAF8B,IAGjCC,OAAQD,EAAOC,OAAO/C,KAAI,SAAAqB,GAAK,kCAE1BA,GAF0B,IAG7BxB,QAASwB,EAAMxB,QAAQG,KAAI,SAAAC,GAAM,kCAE5BA,GAF4B,IAG/BK,OAAQ,oBCvPT,SAASoE,EAAeC,GAC9B,OAAO,YAAuC,IAA3B9B,EAA0B,EAA1BA,SAAUS,EAAgB,EAAhBA,aACtBsB,EAAeC,EAAiBhC,GAChCiC,EAAYnB,IACdgB,GAASC,EAAazD,OACzByD,EAAapE,KAAKsE,GAElBF,EAAaG,OAAOJ,EAAO,EAAGG,GAE/B,IAAIE,EAAkB1B,EAItB,OAHIA,GAAgBqB,GACnBK,IAEM,CACNnC,SAAU+B,EACVtB,aAAc0B,IAwBV,SAASC,EAAa/E,EAAGgF,GAC/B,OAAO,YAAuC,IAMzCF,EANcnC,EAA0B,EAA1BA,SAAUS,EAAgB,EAAhBA,aACtBsB,EAAeC,EAAiBhC,GAChCsC,EAAOP,EAAa1E,GAU1B,OATA0E,EAAa1E,GAAK0E,EAAaM,GAC/BN,EAAaM,GAAKC,EAGd7B,IAAiBpD,EACpB8E,EAAkBE,EACR5B,IAAiB4B,IAC3BF,EAAkB9E,GAEZ,CACN2C,SAAU+B,EACVtB,aAAc0B,IAKV,SAASI,EAAoBT,EAAOU,EAAUvE,GACpD,OAAO,YAAyB,IACzB8D,EAAeC,EADS,EAAZhC,UAIlB,OAFA+B,EAAaD,GAAOU,GAAYvE,EAEzB,CACN+B,SAAU+B,IAMN,SAASU,EAAcC,EAAQZ,EAAOa,GAC5C,OAAO,YAAoD,IAAxC3C,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GAChC4C,EAAW1B,EAAcyB,GAC3Bb,GAASC,EAAaW,GAAQxC,OAAO5B,OACxCyD,EAAaW,GAAQxC,OAAOvC,KAAKiF,GAEjCb,EAAaW,GAAQxC,OAAOgC,OAAOJ,EAAO,EAAGc,GAE9C,IAAIC,EAAiBrC,EAIrB,OAHIC,IAAiBiC,GAAUlC,GAAesB,GAC7Ce,IAEM,CACN7C,SAAU+B,EACVvB,YAAaqC,IAyBT,SAASC,EAAWJ,EAAQK,EAAIC,GACtC,OAAO,YAAoD,IAAxChD,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GAChCsC,EAAOP,EAAaW,GAAQxC,OAAO6C,GACzChB,EAAaW,GAAQxC,OAAO6C,GAAMhB,EAAaW,GAAQxC,OAAO8C,GAC9DjB,EAAaW,GAAQxC,OAAO8C,GAAMV,EAClC,IAAIO,EAAiBrC,EAQrB,OAPIC,IAAiBiC,IAChBlC,IAAgBuC,EACnBF,EAAiBG,EACPxC,IAAgBwC,IAC1BH,EAAiBE,IAGZ,CACN/C,SAAU+B,EACVvB,YAAaqC,IAMT,SAASI,EAAmBP,EAAQQ,EAAQV,EAAUvE,GAC5D,OAAO,YAAyB,IACzB8D,EAAeC,EADS,EAAZhC,UAGlB,OADA+B,EAAaW,GAAQxC,OAAOgD,GAAQV,GAAYvE,EACzC,CAAE+B,SAAU+B,IAgLd,SAASoB,EAAoBT,EAAQQ,EAAQpB,EAAOU,EAAUvE,GACpE,OAAO,YAAyB,IAAb+B,EAAY,EAAZA,SAClB,GAAiB,WAAbwC,EAAuB,MAAO,GAClC,IAAMT,EAAeC,EAAiBhC,GAKtC,OAJA+B,EAAaW,GAAQxC,OAAOgD,GAAQlG,QAAQ8E,GAAOU,GAAYvE,EAC9C,gBAAbuE,GASN,SAAoCpF,GAAS,IAAD,EACjBgB,EAAchB,EAAOE,aADJ,mBACpC8F,EADoC,KAC1BhD,EAD0B,KAEvCgD,GACHhG,EAAOK,OAAS2F,EAChBhG,EAAOiD,gBAAaC,IAEpBlD,EAAOK,OAAS,GAChBL,EAAOiD,WAAaD,GAfnBiD,CAA2BtB,EAAaW,GAAQxC,OAAOgD,GAAQlG,QAAQ8E,IAEjE,CACN9B,SAAU+B,IA6BN,SAASuB,EAAyBtD,EAAU/C,EAAGC,EAAGqG,GACxD,OAAIA,GAAK,GAAKrG,GAAK,GAAKD,GAAK,EACrB,EAAE,GAAI,GAAI,GAAG,IAKjBsG,GAAK,EACJrG,GAAK,GAERsG,EAAQxD,EADRyD,EAAQxG,EAAI,GACYiD,OAAO5B,OAAS,EACxCoF,EAAQ1D,EAASyD,GAAOvD,OAAOsD,GAAOxG,QAAQsB,OAAS,IAGvDkF,EAAQtG,EAAI,EACZwG,EAAQ1D,EAFRyD,EAAQxG,GAEgBiD,OAAOsD,GAAOxG,QAAQsB,OAAS,IAGxDmF,EAAQxG,EACRuG,EAAQtG,EACRwG,EAAQH,EAAI,GAEN,CAACE,EAAOD,EAAOE,GAAO,IAlB7B,IAAIA,EACAF,EACAC,EAiEE,SAASE,EAAW7B,GAC1B,OAAO,YAAsB,IACtB8B,EAAYC,EADS,EAATlD,OAEZmD,EAAU/C,IAMhB,OALIe,GAAS8B,EAAUtF,OACtBsF,EAAUjG,KAAKmG,GAEfF,EAAU1B,OAAOJ,EAAO,EAAGgC,GAErB,CACNnD,MAAOiD,IAeH,SAASG,EAAkBC,EAAWxB,EAAUvE,GACtD,OAAO,YAAgC,IAApB+B,EAAmB,EAAnBA,SACZ4D,EAAYC,EADmB,EAATlD,OAEtBsD,EAAWL,EAAUI,GAAWxB,GAEtC,GADAoB,EAAUI,GAAWxB,GAAYvE,EAChB,SAAbuE,EAAqB,CACxB,IAAMT,EAAeC,EAAiBhC,GAEtC,OA+EH,SAAiC+B,EAAcmC,EAASC,GACvDpC,EAAanD,SAAQ,SAAAqB,GAAM,OAAIA,EAAOC,OAAOtB,SAAQ,SAAAJ,GAAK,OAAIA,EAAMxB,QAAQ4B,SAAQ,SAAAxB,GAAW,IAAD,EACrEgB,EAAchB,EAAOE,aADgD,mBACtFG,EADsF,aFnhBxF,SAA2BA,EAAQyG,EAASC,GAKlD,IAAK,IAAM5G,KAJP2G,KAAWzG,IACdA,EAAO0G,GAAW1G,EAAOyG,UAClBzG,EAAOyG,SAEIzG,EACdA,EAAOF,GAAMS,KAAKG,WAAW,QAC5BV,EAAOF,GAAMU,QAAUiG,IAC1BzG,EAAOF,GAAMU,MAAQkG,GE8gBtBC,CAAkB3G,EAAQyG,EAASC,GACnC/G,EAAOE,YAAcE,EAAcC,aArFnC4G,CAAwBtC,EAAc9D,EAAOgG,GACtC,CACNtD,MAAOiD,EACP5D,SAAU+B,GAGX,MAAO,CACNpB,MAAOiD,IAoBX,SAAS5B,EAAiBhC,GACzB,OAAOA,EAAS7C,IAAI2D,GAGrB,SAASwD,EAAkBC,GAG1B,MAAO,CAAEC,QAGV,SAAiCA,GAChC,OAAOA,EAAQrH,KAAI,SAAAsH,GAAa,OAAIA,EAActH,KAAI,SAAAuH,GAAY,OAAIA,EAAavH,KAAI,SAAAwH,GAAa,sBAAUA,YAN9FC,CAAwBL,EAAUC,SAEhCpE,MADJmE,EAAUnE,MAAV,eAAuBmE,EAAUnE,YAAUE,GAQ1D,SAASuD,EAAclD,GACtB,OAAOA,EAAMxD,IAAI4D,GAGlB,SAAS8D,EAAWC,EAAUnE,EAAOR,GACpC,IAAMkB,EAAI,eAAQyD,GAClB,IAAK,IAAMvH,KAAQ4C,EAAO,CACzB,KAAM5C,KAAQoD,GAAQ,MAAO,CAAC,KAAD,gBAAgBpD,EAAhB,sEAI7B,GAHMA,KAAQuH,IACbA,EAASvH,GAAQ,GAEd4C,EAAM5C,GAAMS,KAAKG,WAAW,OAAQ,CACvC,KAAMgC,EAAM5C,GAAMU,SAAS0C,GAAQ,MAAO,CAAC,KAAD,gBAAgBpD,EAAhB,uCAAmD4C,EAAM5C,GAAMU,MAA/D,MACpCkC,EAAM5C,GAAMU,SAAS6G,IAC1BA,EAAS3E,EAAM5C,GAAMU,OAAS,GAGhC,OAAQkC,EAAM5C,GAAMS,MACnB,IAAK,MACJqD,EAAK9D,GAAQuH,EAASvH,GAAQ4C,EAAM5C,GAAMU,MAC1C,MACD,IAAK,MACJoD,EAAK9D,GAAQ4C,EAAM5C,GAAMU,MACzB,MACD,IAAK,UACJoD,EAAK9D,GAAQuH,EAASvH,GAAQuH,EAAS3E,EAAM5C,GAAMU,OACnD,MACD,IAAK,UACJoD,EAAK9D,GAAQuH,EAASvH,GAAQuH,EAAS3E,EAAM5C,GAAMU,OACnD,MACD,IAAK,UACJoD,EAAK9D,GAAQuH,EAAS3E,EAAM5C,GAAMU,OAClC,MACD,QAAS,MAAO,CAAC,KAAD,sCAAsCV,EAAtC,OAGlB,MAAO,CAAC8D,EAAM,MCphBA,SAAS0D,EAAT,GAAyI,IAAxHxH,EAAuH,EAAvHA,KAAMyH,EAAiH,EAAjHA,YAAalD,EAAoG,EAApGA,MAAOlF,EAA6F,EAA7FA,SAAUqI,EAAmF,EAAnFA,OAAQC,EAA2E,EAA3EA,aAAcC,EAA6D,EAA7DA,cAAeC,EAA8C,EAA9CA,QAASC,EAAqC,EAArCA,aAAcrI,EAAuB,EAAvBA,QAASsI,EAAc,EAAdA,WAClIC,EAAchI,GAAQ,kBACtBiI,EACL,+BACC,oBAAIzJ,UAAU,oBAAd,SAAmCqJ,GAAW,wBAAQrJ,UAAU,cAAc0J,MAAM,eAAe3I,QAAS,WDyMxG,IAAuB4F,EAAQQ,ECxMlClG,EAAQ0I,cDwMkBhD,ECxMSsC,EDwMD9B,ECxMcpB,EDyM5C,YAAoD,IAAxC9B,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GAChC2F,EAAY5D,EAAaW,GAAQxC,OAAO0F,MAAM1C,GACpDnB,EAAaW,GAAQxC,OAAS6B,EAAaW,GAAQxC,OAAO0F,MAAM,EAAG1C,GACnE,IAAMjB,EAAYnB,IAClBmB,EAAUrF,UAAW,EACrBqF,EAAU/B,OAASyF,EACnB5D,EAAaG,OAAOQ,EAAS,EAAG,EAAGT,GAEnC,IAAIE,EAAkB1B,EAClBoC,EAAiBrC,EAKrB,OAJIC,IAAiBiC,GAAUlC,GAAe0C,IAC7Cf,IACAU,GAAkBK,GAEZ,CACNlD,SAAU+B,EACVtB,aAAc0B,EACd3B,YAAaqC,KC3N4C,0BADX,SAE1C,QACJ,oBAAI9G,UAAU,oBAAd,SACC,cAACY,EAAD,CAAcC,SAAUA,EAAUC,YAAa,SAACD,GAC/CI,EAAQ0I,aAAazC,EAAmB+B,EAAalD,EAAO,WAAYlF,GAAxE,gBAA4FA,EAAW,WAAa,YAApH,WAGF,oBAAIiJ,QAAQ,IAAZ,SACET,EACA,uBACCrJ,UAAU,aACV+J,YAAY,aACZ9H,KAAK,OACLC,MAAOV,EACPwI,SAAU,SAACtH,GACVzB,EAAQ0I,aAAazC,EAAmB+B,EAAalD,EAAO,OAAQrD,EAAEuH,OAAO/H,WAE7E,mBAAGlC,UAAU,aAAae,QAAS,WACpCE,EAAQiJ,UAAUjB,EAAalD,IAD9B,SAEEyD,MAELH,GAAW,oBAAIrJ,UAAU,oBAAd,SACX,wBAAQA,UAAU,cAAc0J,MAAM,OAAO3I,QAAS,WACrDE,EAAQkJ,UAAU,CACjB3I,KAAMA,EACNX,SAAUA,EACVI,QAASqI,KAJX,iBASAD,GAAW,oBAAIrJ,UAAU,oBAAd,SACX,wBAAQA,UAAU,cAAcoK,SAAoB,IAAVrE,GAAeqD,EAAeM,MAAM,UAAU3I,QAAS,WAClF,IAAVgF,EACH9E,EAAQ0I,aDwGP,SAAgD5D,GACtD,OAAO,YAAoD,IAAxC9B,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GACtC+B,EAAaD,EAAQ,GAAG5B,OAAOvC,KAAKoE,EAAaD,GAAO5B,OAAO,IAC/D6B,EAAaD,GAAO5B,OAAOgC,OAAO,EAAG,GACrC,IAAIC,EAAkB1B,EAClBoC,EAAiBrC,EAKrB,OAJIC,IAAiBqB,GAAyB,IAAhBtB,IAC7B2B,IACAU,EAAiBd,EAAaD,EAAQ,GAAG5B,OAAO5B,OAAS,GAEnD,CACN0B,SAAU+B,EACVtB,aAAc0B,EACd3B,YAAaqC,ICtHWuD,CAAuCpB,GAAc,uCAE1EhI,EAAQ0I,aAAa5C,EAAWkC,EAAalD,EAAOA,EAAQ,GAAI,eAAgBkD,EAAalD,EAAQ,IAJvG,sBAQAsD,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,YAAYU,SAAUlB,GAAUC,EAAcpI,QAAS,WACxFmI,EACHjI,EAAQ0I,aDkHR,SAA2C5D,GACjD,OAAO,YAAoD,IAAxC9B,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GAChCqG,EAAYtE,EAAaD,GAAO5B,OAAO5B,OAAS,EACtDyD,EAAaD,EAAQ,GAAG5B,OAAOgC,OAAO,EAAG,EAAGH,EAAaD,GAAO5B,OAAOmG,IACvEtE,EAAaD,GAAO5B,OAAOgC,OAAOmE,EAAW,GAE7C,IAAIlE,EAAkB1B,EAClBoC,EAAiBrC,EAKrB,OAJIC,IAAiBqB,GAAStB,IAAgB6F,IAC7ClE,IACAU,EAAiB,GAEX,CACN7C,SAAU+B,EACVtB,aAAc0B,EACd3B,YAAaqC,IClIYyD,CAAkCtB,GAAc,mCAErEhI,EAAQ0I,aAAa5C,EAAWkC,EAAalD,EAAOA,EAAQ,GAAI,eAAgBkD,EAAalD,IAJ/F,sBAQDsD,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,SAAS3I,QAAS,WACvDE,EAAQuJ,aAAR,wBAAsChJ,EAAtC,uEAAiH,UAAU,WAC1HP,EAAQwJ,YACRxJ,EAAQ0I,aDgCR,SAAuBhD,EAAQZ,GACrC,OAAO,YAAoD,IAAxC9B,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GACtC+B,EAAaW,GAAQxC,OAAOgC,OAAOJ,EAAO,GAC1C,IAAIe,EAAiBrC,EAQrB,OAPIC,IAAiBiC,IAChBlC,IAAgBsB,EACnBe,GAAkB,EACRrC,EAAcsB,GACxBe,KAGK,CACN7C,SAAU+B,EACVvB,YAAaqC,IC9CY4D,CAAczB,EAAalD,GAAQ,iBAAkBkD,EAAalD,KACrF,UAAU,WACZ9E,EAAQwJ,gBALV,iBAUDpB,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,kBAAkB3I,QAAS,WAChEE,EAAQ0I,aAAajD,EAAcuC,EAAalD,EAAQ,GAAI,iBAAkBkD,EAAalD,EAAQ,GACnGwD,GAAW,IAFZ,iBAMDF,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,oBAAoBU,cAAqC7F,IAA3BtD,EAAQ0J,eAA8B5J,QAAS,WAClHE,EAAQ0I,aAAajD,EAAcuC,EAAalD,EAAQ,EAAG9E,EAAQ0J,gBAAiB,gBAAiB1B,EAAalD,EAAQ,IAD3H,mBA1EH,YAAckD,EAAd,cAA+BlD,EAA/B,WAiFD,OAAKlF,EACE,CAAC4I,GAAWmB,OAAO,cAAC5J,EAAD,CAAeC,QAASqI,EAAcpI,EAAG+H,EAAa9H,EAAG4E,KAD7D0D,ECpFR,SAASoB,EAAT,GAAwG,IAAnF5B,EAAkF,EAAlFA,YAAa9E,EAAqE,EAArEA,OAAQgF,EAA6D,EAA7DA,aAAcC,EAA+C,EAA/CA,cAAeC,EAAgC,EAAhCA,QAASpI,EAAuB,EAAvBA,QAASsI,EAAc,EAAdA,WACjGuB,EAAa3G,EAAO/C,KAAI,SAACqB,EAAOnB,GAAR,OAC7B,cAAC0H,EAAD,CAECxH,KAAMiB,EAAMjB,KACZyH,YAAaA,EACblD,MAAOzE,EACPT,SAAU4B,EAAM5B,SAChBqI,OAAQ5H,IAAM6C,EAAO5B,OAAS,EAC9B4G,aAAcA,EACdC,cAAeA,EACfC,QAASA,EACTpI,QAASA,EACTqI,aAAc7G,EAAMxB,QACpBsI,WAAYA,GAZb,iBACgBN,EADhB,kBACqC3H,EADrC,SA+BD,OAhBAwJ,EAAWlJ,KAAK,+BACf,oBAAI5B,UAAU,oBAAd,SAAmCqJ,GAAW,wBAAQrJ,UAAU,cAAc0J,MAAM,eAAeU,SAAUjB,EAAcpI,QAAS,WFsK/H,IAA0CgF,EErK9C9E,EAAQ0I,cFqKsC5D,EErKQkD,EFsKjD,YAAoD,IAAxChF,EAAuC,EAAvCA,SAAUS,EAA6B,EAA7BA,aAAcD,EAAe,EAAfA,YACpCuB,EAAeC,EAAiBhC,GAChC8G,EAAe/E,EAAaD,GAAO5B,OAAO5B,OAChDyD,EAAaD,GAAO5B,OAAS6B,EAAaD,GAAO5B,OAAOyG,OAAO5E,EAAaD,EAAQ,GAAG5B,QACvF6B,EAAaG,OAAOJ,EAAQ,EAAG,GAC/B,IAAIK,EAAkB1B,EAClBoC,EAAiBrC,EAKrB,OAJIC,IAAiBqB,EAAQ,IAC5BK,IACAU,GAAkBiE,GAEZ,CACN9G,SAAU+B,EACVtB,aAAc0B,EACd3B,YAAaqC,KEpLuD,2BADvB,iBAG9C,qBAAIgD,QAAQ,IAAZ,UACC,wBAAQ/I,QAAS,WAChB,IAAMiK,EAAM7G,EAAO5B,OACnBtB,EAAQ0I,aAAajD,EAAcuC,EAAa+B,GAAM,iBAAkB/B,EAAa+B,GACrFzB,GAAW,IAHZ,uBAKA,wBAAQvJ,UAAU,mBAAmBoK,cAAqC7F,IAA3BtD,EAAQ0J,eAA8B5J,QAAS,WAC7F,IAAMiK,EAAM7G,EAAO5B,OACnBtB,EAAQ0I,aAAajD,EAAcuC,EAAa+B,EAAK/J,EAAQ0J,gBAAiB,gBAAiB1B,EAAa+B,IAF7G,8BAVc,iBAAmB/B,EAAnB,oBAgBT6B,EC/BO,SAASG,EAAT,GAA0F,IAAxEzJ,EAAuE,EAAvEA,KAAMuE,EAAiE,EAAjEA,MAAOlF,EAA0D,EAA1DA,SAAUwI,EAAgD,EAAhDA,QAASpI,EAAuC,EAAvCA,QAASiI,EAA8B,EAA9BA,OAAQ/E,EAAsB,EAAtBA,OAAQoF,EAAc,EAAdA,WACnFC,EAAchI,GAAQ,mBACtB0J,EACL,+BACC,oBAAIlL,UAAU,oBAAd,SACC,cAACY,EAAD,CAAcC,SAAUA,EAAUC,YAAa,SAACD,GAC/CI,EAAQ0I,aAAanD,EAAoBT,EAAO,WAAYlF,GAA5D,iBAAiFA,EAAW,WAAa,YAAzG,WAGF,oBAAIiJ,QAAQ,IAAZ,SACET,EACA,uBACCrJ,UAAU,aACV+J,YAAY,cACZ9H,KAAK,OACLC,MAAOV,EACPwI,SAAU,SAACtH,GACVzB,EAAQ0I,aAAanD,EAAoBT,EAAO,OAAQrD,EAAEuH,OAAO/H,WAEjE,iCAASsH,MAGZH,GAAW,oBAAIrJ,UAAU,oBAAd,SACX,wBAAQA,UAAU,cAAcoK,SAAoB,IAAVrE,EAAa2D,MAAM,UAAU3I,QAAS,WAC/EE,EAAQ0I,aAAatD,EAAaN,EAAOA,EAAQ,GAAI,gBAAiBA,EAAQ,IAD/E,sBAIAsD,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,YAAYU,SAAUlB,EAAQnI,QAAS,WAC5EE,EAAQ0I,aAAatD,EAAaN,EAAOA,EAAQ,GAAI,gBAAiBA,IADvE,sBAIDsD,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,SAAS3I,QAAS,WACvDE,EAAQuJ,aAAR,yBAAuChJ,EAAvC,2EAAsH,UAAU,WAC/HP,EAAQwJ,YACRxJ,EAAQ0I,aHlBR,SAAwB5D,GAC9B,OAAO,YAAuC,IAA3B9B,EAA0B,EAA1BA,SAAUS,EAAgB,EAAhBA,aACtBsB,EAAeC,EAAiBhC,GACtC+B,EAAaG,OAAOJ,EAAO,GAC3B,IAAIK,EAAkB1B,EAMtB,OALIA,IAAiBqB,EACpBK,GAAmB,EACT1B,EAAeqB,GACzBK,IAEM,CACNnC,SAAU+B,EACVtB,aAAc0B,IGMW+E,CAAepF,GAAQ,kBAAmBA,KAC7D,UAAU,WACZ9E,EAAQwJ,gBALV,iBAUDpB,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,mBAAmB3I,QAAS,WACjEE,EAAQ0I,aAAa7D,EAAeC,EAAQ,GAAI,kBAAmBA,EAAQ,GAC3EwD,GAAW,IAFZ,mBA5CM,kBAAoBxD,GAoD9B,OAAKlF,EAGE,CAACqK,GAAYN,OAAO,cAACC,EAAD,CAE1B5B,YAAalD,EACb5B,OAAQA,EACRgF,aAAcD,EACdE,cAAyB,IAAVrD,EACfsD,QAASA,EACTpI,QAASA,EACTsI,WAAYA,GARc,4BACAxD,KAHnBmF,ECzDM,SAASE,EAAT,GAAiE,IAA3CnH,EAA0C,EAA1CA,SAAUoF,EAAgC,EAAhCA,QAASE,EAAuB,EAAvBA,WAAYtI,EAAW,EAAXA,QACnE,OAAKgD,EAEJ,gCACC,kCACEA,EAAS7C,KAAI,SAAC8C,EAAQ5C,GAAT,OACb,cAAC2J,EAAD,CACCzJ,KAAM0C,EAAO1C,KAEbuE,MAAOzE,EACPT,SAAUqD,EAAOrD,SACjBwI,QAASA,EACTpI,QAASA,EACTiI,OAAQ5H,IAAM2C,EAAS1B,OAAS,EAChC4B,OAAQD,EAAOC,OACfoF,WAAYA,GAPPjI,MAUP,6BACC,oBAAIwI,QAAQ,IAAZ,SACC,wBAAQ/I,QAAS,WAChB,IAAMiK,EAAM/G,EAAS1B,OACrBtB,EAAQ0I,aAAa7D,EAAekF,GAAM,kBAAmBA,GAC7DzB,GAAW,IAHZ,2BAFM,0BAjBW,K,ICCF8B,E,kDACpB,WAAYC,GAAQ,IAAD,8BAClB,cAAMA,IACDvH,MAAQ,CACZsF,SAAS,GAHQ,E,kDAQnB,SAAekC,GACdC,KAAKC,SAAS,CAAEpC,QAASkC,M,oBAE1B,WAAU,IAAD,OACJG,EACH,iCACC,wBAAQ1L,UAAU,mBAAmBe,QAAS,kBAAM,EAAK4K,gBAAgB,EAAK5H,MAAMsF,UAApF,SAA+FmC,KAAKzH,MAAMsF,QAAU,SAAW,SAC/H,wBAAQrJ,UAAU,mBAAmBe,QAAS,kBAAM,EAAKuK,MAAMrK,QAAQ0I,cLoNnE,YAAyB,IACzB3D,EAAeC,EADS,EAAZhC,UAWlB,OATA+B,EAAanD,SAAQ,SAAAqB,GACpBA,EAAOrD,UAAW,EAClBqD,EAAOC,OAAOtB,SAAQ,SAAAJ,GACrBA,EAAM5B,UAAW,EACjB4B,EAAMxB,QAAQ4B,SAAQ,SAAAxB,GACrBA,EAAOR,UAAW,WAId,CACNoD,SAAU+B,EACVrB,cAAe,EACfD,cAAe,EACfD,aAAc,KKnOsF,mBAAnG,6BAGEmH,EACH,cAACR,EAAD,CACCnH,SAAUuH,KAAKF,MAAMrH,SACrBoF,QAASmC,KAAKzH,MAAMsF,QACpBpI,QAASuK,KAAKF,MAAMrK,QACpBsI,WAAYiC,KAAKG,eAAeE,KAAKL,QACvC,OACC,gCACC,cAAC5L,EAAD,CAAKC,OAAQ2L,KAAKF,MAAMzL,OAAOiM,KAAM/L,YAAY,gBAAjD,SACC,+BACGyL,KAAKF,MAAMS,eAAiBH,MAGhC,eAAChM,EAAD,CAAKC,OAAQ2L,KAAKF,MAAMzL,OAAOmM,OAA/B,UACC,gCACC,cAACpL,EAAD,CAAcC,UAAW2K,KAAKF,MAAMS,cAAejL,YAAa,SAACD,GAChE,EAAKyK,MAAMrK,QAAQgL,kBAAkBpL,OAEpC2K,KAAKF,MAAMS,eAAiBL,KAG/B,iC,GAxCgCQ,IAAMC,WCNpC,SAASC,IACf,OAAO,IAAIC,MAAOC,UAGZ,SAASC,EAAeC,GAC9B,OAAO,IAAIH,MAAOC,UAAYE,ECDhB,SAASC,EAAT,GAAqF,IAAnEC,EAAkE,EAAlEA,SAAUlI,EAAwD,EAAxDA,YAAamI,EAA2C,EAA3CA,gBAAiBZ,EAA0B,EAA1BA,cAAe9K,EAAW,EAAXA,QAAW,EAC1E2L,wBAASrI,GADiE,mBAC3FsI,EAD2F,KACrFC,EADqF,KAE5FC,EACL,wBAAQ/M,UAAU,mCAAmCe,QAAS,kBAAME,EAAQ+L,YAA5E,oBAEKC,EACL,wBAAQjN,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiM,2BAA5E,kBAEKxB,EACL,iCACC,wBAAQ1L,UAAU,mCAAmCe,QAAS,WAC7DE,EAAQkM,eAAeC,OAAO,qBAAsB5I,KADrD,+BAGA,uBAAOxE,UAAU,mCAAmCiC,KAAK,OAAO+H,SAAU,SAACtH,GAC1E2K,QAAQC,IAAI5K,GACZoK,EAAQpK,EAAEuH,OAAOsD,UAElB,wBAAQvN,UAAU,mCAAmCoK,UAAWyC,EAAM9L,QAAS,WAC9E,GAAI8L,GAAQA,EAAK,GAAI,CACpB,IAAMW,EAAYpB,KRnBhB,SAAsBS,EAAMY,GAClC,GAAIZ,EAAM,CAET,IAAMa,EAAS,IAAIC,WACnBD,EAAOE,UAAY,WAClB,IAAMtL,EAAMoL,EAAOG,OAElBJ,EAAoB7J,EADjBtB,EAC+BuB,KAAKC,MAAMxB,GAEX,MAGpCoL,EAAOI,WAAWjB,IQQfkB,CAAalB,EAAK,IAAI,SAACmB,GACtB/M,EAAQgN,iBAAgB,kBAAMD,IAAaR,QAJ9C,oBAUCT,EACAE,EACD,wBAAQjN,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiN,aAAaxB,IAAzF,SAAqGA,EAAW,qBAAuB,wBACvI,wBAAQ1M,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiN,aAAaxB,IAAWtC,UAAQ,EAA5G,SAA8GsC,EAAW,eAAiB,kBAC1I,wBAAQ1M,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiM,2BAA2B9C,UAAQ,EAA/G,oCACA,wBAAQpK,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiM,2BAA2B9C,UAAQ,EAA/G,kBACA,wBAAQpK,UAAU,mCAAmCe,QAAS,kBAAME,EAAQiM,2BAA2B9C,UAAQ,EAA/G,sBAGI+D,EACL,kCACGxB,GAAmBjB,EACpBiB,GAAmBI,EACnBJ,GAAmBM,KAGtB,OACC,sBAAKjN,UAAU,kBAAf,YACI+L,GAAiBY,IAAoB,oBAAI3M,UAAU,kBAAd,SAAiCwE,IACzE,cAAC5D,EAAD,CAAcC,UAAW8L,EAAiB7L,YAAa,SAACD,GAAD,OAAcI,EAAQmN,oBAAoBvN,QAC9FkL,GAAiBY,IAAoBwB,KCnDpC,SAASE,KAAgB,IAAD,uBAAP1M,EAAO,yBAAPA,EAAO,gBAC9B,MAAM,QAAN,OAAeA,EAAMG,KAAK,KAA1B,KAGM,SAASwM,GAAI9G,EAAGtG,GACtB,MAAM,OAAN,OAAcsG,EAAd,aAAoBtG,EAApB,KAGM,SAASqN,GAAI/G,EAAGtG,GACtB,MAAM,OAAN,OAAcsG,EAAd,aAAoBtG,EAApB,KAIc,SAASrB,GAAOkM,EAAeyC,EAAmB7B,GAIhE,IAAM8B,EAAc,QACdC,EAAe,QACfC,EAAgB,SAChBC,EAAgB,OAQhBC,EAAqB,OAIrBC,EAAwB,QAExBC,EAAyB,SAKzBC,EAASC,OAAOC,WADa,KAI7BC,EAAcF,OAAOC,WADW,IAIlCD,OAAOC,WADsB,MAEhCvC,GAAkB,GAInB,IAAMyC,EAAef,GAAKK,EAAc,IAAKC,EAAe,IAAKC,GAC3DS,EAAYtD,EAzBU,OAyB4BwC,GA7BjC,QA6BqDD,GA3BrD,QADJ,QA6BbgB,EAAYjB,GAAKI,EAAa,IAAKY,GACnCE,EAAiBf,EApBU,SAoBqCD,GAvB1C,QACJ,OAwBlBiB,EAAYnB,GAAKe,EAAc,IAAKG,GACpCE,EAAcT,EAASX,GAAKI,EAAa,IAAKK,GAAyBR,GAAIgB,EAAWf,GApBnE,QAoByFF,GAAK,MAAO,IAAKgB,KAC7HK,EAAUrB,GAAKK,EAAc,IAAKE,EAAe,IAAKW,GAE5D,MAAO,CACNvD,OAAQ,CACPzL,EAAG,EACHF,EAAG,EACHI,EAAGkM,EAAkB0C,EAAYZ,EACjC9N,EAAGgO,GAEJgB,KAAM,CACLpP,EAAG,EACHF,EAAGsO,EACHlO,EAAG4O,EACH1O,EAAGqO,EAASQ,EAAYJ,EACxBpD,OAAQ,CACPzL,EAAG,EACHF,EAAG,EACHI,EAAG,OACHE,EAAGkO,GAEJ/C,KAAM,CACLvL,EAAG,EACHF,EAAGwO,EACHpO,EAAG,OACHE,EAAG0N,GAAK,OAAQ,IAAKQ,KAGvBe,OAAQ,CACPrP,EAAG,EACHF,EAAGgO,GAAKK,EAAc,IAAKE,GAC3BnO,EAAGgO,EACH9N,EAAGiO,GAEJpG,UAAW,CACVjI,EAAGyO,EAASS,EAAcpB,GAAKgB,EAAW,IAAKI,GAC/CpP,EAAGqP,EACHjP,EAAGuO,EAASF,EAAwBT,GAAKiB,EAAW,IAAKG,GACzD9O,EAAG4O,EACHM,KAAMV,EACNnD,OAAQ,CACPzL,EAAG,EACHF,EAAG,EACHI,EAAG,OACHE,EAAGoO,GAEJjD,KAAM,CACLvL,EAAG,EACHF,EAAG0O,EACHtO,EAAG,OACHE,EAAG0N,GAAK,OAAQ,IAAKU,KAGvB9N,QAAS,CACRV,EAAGyO,EAAS,EAAIK,EAChBhP,EAAGqP,EACHjP,EAAG0O,EAAcV,EAAcgB,EAC/B9O,EAAG4O,EACHvD,OAAQ,CACPzL,EAAG,EACHF,EAAG,EACHI,EAAG,OACHE,EAAGkO,GAEJ/C,KAAM,CACLvL,EAAG,EACHF,EAAGwO,EACHpO,EAAG,OACHE,EAAG0N,GAAK,OAAQ,IAAKQ,KAGvBzN,IAAK,CACJb,EAAG8O,EACHhP,EAAGsM,EAAkB,EAAIgC,EACzBlO,EAAG6O,EACH3O,EAAGgM,EAAkB0B,GAAKK,EAAc,IAAKE,EAAe,IAAKW,GAAkBC,ICnIvE,SAASM,GAAT,GAA2B,IAATC,EAAQ,EAARA,KAChC,OACC,sBAAM/P,UAAU,kBAAhB,SAAmC+P,ICUrC,SAASC,GAAT,GAAmD,IAE9ChO,EAFgBR,EAA6B,EAA7BA,KAAMS,EAAuB,EAAvBA,KAAMC,EAAiB,EAAjBA,MAAiB,KAAV+N,OAVxC,SAAoBzO,GACnB,IAAKA,EAAM,MAAO,CAAC,GAAI,QACvB,IAAMF,EAAIE,EAAKuB,QAAQ,KACvB,GAAIzB,GAAK,EAAG,CACX,IAAMsE,EAAQpE,EAAKwB,UAAU1B,EAAI,GACjC,MAAO,CAACE,EAAKwB,UAAU,EAAG1B,GAAIsE,GAE/B,MAAO,CAACpE,EAAM,QAIe0O,CAAW1O,IADS,mBAC1CgI,EAD0C,KAC7B5D,EAD6B,KAGjD,OAAQ3D,GACP,IAAK,MAEHD,EADGE,GAAS,EACP,IAEA,IAEN,MACD,IAAK,MACL,IAAK,UAGL,IAAK,UACJF,EAAK,IACL,MACD,IAAK,UACJA,EAAK,IACL,MACD,QAASA,EAAK,IAKf,OAHIC,EAAKG,WAAW,SACnBF,EAAK,WAAOA,EAAP,MAGL,uBAAMhC,MAAO,CAAEiQ,gBAAiBvK,GAAhC,cAA2C4D,EAA3C,IAAyDxH,EAAIE,KAIhD,SAASkO,GAAT,GAA4C,IAAvB1O,EAAsB,EAAtBA,OAAQ4C,EAAc,EAAdA,WACrC+L,EAAa,GACnB,IAAK,IAAM7O,KAAQE,EAClB2O,EAAWzO,KACV,cAACoO,GAAD,aAAWxO,KAAMA,GAAqBE,EAAOF,IAAjBA,IAG9B,OACC,+BACC,oBAAIxB,UAAU,gCAAd,oBAGA,oBAAI8J,QAAQ,IAAZ,cACiBvF,IAAfD,EACA,sBAAMtE,UAAU,iBAAhB,SAAkCsE,IAElC+L,MARK,SC/CK,SAASC,GAAT,GAAoI,IAA9G9O,EAA6G,EAA7GA,KAAMyH,EAAuG,EAAvGA,YAAasH,EAA0F,EAA1FA,WAAYxK,EAA8E,EAA9EA,MAAOlF,EAAuE,EAAvEA,SAAUwI,EAA6D,EAA7DA,QAASpI,EAAoD,EAApDA,QAASiI,EAA2C,EAA3CA,OAAQ3H,EAAmC,EAAnCA,YAAa+C,EAAsB,EAAtBA,WAAY5C,EAAU,EAAVA,OACjI8H,EAAchI,GAAQ,mBACtBgP,EACL,+BACC,oBAAIxQ,UAAU,oBAAd,SACEuB,GAAe,cAACX,EAAD,CAAcC,SAAUA,EAAUC,YAAa,SAACD,GAC/DI,EAAQ0I,aAAavC,EAAoB6B,EAAasH,EAAYxK,EAAO,WAAYlF,GAArF,iBAA0GA,EAAW,WAAa,YAAlI,WAMDwI,GACA,oBAAIrJ,UAAU,oBAAd,SACC,uBACCA,UAAU,oBACV+J,YAAY,qBACZ9H,KAAK,OACLC,MAAOV,EACPwI,SAAU,SAACtH,GACVzB,EAAQ0I,aAAavC,EAAoB6B,EAAasH,EAAYxK,EAAO,OAAQrD,EAAEuH,OAAO/H,cAM5FmH,GAED,oBAAIS,QAAQ,IAAZ,SAAgB,+BAAOvI,EAAc,iCAASiI,IAAwB,6BAAKA,QAG3EH,GACA,6BACC,uBACCrJ,UAAU,aACV+J,YAAY,eACZ9H,KAAK,OACLC,MAAOX,EACPyI,SAAU,SAACtH,GACVzB,EAAQ0I,aAAavC,EAAoB6B,EAAasH,EAAYxK,EAAO,cAAerD,EAAEuH,OAAO/H,OAAQ,wBAAyB+G,EAAasH,QAKlJlH,GAAW,oBAAIrJ,UAAU,oBAAd,SACX,wBAAQA,UAAU,cAAcoK,SAAoB,IAAVrE,EAAa2D,MAAM,UAAU3I,QAAS,aAAhF,sBAIAsI,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,YAAYU,SAAUlB,EAAQnI,QAAS,aAA7E,sBAIDsI,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,SAAS3I,QAAS,aAErDqJ,UAAQ,EAFX,iBAKDf,GACA,oBAAIrJ,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,mBAAmB3I,QAAS,aAE/DqJ,UAAQ,EAFX,mBA7DM,UAAYrE,GAuEtB,OAAKlF,GAAaU,EACX,CAACiP,EAHU,cAAC,GAAD,CAA8ClM,WAAYA,EAAY5C,OAAQA,GAA9D,UAAYqE,EAAQ,WAEhByK,EC1ExB,SAASC,GAAT,GAA+F,IAAzEC,EAAwE,EAAxEA,WAAYrH,EAA4D,EAA5DA,QAASpI,EAAmD,EAAnDA,QAASgI,EAA0C,EAA1CA,YAAasH,EAA6B,EAA7BA,WAAYI,EAAiB,EAAjBA,cAC3F,OACC,gCACC,kCACED,EAAWtP,KAAI,SAACC,EAAQC,GACxB,IAAIgD,OAAaC,EAMjB,OALItD,EAAQqD,WACXA,EAAarD,EAAQqD,WACXqM,GAAiBA,EAAczM,SAAW+E,GAAe0H,EAAclO,QAAU8N,GAAcI,EAActP,SAAWC,IAClIgD,EAAaqM,EAAcC,SAErB,cAACN,GAAD,CACN9O,KAAMH,EAAOG,KAEbuE,MAAOzE,EACP2H,YAAaA,EACbsH,WAAYA,EACZ1P,SAAUQ,EAAOR,SACjBwI,QAASA,EACTpI,QAASA,EACTiI,OAAQ5H,IAAMoP,EAAWnO,OAAS,EAClChB,YAAaF,EAAOE,YACpB+C,WAAYA,EACZ5C,OAAQL,EAAOK,QAVVJ,MAaP,6BACC,oBAAIwI,QAAQ,IAAZ,SACC,wBAAQ/I,QAAS,WZ8NhB,IAAwB4F,EAAQQ,EAAQpB,EY7NxC9E,EAAQ0I,cZ6NgBhD,EY7NYsC,EZ6NJ9B,EY7NiBoJ,EZ6NTxK,EY7NqB2K,EAAWnO,OZ8NvE,YAAkE,IAAtD0B,EAAqD,EAArDA,SAAUS,EAA2C,EAA3CA,aAAcD,EAA6B,EAA7BA,YAAaE,EAAgB,EAAhBA,aACjDqB,EAAeC,EAAiBhC,GAChC4M,EAAYzL,IACdW,GAASC,EAAaW,GAAQxC,OAAOgD,GAAQlG,QAAQsB,OACxDyD,EAAaW,GAAQxC,OAAOgD,GAAQlG,QAAQW,KAAKiP,GAEjD7K,EAAaW,GAAQxC,OAAOgD,GAAQlG,QAAQkF,OAAOJ,EAAO,EAAG8K,GAE9D,IAAIC,EAAkBnM,EAMtB,OALID,IAAiBiC,GAAUlC,IAAgB0C,GAC1CxC,EAAeoB,GAClB+K,IAGK,CACN7M,SAAU+B,EACVrB,aAAcmM,KY9OuE,kBAAmB7H,EAAasH,IADlH,iCAFM,0BCxBG,SAASQ,GAAT,GAA2G,IAAxFlR,EAAuF,EAAvFA,OAAQmR,EAA+E,EAA/EA,mBAAoBN,EAA2D,EAA3DA,WAAYzP,EAA+C,EAA/CA,QAASgQ,EAAsC,EAAtCA,UAAWV,EAA2B,EAA3BA,WAAYtH,EAAe,EAAfA,YAAe,EAC1F2D,oBAAS,GADiF,mBACjHvD,EADiH,KACxGE,EADwG,KAElHmC,EACL,iCACC,wBAAQ1L,UAAU,mBAAmBe,QAAS,kBAAMwI,GAAYF,IAAhE,SAA2EA,EAAU,SAAW,SAChG,wBAAQrJ,UAAU,mBAAmBoK,UAAQ,EAA7C,sBACA,wBAAQpK,UAAU,mBAAmBoK,UAAQ,EAA7C,qBAGI8G,EAAgBR,EACrB,cAACD,GAAD,CACCC,WAAYA,EACZrH,QAASA,EACTpI,QAASA,EACTsP,WAAYA,EACZtH,YAAaA,IAEb,oCAEF,OACC,gCACC,cAACrJ,EAAD,CAAKC,OAAQA,EAAOiM,KAAM/L,YAAY,gBAAtC,SACC,+BACGiR,GAAsBE,MAG1B,cAACtR,EAAD,CAAKC,OAAQA,EAAOmM,OAApB,SACC,gCACC,cAACpL,EAAD,CACCC,UAAWmQ,EAAoBlQ,YAAa,SAACD,GAAD,OAAcI,EAAQkQ,uBAAuBtQ,MAC1F,oDAAuB6P,GAAe,MAAQO,MAC5CD,GAAsBtF,GACtBsF,GAAsB,+BCnCd,SAASI,GAAT,GAAuE,IAAtD7F,EAAqD,EAArDA,QAASwE,EAA4C,EAA5CA,KAAMsB,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,WAAYC,EAAkB,EAAlBA,KAAMC,EAAY,EAAZA,SACxE,IAAKjG,EACJ,OAAO,KAGR,IACM7K,EAAS,QACf,OACC,gCACC,qBACCR,MAAO,CACNiQ,gBAAiB,kBACjBhQ,SAAU,WACVC,IAAK,EACLE,KAAM,EACNE,MAAO,QACPE,OAAQ,WAGV,cAACd,EAAD,CAAKC,OAAQ,CACZU,EAAG8N,GAAKA,GAAK,QAAS,IAfX,OAewB,IAAK,GACxChO,EAAGgO,GAAKA,GAAK,QAAS,IAAK3N,GAAS,IAAK,GACzCD,EAjBW,MAkBXE,EAAGD,GAJJ,SAMC,sBAAKR,MAAO,CAAEiQ,gBAAiB,QAASzP,OAAQ,OAAQ+Q,UAAW,aAAcC,QAAS,QAA1F,UACE3B,EACD,sBAAK7P,MAAO,CACXC,SAAU,WACVwR,OAAQ,OACRC,MAAO,QAHR,UAMC,wBAAQ7Q,QAAS,kBAAMwQ,KAAvB,SAAgCF,SAClB9M,IAAbiN,GAA0B,wBAAQxR,UAAU,eAAee,QAAS,kBAAMyQ,KAAhD,SAA6DF,eCrCvF,SAASO,GAAiCjM,GAAO,MAkBxD,SAAwBkM,GAEvB,IADAA,EAAYA,EAAUC,eACR3P,WAAW,SAAW0P,EAAU7O,SAAS,KAAM,CAE5D,OADgB6O,EAAUE,QAAQ,OAAQ,IAAIA,QAAQ,IAAK,IAAIvP,MAAM,KAAKrB,KAAI,SAAAE,GAAC,OAAI8B,OAAO9B,EAAEkB,WAASpB,KAAI,SAAAE,GAAC,OAAI8B,OAAO6O,MAAM3Q,GAAK,EAAIA,KAIrI,IAAK2N,OAAOiD,iBAAkB,MAAO,CAAC,IAAK,IAAK,KAChD,IAAMC,EAAMC,SAASC,eAAe,QACpCF,EAAIjS,MAAM0F,MAAQkM,EAClB,IAEMQ,EAFQrD,OAAOiD,iBAAiBC,GAAKvM,MAEzBoM,QAAQ,OAAQ,IAAIA,QAAQ,IAAK,IAAIvP,MAAM,KAAKrB,KAAI,SAAAE,GAAC,OAAI8B,OAAO9B,EAAEkB,WACpF,GAAe,IAAX8P,EAAI,IAAuB,IAAXA,EAAI,IAAuB,IAAXA,EAAI,IACrB,UAAdR,EACH,MAAO,CAAC,IAAK,IAAK,KAGpB,OAAOQ,EAjCWC,CAAe3M,GAAOxE,IAAIoR,IAHW,mBAKvD,MADU,MAJ6C,KAIhC,MAJgC,KAInB,MAJmB,KAK5C,IAGZ,SAASA,GAASC,GAOjB,OANAA,GAAQ,MACC,OACRA,GAAQ,MAERA,GAAMA,EAAI,MAAS,MAAS,IAEtBA,ECZR,SAASC,GAAT,GAA8C,IAAvBlR,EAAsB,EAAtBA,KAAMoE,EAAgB,EAAhBA,MAAOxB,EAAS,EAATA,MAC7BoF,EAAchI,GAAQ,iBAC5B,OAAO,qBAAItB,MAAO,CAAEiQ,gBAAiBvK,EAAOA,MAAOiM,GAAiCjM,GAAS,QAAU,IAAhG,UACN,sBAAM5F,UAAU,YAAhB,SAA8BwJ,IAC9B,sBAAMxJ,UAAU,YAAhB,SAA+BoE,GAAS7C,GAAY6C,EAAO5C,IAAU,QAIvE,SAASmR,GAAT,GAAwE,IAApDnR,EAAmD,EAAnDA,KAAMoE,EAA6C,EAA7CA,MAAOG,EAAsC,EAAtCA,MAAe9E,GAAuB,EAA/BiI,OAA+B,EAAvBjI,SAASsI,EAAc,EAAdA,WAExD,OACC,+BACC,qBAAIvJ,UAAU,oBAAd,UACE+F,EAAQ,EADV,OAGA,6BAEC,uBACC/F,UAAU,aACV+J,YAAY,YACZ9H,KAAK,OACLC,MAAOV,EACPwI,SAAU,SAACtH,GACVzB,EAAQ2R,UAAU5K,EAAkBjC,EAAO,OAAQrD,EAAEuH,OAAO/H,aAI/D,6BACC,uBACClC,UAAU,aACV+J,YAAY,2CACZ9H,KAAK,OACLC,MAAO0D,EACPoE,SAAU,SAACtH,GACVzB,EAAQ2R,UAAU5K,EAAkBjC,EAAO,QAASrD,EAAEuH,OAAO/H,aAGhE,oBAAIlC,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAcoK,UAAyB,EAAMV,MAAM,UAAU3I,QAAS,aAAxF,sBAKD,oBAAIf,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,YAAYU,UAAoB,EAAMrJ,QAAS,aAArF,sBAKD,oBAAIf,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,SAAS3I,QAAS,WACvDE,EAAQuJ,aAAR,yBAAuChJ,EAAvC,2EAAsH,UAAU,WAC/HP,EAAQwJ,cAEN,UAAU,WACZxJ,EAAQwJ,gBAEPL,UAAQ,EAPX,iBAWD,oBAAIpK,UAAU,oBAAd,SACC,wBAAQA,UAAU,cAAc0J,MAAM,mBAAmB3I,QAAS,WACjEE,EAAQ2R,UAAUhL,EAAW7B,EAAQ,GAAI,iBACzCwD,GAAW,IACTa,UAAQ,EAHX,mBAnDO,QAAUrE,GA6DrB,SAASxE,GAAY6C,EAAO5C,GAAO,IAAD,EACP4C,EAAM5C,GAAxBU,EADyB,EACzBA,MAAO2Q,EADkB,EAClBA,OACf,MAAM,GAAN,OAAU3Q,EAAV,aAAoB2Q,GAAU,EAAI,IAAM,IAAxC,OAA6CA,EAA7C,KAGc,SAASC,GAAT,GAA2E,IAAvDlO,EAAsD,EAAtDA,MAAOR,EAA+C,EAA/CA,MAAOiF,EAAwC,EAAxCA,QAASpI,EAA+B,EAA/BA,QAASsI,EAAsB,EAAtBA,WAAYwJ,EAAU,EAAVA,OACxEC,EAAY,GACdD,GACHA,EAAOtQ,MAAM,KAAKI,SAAQ,SAAAoQ,GACzB,IAAMzR,EAAOyR,EAAEzQ,OACfwQ,EAAUpR,KAAKJ,MAIjB,IAOI0R,EAPEC,EAAiBJ,EAAiBnO,EAAMmO,QAAO,SAAAhR,GACpD,IAAKA,EAAKP,KAAM,OAAO,EACvB,IAAK,IAAIF,EAAI,EAAGA,EAAI0R,EAAUzQ,OAAQjB,IACrC,GAAIS,EAAKP,KAAKiE,SAASuN,EAAU1R,IAAK,OAAO,EAE9C,OAAO,KALwBsD,EAShC,GAAIyE,EACH6J,EAAcC,EAAc/R,KAAI,SAACW,EAAMT,GACtC,OAAO,cAACqR,GAAD,CACNnR,KAAMO,EAAKP,KACXoE,MAAO7D,EAAK6D,MAEZG,MAAOzE,EACPL,QAASA,EACTsI,WAAYA,EACZL,OAAQ5H,IAAMsD,EAAMrC,OAAS,GAJxBjB,UAOD,CACN4R,EAAc,GACd,IAAK,IAAI5R,EAAI,EAAGA,EAAI6R,EAAc5Q,OAAQjB,GAAK,EAE9C4R,EAAYtR,KACX,+BACE,cAAC8Q,GAAD,CAAalR,KAAM2R,EAAc7R,GAAGE,KAAMoE,MAAOuN,EAAc7R,GAAGsE,MAAOxB,MAAOA,IAChF+O,EAAc7R,EAAI,IAAM,cAACoR,GAAD,CAAalR,KAAM2R,EAAc7R,EAAI,GAAGE,KAAMoE,MAAOuN,EAAc7R,EAAI,GAAGsE,MAAOxB,MAAOA,IAChH+O,EAAc7R,EAAI,IAAM,cAACoR,GAAD,CAAalR,KAAM2R,EAAc7R,EAAI,GAAGE,KAAMoE,MAAOuN,EAAc7R,EAAI,GAAGsE,MAAOxB,MAAOA,IAChH+O,EAAc7R,EAAI,IAAM,cAACoR,GAAD,CAAalR,KAAM2R,EAAc7R,EAAI,GAAGE,KAAMoE,MAAOuN,EAAc7R,EAAI,GAAGsE,MAAOxB,MAAOA,MAJzG9C,IASZ,OACC,kCACC,gCACE4R,IAEF,6BACC,oBAAIpJ,QAAQ,IAAZ,SACC,wBAAQ/I,QAAS,WAChB,IAAMiK,EAAMpG,EAAMrC,OAClBtB,EAAQ2R,UAAUhL,EAAWoD,GAAM,iBACnCzB,GAAW,IAHZ,yBAFM,sBC5HI,SAAS6J,GAAT,GAAoH,IAAnGvT,EAAkG,EAAlGA,OAAQmR,EAA0F,EAA1FA,mBAAkCpM,GAAwD,EAAtEyO,aAAsE,EAAxDzO,OAAO3D,EAAiD,EAAjDA,QAASqS,EAAwC,EAAxCA,gBAAiBC,EAAuB,EAAvBA,oBAAuB,EAEnG3G,oBAAS,GAF0F,mBAE1HvD,EAF0H,KAEjHE,EAFiH,OAGrGqD,mBAAS,IAH4F,mBAG1HmG,EAH0H,KAGlHS,EAHkH,KAK3HC,EAAYzC,EACZtF,EACL,iCACC,wBAAQ1L,UAAU,mBAAmBe,QAAS,kBAAMwI,GAAYF,IAAhE,SAA2EA,EAAU,SAAW,SAChG,uBACCrJ,UAAU,mBACViC,KAAK,OACLC,MAAO6Q,EACPhJ,YAAY,6BACZC,SAAU,SAACtH,GAAD,OAAO8Q,EAAU9Q,EAAEuH,OAAO/H,UAErC,wBAAQlC,UAAU,+BAA+B0J,MAAM,QAAQ3I,QAAS,kBAAMyS,EAAU,KAAxF,kBAIEpP,OAAQG,EACZ,GAAI+O,GAAmBC,EAAqB,CAE3C,IAAK,IAAMhO,KADXnB,EAAQ,GACUkP,EACjBlP,EAAMmB,GAAO,CACZrD,MAAOoR,EAAgB/N,GACvBsN,OAAQS,EAAgB/N,IAASA,KAAOgO,EAAuBA,EAAoBhO,GAAO,IAG5FX,EAAQA,EAAMmO,QAAO,SAAAhR,GACpB,OAAOA,EAAKP,QAAQ8R,KAItB,IAAMJ,EACL,cAACJ,GAAD,CACClO,MAAOA,EACPyE,QAASA,EACTpI,QAASA,EACTsI,WAAYA,EACZwJ,OAAQA,EACR3O,MAAOA,IAGT,OACC,gCACC,cAACxE,EAAD,CAAKC,OAAQA,EAAOiM,KAAM/L,YAAY,gBAAtC,SAEC,+BACG0T,GAAaP,MAIjB,eAACtT,EAAD,CAAKC,OAAQA,EAAOmM,OAApB,UACC,gCAEC,gDACEyH,GAAa/H,MAGd+H,GACD,gDAGCzC,GAAsB,6B,IC+Yb0C,G,kDArcb,WAAYpI,GAAQ,IAAD,8BACjB,cAAMA,IACDvH,MAAQ,CACX4P,KAAM,aACNnP,YAAa,mBAEbuH,eAAe,EACfiF,oBAAoB,EACpBrE,iBAAiB,EACjBiH,gBAAYrP,EAEZN,SAAU,GACVW,MAAO,GACP4D,UAAW,CACTC,QAAS,GACTpE,WAAOE,GAGTG,cAAe,EACfD,aAAc,EACdE,cAAe,EACfkP,aAAc,EACdC,YAAa,EACbC,YAAa,EAEbrH,UAAU,EACVsH,oBAAgBzP,EAEhBiG,cAAc,EACdyJ,eAAW1P,EACX2P,mBAAe3P,EACf4P,iBAAa5P,EACb6P,qBAAiB7P,EACjB8P,eAAW9P,EAEX+P,0BAAsB/P,EACtBoG,oBAAgBpG,GApCD,E,wDA0CnB,SAAqBL,EAAQzB,GAAQ,IAAD,OAClC,GAAI+I,KAAKzH,MAAMuQ,qBAAsB,CACnC,GAAIpQ,EAASsH,KAAKzH,MAAME,SAAS1B,OAAQ,OACzC,GAAI2B,EAASsH,KAAKzH,MAAM8P,YAAa,OACrC,GAAI3P,IAAWsH,KAAKzH,MAAM8P,aAAepR,EAAQ+I,KAAKzH,MAAM+P,WAAY,OAGtEtI,KAAKzH,MAAMuQ,sBACbrF,OAAOsF,aAAa/I,KAAKzH,MAAMuQ,sBAEjC9I,KAAKC,SAAL,aACEoI,YAAa3P,EACb4P,WAAYrR,EACZsR,YAAa,EACbO,0BAAsB/P,GlB+QrB,SAAmCiE,EAAWtE,EAAQzB,GAC5D,IAAK+F,EAAUnE,MAAO,MAAO,GAC7B,GAAImE,EAAUnE,MAAMH,OAASA,EAAQ,MAAO,GAC5C,GAAIsE,EAAUnE,MAAMH,SAAWA,GAC1BsE,EAAUnE,MAAM5B,MAAQA,EAAO,MAAO,GAE3C,IAAM+R,EAAgBjM,EAAkBC,GAExC,OADAgM,EAAcnQ,WAAQE,EACf,CACNiE,UAAWgM,GkBvRJC,CAA0BjJ,KAAKzH,MAAMyE,UAAWtE,EAAQzB,KAC1D,WACD,IAAMiS,EAASzF,OAAO0F,YAAW,WAC/B,EAAKC,oBACJ,KACH,EAAKnJ,SAAS,CACZ6I,qBAAsBI,EACtBf,KAAM,4B,6BAMZ,WAAmB,IAAD,OACZzS,EAAIsK,KAAKzH,MAAM8P,YACf1S,EAAIqK,KAAKzH,MAAM+P,WACftM,EAAIgE,KAAKzH,MAAMgQ,YAEnB,GADA1G,QAAQC,IAAR,2BAAgCpM,EAAhC,eAAwCC,EAAxC,eAAgDqG,IAC5CtG,GAAKsK,KAAKzH,MAAME,SAAS1B,OAC3BiJ,KAAKqJ,2BADP,CAIA,KAAO1T,GAAKqK,KAAKzH,MAAME,SAAS/C,GAAGiD,OAAO5B,QAAQ,CAEhD,KADArB,GACSsK,KAAKzH,MAAME,SAAS1B,OAE3B,YADAiJ,KAAKqJ,uBAGP1T,EAAI,EAEN,KAAOqG,GAAKgE,KAAKzH,MAAME,SAAS/C,GAAGiD,OAAOhD,GAAGF,QAAQsB,QAAQ,CAE3D,IADApB,IACOA,GAAKqK,KAAKzH,MAAME,SAAS/C,GAAGiD,OAAO5B,QAAQ,CAEhD,KADArB,GACSsK,KAAKzH,MAAME,SAAS1B,OAE3B,YADAiJ,KAAKqJ,uBAGP1T,EAAI,EAENqG,EAAI,EAGN,IAAMsN,ElByQH,SAA8BtM,EAAWvE,EAAUW,EAAO1D,EAAGC,EAAGqG,GACtE,GAAIgB,EAAUnE,MAAO,MAAO,GAC5B,IAYI0Q,EACAC,EAbER,EAAgBjM,EAAkBC,GAClCnH,EAAS4C,EAAS/C,GAAGiD,OAAOhD,GAAGF,QAAQuG,GAC7C,GAAInG,EAAOiD,WAOV,OANAkQ,EAAcnQ,MAAQ,CACrBH,OAAQhD,EACRuB,MAAOtB,EACPE,OAAQmG,EACRoJ,QAASvP,EAAOiD,YAEV,CAAEkE,UAAWgM,GAXoD,MAgBlCjN,EAAyBtD,EAAU/C,EAAGC,EAAGqG,GAhBP,mBAgBlEE,EAhBkE,KAgB3DD,EAhB2D,KAgBpDE,EAhBoD,KAiBzE,GAjByE,KAmBlE,CAAC,IAAD,EACuBmB,EAAWN,EAAUC,QAAQf,GAAOD,GAAOE,GAAQ/C,EAAOvD,EAAOK,QADxF,mBACLqT,EADK,KACOC,EADP,SAFO,CAAC,IAAD,EACgBlM,EAAW,GAAIlE,EAAOvD,EAAOK,QAD7C,mBACZqT,EADY,KACAC,EADA,KA0Bd,OApBIA,EACHR,EAAcnQ,MAAQ,CACrBH,OAAQhD,EACRuB,MAAOtB,EACPE,OAAQmG,EACRoJ,QAASoE,IAGLR,EAAc/L,UAClB+L,EAAc/L,QAAU,IAEpB+L,EAAc/L,QAAQvH,KAC1BsT,EAAc/L,QAAQvH,GAAK,IAEvBsT,EAAc/L,QAAQvH,GAAGC,KAC7BqT,EAAc/L,QAAQvH,GAAGC,GAAK,IAE/BqT,EAAc/L,QAAQvH,GAAGC,GAAGqG,GAAKuN,GAG3B,CAAEvM,UAAWgM,GkBpTIS,CAAqBzJ,KAAKzH,MAAMyE,UAAWgD,KAAKzH,MAAME,SAAUuH,KAAKzH,MAAMa,MAAO1D,EAAGC,EAAGqG,GAC7GgE,KAAKC,SAAL,aACEoI,YAAa3S,EACb4S,WAAY3S,EACZ4S,YAAavM,EAAI,GACdsN,IACF,WACD,IAAMJ,EAASzF,OAAO0F,YAAW,WAC/B,EAAKC,oBACJ,KACH,EAAKnJ,SAAS,CACZ6I,qBAAsBI,EACtBf,KAAK,0BAAD,OAA4B,EAAK5P,MAAME,SAAS/C,GAAGM,KAAnD,sBAAqE,EAAKuC,MAAME,SAAS/C,GAAGiD,OAAOhD,GAAGK,KAAtG,oBAAsH,EAAKuC,MAAME,SAAS/C,GAAGiD,OAAOhD,GAAGF,QAAQuG,GAAGhG,c,kCAK5K,WACMgK,KAAKzH,MAAMuQ,sBACbrF,OAAOsF,aAAa/I,KAAKzH,MAAMuQ,sBAEjC9I,KAAKC,SAAS,CACZ6I,0BAAsB/P,EACtBoP,KAAK,iC,+BAIT,WACE1E,OAAOiG,iBAAiB,SAAU1J,KAAK2J,oBAAoBtJ,KAAKL,OAChEA,KAAK2J,sBACL3J,KAAKyC,gBAAgBxK,GACrB+H,KAAK0C,aAAY,K,yBAInB,SAAYxB,GAAW,IAAD,OACpB,GAAKA,EAeE,CACL,GAAIlB,KAAKzH,MAAMiQ,eAAgB,CAC7B,IAAMU,EAASlJ,KAAKzH,MAAMiQ,eAC1BxI,KAAKC,SAAS,CACZuI,eAAgB/E,OAAOmG,aAAY,WACjC,EAAKlI,4BACJ,KACHR,UAAU,IACT,WACDuC,OAAOoG,cAAcX,WAGvBlJ,KAAKC,SAAS,CACZuI,eAAgB/E,OAAOmG,aAAY,WACjC,EAAKlI,4BACJ,KACHR,UAAU,IAGdlB,KAAK0B,8BAlCQ,CACb,GAAI1B,KAAKzH,MAAMiQ,eAAgB,CAC7B,IAAMU,EAASlJ,KAAKzH,MAAMiQ,eAC1BxI,KAAKC,SAAS,CACZuI,oBAAgBzP,EAChBmI,UAAU,IACT,WACDuC,OAAOoG,cAAcX,WAGvBlJ,KAAKC,SAAS,CACZiB,UAAU,IAGdlB,KAAK8J,eAAe,4B,6BAyBxB,SAAgBC,EAAyB/I,GAAQ,IAAD,OACxCgB,EAAYhB,GAASJ,IACrB4B,EAAcuH,IAChBvH,GACFxC,KAAKC,SAAS,CACZxH,SAAU+J,EAAY/J,SACtBS,aAAcsJ,EAAYtJ,aAC1BD,YAAauJ,EAAYvJ,YACzBD,YAAawJ,EAAYxJ,YACzBI,MAAOoJ,EAAYpJ,QAClB,WACD,EAAK0Q,eAAL,yBAAsC/I,EAAeiB,GAArD,QACA,EAAKgI,qBAAqB,EAAG,Q,qCAKnC,WACE,IAAMhI,EAAYpB,KnBnKf,SAA4BrI,GAClC,IAAMzB,EAAMuB,KAAK4R,UAAU5P,EAAS9B,IACpCL,aAAagS,QAAQlS,EAAKlB,GmBkKvBqT,CAAmBnK,KAAKoK,mBACxBpK,KAAK8J,eAAL,oCAAiD/I,EAAeiB,GAAhE,8BAAgG,IAAInB,S,6BAGtG,WACE,MAAO,CACLpI,SAAUuH,KAAKzH,MAAME,SACrBS,aAAc8G,KAAKzH,MAAMW,aACzBD,YAAa+G,KAAKzH,MAAMU,YACxBE,aAAc6G,KAAKzH,MAAMY,aACzBH,YAAagH,KAAKzH,MAAMS,YACxBqR,MAAOrK,KAAKzH,MAAMa,S,iCAItB,WACE,IAAMgP,EAAa/T,GAAO2L,KAAKzH,MAAMgI,cAAeP,KAAKzH,MAAMiN,mBAAoBxF,KAAKzH,MAAM4I,iBAC9FnB,KAAKC,SAAS,CAAEmI,iB,kCAGlB,WACE3E,OAAO6G,oBAAoB,SAAUtK,KAAK2J,oBAAoBtJ,KAAKL,OAC/DA,KAAKzH,MAAMiQ,gBACb/E,OAAOoG,cAAc7J,KAAKzH,MAAMiQ,gBAE9BxI,KAAKzH,MAAMuQ,sBACbrF,OAAOsF,aAAa/I,KAAKzH,MAAMuQ,wB,8BAInC,SAAiBvI,GACfP,KAAKC,SAAS,CACZM,cAAeA,EACf6H,WAAY/T,GAAOkM,EAAeP,KAAKzH,MAAMiN,mBAAoBxF,KAAKzH,MAAM4I,qB,mCAIhF,SAAsBqE,GACpBxF,KAAKC,SAAS,CACZuF,mBAAoBA,EACpB4C,WAAY/T,GAAO2L,KAAKzH,MAAMgI,cAAeiF,EAAoBxF,KAAKzH,MAAM4I,qB,gCAIhF,SAAmBA,GACjBnB,KAAKC,SAAS,CACZkB,gBAAiBA,EACjBiH,WAAY/T,GAAO2L,KAAKzH,MAAMgI,cAAeP,KAAKzH,MAAMiN,mBAAoBrE,O,4BAIhF,SAAegH,GACbnI,KAAKC,SAAS,CAAEkI,W,4BAGlB,SAAenS,GACbgK,KAAKC,SAAS,CACZjH,YAAahD,M,0BAIjB,SAAauU,EAAoBpC,EAAME,EAAaC,GAAa,IAAD,OACxDtG,EAAYpB,IAClBZ,KAAKC,SAAL,eACKsK,EAAmB,CACpB9R,SAAUuH,KAAKzH,MAAME,SACrBS,aAAc8G,KAAKzH,MAAMW,aACzBC,aAAc6G,KAAKzH,MAAMY,aACzBF,YAAa+G,KAAKzH,MAAMU,gBAEzB,WACGkP,GACF,EAAK2B,eAAL,UAAuB3B,EAAvB,aAAgCpH,EAAeiB,GAA/C,aAEkBjJ,IAAhBsP,GACF,EAAK2B,qBAAqB3B,EAAaC,GAAc,Q,uBAK3D,SAAUiC,EAAoBpC,EAAMqC,GAAgB,IAAD,OAC3CxI,EAAYpB,IAClBZ,KAAKC,SAAL,eACKsK,EAAmB,CACpB9R,SAAUuH,KAAKzH,MAAME,SACrBW,MAAO4G,KAAKzH,MAAMa,UAEnB,WACG+O,GACF,EAAK2B,eAAL,UAAuB3B,EAAvB,aAAgCpH,EAAeiB,GAA/C,QAEEwI,GACF,EAAKR,qBAAqB,EAAG,Q,0BAKnC,SAAazF,EAAMsB,EAAQE,EAAMD,EAAYE,GAC3ChG,KAAKC,SAAS,CACZjB,cAAc,EACdyJ,UAAW1C,EACX2C,cAAe1C,EACf2C,YAAa9C,EACb+C,gBAAiB9C,EACjB+C,UAAWtE,M,uBAIf,WACEvE,KAAKC,SAAS,CACZjB,cAAc,EACdyJ,eAAW1P,EACX2P,mBAAe3P,EACf4P,iBAAa5P,EACb6P,qBAAiB7P,M,iCAIrB,YnBlTK,SAAwBR,GAC9B,IAAMzB,EAAMuB,KAAK4R,UAAU5P,EAAS9B,IAC9BkS,EAAO,IAAIC,KAAK,CAAC5T,GAAM,CAAEL,KAAM,SAC/BuF,EAAI4K,SAAS+D,cAAc,KAC3BC,GAAYrS,EAAMS,aAAe,oBAAsB,QAC7DgD,EAAEwF,SAAWoJ,EACb5O,EAAE6O,KAAOC,IAAIC,gBAAgBN,GAC7BzO,EAAEgP,QAAQC,YAAc,CAAC,OAAQjP,EAAEwF,SAAUxF,EAAE6O,MAAMvU,KAAK,KAC1D0F,EAAEtH,MAAMwW,QAAU,OAClBtE,SAASuE,KAAKC,YAAYpP,GAC1BA,EAAEqP,QACFzE,SAASuE,KAAKG,YAAYtP,GAC1BmN,YAAW,WAAc2B,IAAIS,gBAAgBvP,EAAE6O,QAAU,MmBuStDW,CAAexL,KAAKoK,qB,uBAGtB,SAAU1U,EAAGC,GAAI,IAAD,OACRqM,EAAYpB,IAClBZ,KAAKC,SAAS,CACZ/G,aAAcxD,EACduD,YAAatD,EACbwD,cAAe,IACd,WACD,EAAK2Q,eAAL,gCAA6C/I,EAAeiB,GAA5D,a,wBAIJ,SAAWhG,GAAI,IAAD,OACZ,GAAIgE,KAAKzH,MAAMW,cAAgB,GAAK8G,KAAKzH,MAAMU,aAAe,EAAG,CAC/D,IAAM+I,EAAYpB,IAClBZ,KAAKC,SAAS,CACZ9G,aAAc6C,IACb,WACD,EAAK8N,eAAL,oCAAiD/I,EAAeiB,GAAhE,c,oBAKN,WAAU,IAAD,OACP,IAAKhC,KAAKzH,MAAM6P,WACd,OAAO,KAGT,IAyBIN,EAAiBC,EAzBftS,EAAU,CACdgL,iBAAkBT,KAAKS,iBAAiBJ,KAAKL,MAC7C2F,sBAAuB3F,KAAK2F,sBAAsBtF,KAAKL,MACvD4C,mBAAoB5C,KAAK4C,mBAAmBvC,KAAKL,MACjD8J,eAAgB9J,KAAK8J,eAAezJ,KAAKL,MACzC0C,YAAa1C,KAAK0C,YAAYrC,KAAKL,MACnChB,aAAcgB,KAAKhB,aAAaqB,KAAKL,MACrCf,UAAWe,KAAKf,UAAUoB,KAAKL,MAC/B0B,wBAAyB1B,KAAK0B,wBAAwBrB,KAAKL,MAC3DwB,SAAUxB,KAAKyL,oBAAoBpL,KAAKL,MACxC2B,eAAgB3B,KAAK2B,eAAetB,KAAKL,MACzCyC,gBAAiBzC,KAAKyC,gBAAgBpC,KAAKL,MAC3CgK,qBAAsBhK,KAAKgK,qBAAqB3J,KAAKL,MACrD7B,aAAc6B,KAAK7B,aAAakC,KAAKL,MACrCrB,UAAW,SAAC1H,GAAD,OAAW,EAAKgJ,SAAS,CAAEd,eAAgBxF,EAAc1C,GAAQkR,KAAM,mBAClFhJ,eAAgBa,KAAKzH,MAAM4G,eAC3BT,UAAWsB,KAAKtB,UAAU2B,KAAKL,MAC/BoH,UAAWpH,KAAKoH,UAAU/G,KAAKL,OAG3B0L,EAAa1L,KAAKzH,MAAMW,cAAgB,GAC5C8G,KAAKzH,MAAMW,aAAe8G,KAAKzH,MAAME,SAAS1B,QAC9CiJ,KAAKzH,MAAMU,aAAe,GAC1B+G,KAAKzH,MAAMU,YAAc+G,KAAKzH,MAAME,SAASuH,KAAKzH,MAAMU,aAAaN,OAAO5B,OAG9E,GAAI2U,IACU1L,KAAKzH,MAAMyE,UAAUC,SAEb+C,KAAKzH,MAAMyE,UAAUC,QAAQ+C,KAAKzH,MAAMW,eAEvC8G,KAAKzH,MAAMyE,UAAUC,QAAQ+C,KAAKzH,MAAMW,cAAc8G,KAAKzH,MAAMU,cACpE,CACZ6O,EAAkB9H,KAAKzH,MAAMyE,UAAUC,QAAQ+C,KAAKzH,MAAMW,cAAc8G,KAAKzH,MAAMU,aAAa+G,KAAKzH,MAAMY,cAD/F,MAE2B4C,EAAyBiE,KAAKzH,MAAME,SAAUuH,KAAKzH,MAAMW,aAAc8G,KAAKzH,MAAMU,YAAa+G,KAAKzH,MAAMY,cAFrI,mBAEL+C,EAFK,KAEED,EAFF,KAESE,EAFT,KAIZ,GADA4L,EAAsB,GAHV,KAMV,GADsB/H,KAAKzH,MAAMyE,UAAUC,QAAQf,GAE5B8D,KAAKzH,MAAMyE,UAAUC,QAAQf,GAAOD,KAEvD8L,EAAsB/H,KAAKzH,MAAMyE,UAAUC,QAAQf,GAAOD,GAAOE,IAQ/E,OAEE,sBAAKzH,MAAO,CACVM,MAAO,QACPE,OAAQ,SAFV,UAIE,cAACd,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAW5H,OAAQjM,YAAY,yBAAvD,SACE,cAAC0M,EAAD,CACEC,SAAUlB,KAAKzH,MAAM2I,SACrBX,cAAeP,KAAKzH,MAAMgI,cAC1BY,gBAAiBnB,KAAKzH,MAAM4I,gBAC5BnI,YAAagH,KAAKzH,MAAMS,YACxBvD,QAASA,MAEb,cAACrB,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAWjE,KAAM5P,YAAY,SAArD,SACE,cAAC,EAAD,CAASF,OAAQ2L,KAAKzH,MAAM6P,WAAWjE,KAAM5D,cAAeP,KAAKzH,MAAMgI,cAAe9K,QAASA,EAASgD,SAAUuH,KAAKzH,MAAME,aAE/H,cAACrE,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAWhE,OAAQ7P,YAAY,SAAvD,SACE,cAAC+P,GAAD,CAAQC,KAAMvE,KAAKzH,MAAM4P,SAE3B,cAAC/T,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAWxS,IAAnC,SACE,wBAAQ+V,IAAI,4CAA4CzN,MAAM,aAAalJ,MAAM,OAAOE,OAAO,WAEjG,cAACd,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAW3S,QAASlB,YAAY,SAAxD,SACE,cAACgR,GAAD,CACElR,OAAQ2L,KAAKzH,MAAM6P,WAAW3S,QAC9B+P,mBAAoBxF,KAAKzH,MAAMiN,mBAC/B/P,QAASA,EACTyP,WAAYwG,GAAc1L,KAAKzH,MAAME,SAASuH,KAAKzH,MAAMW,cAAcP,OAAOqH,KAAKzH,MAAMU,aAAaxD,QACtGgQ,UAAWiG,GAAc1L,KAAKzH,MAAME,SAASuH,KAAKzH,MAAMW,cAAcP,OAAOqH,KAAKzH,MAAMU,aAAajD,KACrG+O,WAAY/E,KAAKzH,MAAMU,YACvBwE,YAAauC,KAAKzH,MAAMW,kBAE1B8G,KAAKzH,MAAM6P,WAAWpL,UAAUqH,MAChC,cAACjQ,EAAD,CAAKC,OAAQ2L,KAAKzH,MAAM6P,WAAWpL,UAAWzI,YAAY,SAA1D,SACE,cAACqT,GAAD,CACEvT,OAAQ2L,KAAKzH,MAAM6P,WAAWpL,UAC9BvH,QAASA,EACT+P,mBAAoBxF,KAAKzH,MAAMiN,mBAC/BjF,cAAeP,KAAKzH,MAAMgI,cAC1BnH,MAAO4G,KAAKzH,MAAMa,MAClB0O,gBAAiBA,EACjBC,oBAAqBA,MAI3B,cAACnC,GAAD,CACE7F,QAASC,KAAKzH,MAAMyG,aACpBuF,KAAMvE,KAAKzH,MAAMsQ,UACjBhD,OAAQ7F,KAAKzH,MAAMoQ,YACnB7C,WAAY9F,KAAKzH,MAAMqQ,gBACvB7C,KAAM/F,KAAKzH,MAAMkQ,UACjBzC,SAAUhG,KAAKzH,MAAMmQ,uB,GA7bbhI,IAAMC,WCTxBiL,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEFlF,SAASC,eAAe,W","file":"static/js/main.103f676b.chunk.js","sourcesContent":["import clsx from 'clsx';\r\nexport default function Box({ layout, children, borderClass }) {\r\n\treturn (\r\n\t\t<div className={clsx(\"component\", borderClass)}\r\n\t\t\tstyle={{\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\ttop: layout.y,\r\n\t\t\t\tleft: layout.x,\r\n\t\t\t\twidth: layout.w,\r\n\t\t\t\theight: layout.h\r\n\t\t\t}}>\r\n\t\t\t{children}\r\n\t\t</div>\r\n\t);\r\n}","export default function ExpandButton({ expanded, setExpanded }) {\r\n\treturn (\r\n\t\t<button className=\"icon-button\" onClick={() => setExpanded(!expanded)}>{expanded ? \"-\" : \"+\"}</button>\r\n\t)\r\n}","export default function ActionSummary({ actions, b, s }) {\r\n\treturn actions.map((action, i) => (\r\n\t\t<tr key={`b_${b}_s_${s}_a_${i}_`}>\r\n\t\t\t<td></td><td></td>\r\n\t\t\t<td className=\"icon-button-width\">&gt;</td>\r\n\t\t\t<td>\r\n\t\t\t\t{!action.deltaString ? <em>{action.name}</em> : action.name}\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t));\r\n}","export function deltaToString(deltas) {\r\n\tconst array = [];\r\n\tfor (const name in deltas) {\r\n\t\tarray.push(itemToString(name, deltas[name]));\r\n\t}\r\n\treturn array.join(\", \");\r\n}\r\n\r\nexport function renameItemInDelta(deltas, oldName, newName) {\r\n\tif (oldName in deltas) {\r\n\t\tdeltas[newName] = deltas[oldName];\r\n\t\tdelete deltas.oldName;\r\n\t}\r\n\tfor (const name in deltas) {\r\n\t\tif (deltas[name].type.startsWith(\"ref\")) {\r\n\t\t\tif (deltas[name].value === oldName) {\r\n\t\t\t\tdeltas[name].value = newName;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction itemToString(name, item) {\r\n\tconst { type, value } = item;\r\n\tlet op;\r\n\tswitch (type) {\r\n\t\tcase \"add\":\r\n\t\t\tif (value >= 0) {\r\n\t\t\t\top = \"+\";\r\n\t\t\t} else {\r\n\t\t\t\top = \"-\";\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"set\":\r\n\t\tcase \"ref_set\":\r\n\t\t\top = \"=\";\r\n\t\t\tbreak;\r\n\t\tcase \"ref_add\":\r\n\t\t\top = \"=\";\r\n\t\t\tbreak;\r\n\t\tcase \"ref_sub\":\r\n\t\t\top = \"-\";\r\n\t\t\tbreak;\r\n\t\tdefault: op = \"?\"; break;\r\n\t}\r\n\tlet quantity = value;\r\n\tif (type.startsWith(\"ref\")) {\r\n\t\tquantity = `[${value}]`\r\n\t}\r\n\treturn `[${name}]${op}${quantity}`;\r\n}\r\n\r\nexport default function stringToDelta(str) {\r\n\tif (!str || !str.length) return [null, \"Delta string empty\"];\r\n\tif (!str.trim()) return [null, \"Delta string empty\"];\r\n\r\n\tconst array = str.split(\",\").map(e => e.trim());\r\n\tconst deltaObj = {};\r\n\tlet errors = [];\r\n\tarray.forEach(str => {\r\n\t\tconst [item, itemError] = parseDeltaItem(str.trim());\r\n\t\tif (item !== null) {\r\n\t\t\tdeltaObj[item.name] = {\r\n\t\t\t\ttype: item.type,\r\n\t\t\t\tvalue: item.value,\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (itemError !== null)\r\n\t\t\t\terrors.push(itemError);\r\n\t\t}\r\n\r\n\r\n\t});\r\n\treturn errors.length > 0 ? [null, errors.join(\"; \")] : [deltaObj, null];\r\n}\r\n\r\nfunction parseDeltaItem(str) {\r\n\t//\\[*?<name>](+|=|-)<quantity>\r\n\tif (!str || !str.length) return [null, null];//no item, skip\r\n\tif (!str.startsWith(\"[\")) return [null, `Invalid: ${str}`];\r\n\tconst nameEnd = str.indexOf(\"]\");\r\n\tif (nameEnd < 0) return [null, `Item name bracket not closed: ${str}`];\r\n\tconst name = str.substring(1, nameEnd);\r\n\tif (str.length <= nameEnd + 1) return [null, `Item [${name}] missing operator and quantity`];\r\n\tconst op = str[nameEnd + 1];\r\n\tconst value = str.substring(nameEnd + 2);\r\n\r\n\tif (value.startsWith(\"[\")) {\r\n\t\tif (!value.endsWith(\"]\")) return [null, `Item reference bracket not closed: ${value}`];\r\n\t\tconst ref = value.substring(1, value.length - 1);\r\n\t\tlet type;\r\n\t\tswitch (op) {\r\n\t\t\tcase \"+\": type = \"ref_add\"; break;\r\n\t\t\tcase \"-\": type = \"ref_sub\"; break;\r\n\t\t\tcase \"=\": type = \"ref_set\"; break;\r\n\t\t\tdefault: return [null, `Item [${name}]: unknown operator \"${op}\"`];\r\n\t\t}\r\n\t\treturn [{\r\n\t\t\tname: name,\r\n\t\t\ttype: type,\r\n\t\t\tvalue: ref,\r\n\t\t}, null]\r\n\t} else {\r\n\t\tlet num = Number(value);\r\n\t\tif (!Number.isInteger(num)) return [null, `Item [${name}]: invalid quantity \"${value}`];\r\n\t\tlet type;\r\n\t\tswitch (op) {\r\n\t\t\tcase \"+\": type = \"add\"; break;\r\n\t\t\tcase \"-\": type = \"add\"; num = -num; break;\r\n\t\t\tcase \"=\": type = \"set\"; break;\r\n\t\t\tdefault: return [null, `Item [${name}]: unknown operator \"${op}\"`];\r\n\t\t}\r\n\t\treturn [{\r\n\t\t\tname: name,\r\n\t\t\ttype: type,\r\n\t\t\tvalue: num,\r\n\t\t}, null]\r\n\t}\r\n}\r\n\r\n","import stringToDelta from \"./actiondelta\";\r\nconst KEY = \"RRT_STATE_v1\"\r\n\r\n\r\nexport function readFromFile(file, storedStateCallback) {\r\n\tif (file) {\r\n\r\n\t\tconst reader = new FileReader();\r\n\t\treader.onloadend = () => {\r\n\t\t\tconst str = reader.result;\r\n\t\t\tif (str) {\r\n\t\t\t\tstoredStateCallback(stringToState(JSON.parse(str)));\r\n\t\t\t} else {\r\n\t\t\t\tstoredStateCallback(stringToState(\"\"));\r\n\t\t\t}\r\n\t\t}\r\n\t\treader.readAsText(file);\r\n\t}\r\n\r\n}\r\n\r\nexport function downloadToFile(state) {\r\n\tconst str = JSON.stringify(minimize(state));\r\n\tconst blob = new Blob([str], { type: \"text\" });\r\n\tconst a = document.createElement('a');\r\n\tconst fileName = (state.projectName || \"Resource_Routing\") + \".json\";\r\n\ta.download = fileName\r\n\ta.href = URL.createObjectURL(blob);\r\n\ta.dataset.downloadurl = [\"text\", a.download, a.href].join(':');\r\n\ta.style.display = \"none\";\r\n\tdocument.body.appendChild(a);\r\n\ta.click();\r\n\tdocument.body.removeChild(a);\r\n\tsetTimeout(function () { URL.revokeObjectURL(a.href); }, 1500);\r\n}\r\n\r\nexport function readFromLocalStorage() {\r\n\tconst str = localStorage.getItem(KEY);\r\n\tif (str) {\r\n\t\treturn stringToState(JSON.parse(str));\r\n\t} else {\r\n\t\treturn stringToState(\"\");\r\n\t}\r\n}\r\n\r\nexport function saveToLocalStorage(state) {\r\n\tconst str = JSON.stringify(minimize(state));\r\n\tlocalStorage.setItem(KEY, str);\r\n}\r\n\r\nexport function clearLocalStorage() {\r\n\tlocalStorage.removeItem(KEY);\r\n}\r\n\r\nfunction stringToState(str) {\r\n\treturn fillActionDeltas(sanitizeState(str));\r\n}\r\n\r\nfunction fillActionDeltas(state) {\r\n\tstate.branches.forEach(branch => branch.splits.forEach(split => split.actions.forEach(action => {\r\n\t\tif (action.deltaString) {\r\n\t\t\tconst [delta, error] = stringToDelta(action.deltaString);\r\n\t\t\tif (error) {\r\n\t\t\t\taction.deltaError = error;\r\n\t\t\t\taction.deltas = {};\r\n\t\t\t} else {\r\n\t\t\t\taction.deltaError = undefined;\r\n\t\t\t\taction.deltas = delta;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\taction.deltaError = undefined;\r\n\t\t\taction.deltas = {};\r\n\t\t}\r\n\r\n\t})));\r\n\treturn state;\r\n}\r\n\r\nexport function sanitizeState(state) {\r\n\tif (!state) {\r\n\t\treturn {\r\n\t\t\tprojectName: \"Untitled Project\",\r\n\t\t\tactiveSplit: -1,\r\n\t\t\tactiveBranch: -1,\r\n\t\t\tactiveAction: -1,\r\n\t\t\tbranches: [],\r\n\t\t\titems: [],\r\n\t\t}\r\n\t}\r\n\tconst activeBranch = sanitizeIndex(state.activeBranch, state.branches);\r\n\tlet activeSplit;\r\n\tif (activeBranch === -1) {\r\n\t\tactiveSplit = -1;\r\n\t} else {\r\n\t\tactiveSplit = sanitizeIndex(state.activeSplit, state.branches[activeBranch].splits);\r\n\t}\r\n\tlet activeAction;\r\n\tif (activeSplit === -1) {\r\n\t\tactiveAction = -1;\r\n\t} else {\r\n\t\tactiveAction = sanitizeIndex(state.activeAction, state.branches[activeBranch].splits[activeSplit].actions.length);\r\n\t}\r\n\treturn {\r\n\t\tprojectName: state.projectName || \"Untitled Project\",\r\n\t\tactiveBranch,\r\n\t\tactiveSplit,\r\n\t\tactiveAction,\r\n\t\tbranches: sanitizeArray(state.branches).map(sanitizeBranch),\r\n\t\titems: sanitizeArray(state.items).map(sanitizeItem),\r\n\t}\r\n}\r\n\r\nfunction sanitizeArray(array) {\r\n\treturn array || [];\r\n}\r\n\r\nfunction sanitizeIndex(i, array) {\r\n\tif (i !== 0 && !i) return -1;\r\n\tif (!array || !array.length) return -1;\r\n\tif (i < 0) return -1;\r\n\tif (i >= array.length) return -1;\r\n\treturn i;\r\n}\r\n\r\nexport function sanitizeBranch(branch) {\r\n\tconst template = {\r\n\t\tname: \"\",\r\n\t\texpanded: false,\r\n\t\tsplits: []\r\n\t}\r\n\tif (!branch) {\r\n\t\treturn { ...template };\r\n\t}\r\n\tconst clean = { ...template };\r\n\tif (branch.name) {\r\n\t\tclean.name = branch.name;\r\n\t}\r\n\tif (branch.expanded) {\r\n\t\tclean.expanded = true;\r\n\t}\r\n\tif (branch.splits) {\r\n\t\tclean.splits = branch.splits.map(sanitizeSplit)\r\n\t}\r\n\treturn clean;\r\n}\r\n\r\nexport function sanitizeSplit(split) {\r\n\tconst template = {\r\n\t\tname: \"\",\r\n\t\texpanded: false,\r\n\t\tactions: []\r\n\t}\r\n\tif (!split) {\r\n\t\treturn { ...template };\r\n\t}\r\n\tconst clean = { ...template };\r\n\tif (split.name) {\r\n\t\tclean.name = split.name;\r\n\t}\r\n\tif (split.expanded) {\r\n\t\tclean.expanded = true;\r\n\t}\r\n\tif (split.actions) {\r\n\t\tclean.actions = split.actions.map(sanitizeAction)\r\n\t}\r\n\treturn clean;\r\n}\r\n\r\nexport function sanitizeAction(action) {\r\n\tconst template = {\r\n\t\tname: \"\",\r\n\t\texpanded: false,\r\n\t\tdeltaString: \"\",\r\n\t\tdeltaError: undefined,\r\n\t\tdeltas: {},\r\n\t}\r\n\tif (!action) {\r\n\t\treturn { ...template };\r\n\t}\r\n\tconst clean = { ...template };\r\n\tif (action.name) {\r\n\t\tclean.name = action.name;\r\n\t}\r\n\tif (action.deltaString) {\r\n\t\tclean.deltaString = action.deltaString;\r\n\t}\r\n\tif (action.expanded) {\r\n\t\tclean.expanded = true;\r\n\t}\r\n\tif (action.deltaError) {\r\n\t\tclean.deltaError = action.deltaError;\r\n\t}\r\n\tif (action.deltas) {\r\n\t\tclean.deltas = sanitizeDelta(action.deltas)\r\n\t}\r\n\treturn clean;\r\n}\r\n\r\nexport function sanitizeDelta(delta) {\r\n\tconst types = [\"add\", \"set\", \"ref_add\", \"ref_set\", \"ref_sub\"];\r\n\tconst copy = {};\r\n\tfor (const key in delta) {\r\n\t\tconst t = delta[key].type\r\n\t\tif (t && types.includes(t)) {\r\n\t\t\tif (t === \"add\" || t === \"set\") {\r\n\t\t\t\tif (Number.isInteger(delta[key].value)) {\r\n\t\t\t\t\tcopy[key] = {\r\n\t\t\t\t\t\ttype: t,\r\n\t\t\t\t\t\tvalue: delta[key].value,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcopy[key] = {\r\n\t\t\t\t\ttype: t,\r\n\t\t\t\t\tvalue: delta[key].value.toString(),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn copy;\r\n}\r\n\r\nexport function sanitizeItem(item) {\r\n\tconst template = {\r\n\t\tname: \"\",\r\n\t\tcolor: \"\",\r\n\t}\r\n\tif (!item) return { ...template };\r\n\tconst copy = { ...template };\r\n\tif (item.name) {\r\n\t\tcopy.name = item.name;\r\n\t}\r\n\tif (item.color) {\r\n\t\tcopy.color = item.color;\r\n\t}\r\n\treturn copy;\r\n}\r\n\r\nfunction minimize(state) {\r\n\tstate = sanitizeState(state);\r\n\treturn {\r\n\t\t...state,\r\n\t\tbranches: state.branches.map(branch => (\r\n\t\t\t{\r\n\t\t\t\t...branch,\r\n\t\t\t\tsplits: branch.splits.map(split => (\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...split,\r\n\t\t\t\t\t\tactions: split.actions.map(action => (\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t...action,\r\n\t\t\t\t\t\t\t\tdeltas: {}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t))\r\n\t\t\t\t\t}\r\n\t\t\t\t))\r\n\t\t\t}\r\n\t\t))\r\n\t}\r\n}\r\n","import { truncate } from 'fs';\r\nimport stringToDelta, { deltaToString, renameItemInDelta } from './actiondelta';\r\nimport { sanitizeBranch, sanitizeAction, sanitizeSplit, sanitizeItem } from './storage';\r\n\r\nexport function createBranchAt(index) {\r\n\treturn function ({ branches, activeBranch }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst newBranch = sanitizeBranch();\r\n\t\tif (index >= branchesCopy.length) {\r\n\t\t\tbranchesCopy.push(newBranch);\r\n\t\t} else {\r\n\t\t\tbranchesCopy.splice(index, 0, newBranch);\r\n\t\t}\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tif (activeBranch >= index) {\r\n\t\t\tnewActiveBranch++;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function deleteBranchAt(index) {\r\n\treturn function ({ branches, activeBranch }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy.splice(index, 1)\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tif (activeBranch === index) {\r\n\t\t\tnewActiveBranch = -1;\r\n\t\t} else if (activeBranch > index) {\r\n\t\t\tnewActiveBranch--;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function swapBranches(i, j) {\r\n\treturn function ({ branches, activeBranch }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst temp = branchesCopy[i];\r\n\t\tbranchesCopy[i] = branchesCopy[j];\r\n\t\tbranchesCopy[j] = temp;\r\n\r\n\t\tlet newActiveBranch;\r\n\t\tif (activeBranch === i) {\r\n\t\t\tnewActiveBranch = j;\r\n\t\t} else if (activeBranch === j) {\r\n\t\t\tnewActiveBranch = i;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function setBranchPropertyAt(index, property, value) {\r\n\treturn function ({ branches }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[index][property] = value;\r\n\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function createSplitAt(bIndex, index, splitTemplate) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst newSplit = sanitizeSplit(splitTemplate);\r\n\t\tif (index >= branchesCopy[bIndex].splits.length) {\r\n\t\t\tbranchesCopy[bIndex].splits.push(newSplit);\r\n\t\t} else {\r\n\t\t\tbranchesCopy[bIndex].splits.splice(index, 0, newSplit);\r\n\t\t}\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === bIndex && activeSplit >= index) {\r\n\t\t\tnewActiveSplit++;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function deleteSplitAt(bIndex, index) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[bIndex].splits.splice(index, 1);\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === bIndex) {\r\n\t\t\tif (activeSplit === index) {\r\n\t\t\t\tnewActiveSplit = -1;\r\n\t\t\t} else if (activeSplit > index) {\r\n\t\t\t\tnewActiveSplit--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function swapSplits(bIndex, si, sj) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst temp = branchesCopy[bIndex].splits[si];\r\n\t\tbranchesCopy[bIndex].splits[si] = branchesCopy[bIndex].splits[sj];\r\n\t\tbranchesCopy[bIndex].splits[sj] = temp;\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === bIndex) {\r\n\t\t\tif (activeSplit === si) {\r\n\t\t\t\tnewActiveSplit = sj;\r\n\t\t\t} else if (activeSplit === sj) {\r\n\t\t\t\tnewActiveSplit = si;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function setSplitPropertyAt(bIndex, sIndex, property, value) {\r\n\treturn function ({ branches }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[bIndex].splits[sIndex][property] = value;\r\n\t\treturn { branches: branchesCopy }\r\n\t}\r\n\r\n}\r\n\r\nexport function moveFirstSplitOfBranchToPreviousBranch(index) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[index - 1].splits.push(branchesCopy[index].splits[0]);\r\n\t\tbranchesCopy[index].splits.splice(0, 1);\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === index && activeSplit === 0) {\r\n\t\t\tnewActiveBranch--;\r\n\t\t\tnewActiveSplit = branchesCopy[index - 1].splits.length - 1;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function moveLastSplitOfBranchToNextBranch(index) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst lastIndex = branchesCopy[index].splits.length - 1;\r\n\t\tbranchesCopy[index + 1].splits.splice(0, 0, branchesCopy[index].splits[lastIndex]);\r\n\t\tbranchesCopy[index].splits.splice(lastIndex, 1);\r\n\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === index && activeSplit === lastIndex) {\r\n\t\t\tnewActiveBranch++;\r\n\t\t\tnewActiveSplit = 0;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function mergeNextBranchWithCurrentBranch(index) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst oldSplitSize = branchesCopy[index].splits.length;\r\n\t\tbranchesCopy[index].splits = branchesCopy[index].splits.concat(branchesCopy[index + 1].splits);\r\n\t\tbranchesCopy.splice(index + 1, 1);\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === index + 1) {\r\n\t\t\tnewActiveBranch--;\r\n\t\t\tnewActiveSplit += oldSplitSize;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function breakBranchAt(bIndex, sIndex) {\r\n\treturn function ({ branches, activeBranch, activeSplit }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst lowSplits = branchesCopy[bIndex].splits.slice(sIndex);\r\n\t\tbranchesCopy[bIndex].splits = branchesCopy[bIndex].splits.slice(0, sIndex);\r\n\t\tconst newBranch = sanitizeBranch();\r\n\t\tnewBranch.expanded = true;\r\n\t\tnewBranch.splits = lowSplits;\r\n\t\tbranchesCopy.splice(bIndex + 1, 0, newBranch);\r\n\r\n\t\tlet newActiveBranch = activeBranch;\r\n\t\tlet newActiveSplit = activeSplit;\r\n\t\tif (activeBranch === bIndex && activeSplit >= sIndex) {\r\n\t\t\tnewActiveBranch++;\r\n\t\t\tnewActiveSplit -= sIndex;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveBranch: newActiveBranch,\r\n\t\t\tactiveSplit: newActiveSplit,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function collapseAll() {\r\n\treturn function ({ branches }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy.forEach(branch => {\r\n\t\t\tbranch.expanded = false;\r\n\t\t\tbranch.splits.forEach(split => {\r\n\t\t\t\tsplit.expanded = false;\r\n\t\t\t\tsplit.actions.forEach(action => {\r\n\t\t\t\t\taction.expanded = false;\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveAction: -1,\r\n\t\t\tactiveBranch: -1,\r\n\t\t\tactiveSplit: -1,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport function createActionAt(bIndex, sIndex, index) {\r\n\treturn function ({ branches, activeBranch, activeSplit, activeAction }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst newAction = sanitizeAction();\r\n\t\tif (index >= branchesCopy[bIndex].splits[sIndex].actions.length) {\r\n\t\t\tbranchesCopy[bIndex].splits[sIndex].actions.push(newAction);\r\n\t\t} else {\r\n\t\t\tbranchesCopy[bIndex].splits[sIndex].actions.splice(index, 0, newAction);\r\n\t\t}\r\n\t\tlet newActiveAction = activeAction;\r\n\t\tif (activeBranch === bIndex && activeSplit === sIndex) {\r\n\t\t\tif (activeAction > index) {\r\n\t\t\t\tnewActiveAction++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveAction: newActiveAction,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport function deleteActionAt(bIndex, sIndex, index) {\r\n\treturn function ({ branches, activeBranch, activeSplit, activeAction }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[bIndex].splits[sIndex].actions.splice(index, 1);\r\n\t\tlet newActiveAction = activeAction;\r\n\t\tif (activeBranch === bIndex && activeSplit === sIndex) {\r\n\t\t\tif (activeAction === index) {\r\n\t\t\t\tnewActiveAction = -1;\r\n\t\t\t} else if (activeAction > index) {\r\n\t\t\t\tnewActiveAction--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveAction: newActiveAction,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function swapActions(bIndex, sIndex, ai, aj) {\r\n\treturn function ({ branches, activeBranch, activeSplit, activeAction }) {\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst temp = branchesCopy[bIndex].splits[sIndex].actions[ai];\r\n\t\tbranchesCopy[bIndex].splits[sIndex].actions[ai] = branchesCopy[bIndex].splits[sIndex].actions[aj];\r\n\t\tbranchesCopy[bIndex].splits[sIndex].actions[aj] = temp;\r\n\t\tlet newActiveAction = activeAction;\r\n\t\tif (activeBranch === bIndex && activeSplit === sIndex) {\r\n\t\t\tif (activeAction === ai) {\r\n\t\t\t\tnewActiveAction = aj;\r\n\t\t\t} else if (activeAction === aj) {\r\n\t\t\t\tnewActiveAction = ai;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy,\r\n\t\t\tactiveAction: newActiveAction,\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function setActionPropertyAt(bIndex, sIndex, index, property, value) {\r\n\treturn function ({ branches }) {\r\n\t\tif (property === \"deltas\") return {};\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tbranchesCopy[bIndex].splits[sIndex].actions[index][property] = value;\r\n\t\tif (property === \"deltaString\") {\r\n\t\t\tapplyActionDeltaStringEdit(branchesCopy[bIndex].splits[sIndex].actions[index]);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tbranches: branchesCopy\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction applyActionDeltaStringEdit(action) {\r\n\tconst [newDelta, error] = stringToDelta(action.deltaString);\r\n\tif (newDelta) {\r\n\t\taction.deltas = newDelta;\r\n\t\taction.deltaError = undefined;\r\n\t} else {\r\n\t\taction.deltas = {};\r\n\t\taction.deltaError = error;\r\n\t}\r\n}\r\n\r\nexport function tryClearResourceErrorFrom(resources, branch, split) {\r\n\tif (!resources.error) return {};\r\n\tif (resources.error.branch < branch) return {};\r\n\tif (resources.error.branch === branch) {\r\n\t\tif (resources.error.split < split) return {};\r\n\t}\r\n\tconst resourcesCopy = deepCopyResources(resources);\r\n\tresourcesCopy.error = undefined;\r\n\treturn {\r\n\t\tresources: resourcesCopy\r\n\t}\r\n}\r\n\r\nexport function getPreviousActionIndices(branches, b, s, a) {\r\n\tif (a <= 0 && s <= 0 && b <= 0) {\r\n\t\treturn [-1, -1, -1, false];\r\n\t}\r\n\tlet prevA;\r\n\tlet prevS;\r\n\tlet prevB;\r\n\tif (a <= 0) {\r\n\t\tif (s <= 0) {\r\n\t\t\tprevB = b - 1;\r\n\t\t\tprevS = branches[prevB].splits.length - 1;\r\n\t\t\tprevA = branches[prevB].splits[prevS].actions.length - 1;\r\n\t\t} else {\r\n\t\t\tprevB = b;\r\n\t\t\tprevS = s - 1;\r\n\t\t\tprevA = branches[prevB].splits[prevS].actions.length - 1;\r\n\t\t}\r\n\t} else {\r\n\t\tprevB = b;\r\n\t\tprevS = s;\r\n\t\tprevA = a - 1;\r\n\t}\r\n\treturn [prevB, prevS, prevA, true];\r\n}\r\n\r\nexport function calculateResourcesAt(resources, branches, items, b, s, a) {\r\n\tif (resources.error) return {};\r\n\tconst resourcesCopy = deepCopyResources(resources);\r\n\tconst action = branches[b].splits[s].actions[a];\r\n\tif (action.deltaError) {\r\n\t\tresourcesCopy.error = {\r\n\t\t\tbranch: b,\r\n\t\t\tsplit: s,\r\n\t\t\taction: a,\r\n\t\t\tmessage: action.deltaError,\r\n\t\t};\r\n\t\treturn { resources: resourcesCopy };\r\n\t}\r\n\r\n\tlet newContent;\r\n\tlet errorMessage;\r\n\tconst [prevB, prevS, prevA, hasPrev] = getPreviousActionIndices(branches, b, s, a);\r\n\tif (!hasPrev) {\r\n\t\t[newContent, errorMessage] = applyDelta({}, items, action.deltas);\r\n\t} else {\r\n\t\t[newContent, errorMessage] = applyDelta(resources.content[prevB][prevS][prevA], items, action.deltas);\r\n\t}\r\n\r\n\tif (errorMessage) {\r\n\t\tresourcesCopy.error = {\r\n\t\t\tbranch: b,\r\n\t\t\tsplit: s,\r\n\t\t\taction: a,\r\n\t\t\tmessage: errorMessage,\r\n\t\t};\r\n\t} else {\r\n\t\tif (!resourcesCopy.content) {\r\n\t\t\tresourcesCopy.content = [];\r\n\t\t}\r\n\t\tif (!resourcesCopy.content[b]) {\r\n\t\t\tresourcesCopy.content[b] = [];\r\n\t\t}\r\n\t\tif (!resourcesCopy.content[b][s]) {\r\n\t\t\tresourcesCopy.content[b][s] = [];\r\n\t\t}\r\n\t\tresourcesCopy.content[b][s][a] = newContent;\r\n\t}\r\n\r\n\treturn { resources: resourcesCopy };\r\n}\r\n\r\nexport function createItem(index) {\r\n\treturn function ({ items }) {\r\n\t\tconst itemsCopy = deepCopyItems(items);\r\n\t\tconst newItem = sanitizeItem();\r\n\t\tif (index >= itemsCopy.length) {\r\n\t\t\titemsCopy.push(newItem);\r\n\t\t} else {\r\n\t\t\titemsCopy.splice(index, 0, newItem);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\titems: itemsCopy,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function deleteItem(itemIndex) {\r\n\treturn function ({ items }) {\r\n\t\tconst itemsCopy = deepCopyItems(items);\r\n\t\titemsCopy.splice(itemIndex, 1);\r\n\t\treturn {\r\n\t\t\titems: itemsCopy,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function setItemPropertyAt(itemIndex, property, value) {\r\n\treturn function ({ branches, items }) {\r\n\t\tconst itemsCopy = deepCopyItems(items);\r\n\t\tconst oldValue = itemsCopy[itemIndex][property];\r\n\t\titemsCopy[itemIndex][property] = value;\r\n\t\tif (property === \"name\") {\r\n\t\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\t\trenameItemInDeltaString(branchesCopy, value, oldValue);\r\n\t\t\treturn {\r\n\t\t\t\titems: itemsCopy,\r\n\t\t\t\tbranches: branchesCopy,\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\titems: itemsCopy,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nexport function removeUnusedItems() {\r\n\treturn function ({ branches, items }) {\r\n\t\tconst itemsCopy = deepCopyItems(items);\r\n\t\tconst branchesCopy = deepCopyBranches(branches);\r\n\t\tconst usedItems = getUsedItemsInDeltaString(branchesCopy);\r\n\t\tremoveUnusedItemsInDeltaString(branchesCopy, usedItems);\r\n\t\treturn {\r\n\t\t\titems: itemsCopy,\r\n\t\t\tbranches: branchesCopy,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction deepCopyBranches(branches) {\r\n\treturn branches.map(sanitizeBranch);\r\n}\r\n\r\nfunction deepCopyResources(resources) {\r\n\tconst content = deepCopyResourceContent(resources.content);\r\n\tconst error = resources.error ? { ...resources.error } : undefined;\r\n\treturn { content, error };\r\n}\r\n\r\nfunction deepCopyResourceContent(content) {\r\n\treturn content.map(branchContent => branchContent.map(splitContent => splitContent.map(actionContent => ({ ...actionContent }))));\r\n}\r\n\r\nfunction deepCopyItems(items) {\r\n\treturn items.map(sanitizeItem);\r\n}\r\n\r\nfunction applyDelta(resource, items, delta) {\r\n\tconst copy = { ...resource };\r\n\tfor (const name in delta) {\r\n\t\tif (!(name in items)) return [null, `Item \"${name}\" is undefined. Add \"*\" at the beginning of the item to define it`];\r\n\t\tif (!(name in resource)) {\r\n\t\t\tresource[name] = 0;\r\n\t\t}\r\n\t\tif (delta[name].type.startsWith(\"ref\")) {\r\n\t\t\tif (!(delta[name].value in items)) return [null, `Item \"${name}\" refers to undefined item \"${delta[name].value}\"`];\r\n\t\t\tif (!(delta[name].value in resource)) {\r\n\t\t\t\tresource[delta[name].value] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tswitch (delta[name].type) {\r\n\t\t\tcase \"add\":\r\n\t\t\t\tcopy[name] = resource[name] + delta[name].value;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"set\":\r\n\t\t\t\tcopy[name] = delta[name].value;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ref_add\":\r\n\t\t\t\tcopy[name] = resource[name] + resource[delta[name].value];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ref_sub\":\r\n\t\t\t\tcopy[name] = resource[name] - resource[delta[name].value];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ref_set\":\r\n\t\t\t\tcopy[name] = resource[delta[name].value];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: return [null, `Invalid delta type in item \"${name}\"`];\r\n\t\t}\r\n\t}\r\n\treturn [copy, null];\r\n}\r\n\r\nfunction renameItemInDeltaString(branchesCopy, oldName, newName) {\r\n\tbranchesCopy.forEach(branch => branch.splits.forEach(split => split.actions.forEach(action => {\r\n\t\tconst [deltas, error] = stringToDelta(action.deltaString);\r\n\t\tif (!error) {\r\n\t\t\trenameItemInDelta(deltas, oldName, newName);\r\n\t\t\taction.deltaString = deltaToString(deltas);\r\n\t\t}\r\n\r\n\t})));\r\n}\r\n\r\nfunction getUsedItemsInDeltaString(branchesCopy) {\r\n\tconst items = {};\r\n\tbranchesCopy.forEach(branch => branch.splits.forEach(split => split.actions.forEach(action => {\r\n\t\tconst [deltas, error] = stringToDelta(action.deltaString);\r\n\t\tif (!error) {\r\n\t\t\tfor (const name in deltas) {\r\n\t\t\t\titems[name] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t})));\r\n\treturn items;\r\n}\r\n\r\nfunction removeUnusedItemsInDeltaString(branchesCopy, usedItems) {\r\n\tbranchesCopy.forEach(branch => branch.splits.forEach(split => split.actions.forEach(action => {\r\n\t\tconst [deltas, error] = stringToDelta(action.deltaString);\r\n\t\tif (!error) {\r\n\t\t\tfor (const name in deltas) {\r\n\t\t\t\tif (!(name in usedItems)) {\r\n\t\t\t\t\tdelete deltas.name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\taction.deltaString = deltaToString(deltas);\r\n\t\t}\r\n\r\n\t})));\r\n}\r\n","import ActionSummary from \"./ActionSummary\";\r\nimport ExpandButton from \"./ExpandButton\";\r\nimport { breakBranchAt, createSplitAt, deleteSplitAt, moveFirstSplitOfBranchToPreviousBranch, moveLastSplitOfBranchToNextBranch, setSplitPropertyAt, swapSplits } from \"./util/data\";\r\nexport default function Split({ name, branchIndex, index, expanded, isLast, isLastBranch, isFirstBranch, editing, splitActions, actions, setEditing }) {\r\n\tconst displayName = name || \"[Unnamed Split]\";\r\n\tconst splitNode = (\r\n\t\t<tr key={`b_${branchIndex}_s_${index}_split`}>\r\n\t\t\t<td className=\"icon-button-width\">{editing && <button className=\"icon-button\" title=\"Break branch\" onClick={() => {\r\n\t\t\t\tactions.doToBranches(breakBranchAt(branchIndex, index), \"Branch broken - bang!\");\r\n\t\t\t}}>{\"/\"}</button>}</td>\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<ExpandButton expanded={expanded} setExpanded={(expanded) => {\r\n\t\t\t\t\tactions.doToBranches(setSplitPropertyAt(branchIndex, index, \"expanded\", expanded), `Split ${expanded ? \"expanded\" : \"collapsed\"}.`);\r\n\t\t\t\t}} />\r\n\t\t\t</td>\r\n\t\t\t<td colSpan=\"2\">\r\n\t\t\t\t{editing ?\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclassName=\"full-width\"\r\n\t\t\t\t\t\tplaceholder=\"Split Name\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={name}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\tactions.doToBranches(setSplitPropertyAt(branchIndex, index, \"name\", e.target.value));\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t\t: <u className=\"split-link\" onClick={() => {\r\n\t\t\t\t\t\tactions.openSplit(branchIndex, index);\r\n\t\t\t\t\t}}>{displayName}</u>}\r\n\t\t\t</td>\r\n\t\t\t{editing && <td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" title=\"Copy\" onClick={() => {\r\n\t\t\t\t\tactions.copySplit({\r\n\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t\texpanded: expanded,\r\n\t\t\t\t\t\tactions: splitActions,\r\n\t\t\t\t\t});\r\n\t\t\t\t}}>c</button>\r\n\t\t\t</td>}\r\n\r\n\t\t\t{editing && <td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" disabled={index === 0 && isFirstBranch} title=\"Move up\" onClick={() => {\r\n\t\t\t\t\tif (index === 0) {\r\n\t\t\t\t\t\tactions.doToBranches(moveFirstSplitOfBranchToPreviousBranch(branchIndex), \"Split moved to the previous branch.\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactions.doToBranches(swapSplits(branchIndex, index, index - 1), \"Split moved.\", branchIndex, index - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}}>&uarr;</button>\r\n\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast && isLastBranch} onClick={() => {\r\n\t\t\t\t\t\tif (isLast) {\r\n\t\t\t\t\t\t\tactions.doToBranches(moveLastSplitOfBranchToNextBranch(branchIndex), \"Split moved to the next branch.\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tactions.doToBranches(swapSplits(branchIndex, index, index + 1), \"Split moved.\", branchIndex, index);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}>&darr;</button>\r\n\t\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\r\n\t\t\t\t\t\tactions.displayAlert(`Delete split \"${name}\"? This will also delete all actions in the split. (Not reversible)`, \"Delete\", () => {\r\n\t\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t\t\tactions.doToBranches(deleteSplitAt(branchIndex, index), \"Split deleted.\", branchIndex, index);\r\n\t\t\t\t\t\t}, \"Cancel\", () => {\r\n\t\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}}>X</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Split Below\" onClick={() => {\r\n\t\t\t\t\t\tactions.doToBranches(createSplitAt(branchIndex, index + 1), \"Split created.\", branchIndex, index + 1);\r\n\t\t\t\t\t\tsetEditing(true);\r\n\t\t\t\t\t}}>*</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Paste Split Below\" disabled={actions.splitClipboard === undefined} onClick={() => {\r\n\t\t\t\t\t\tactions.doToBranches(createSplitAt(branchIndex, index + 1, actions.splitClipboard), \"Split pasted.\", branchIndex, index + 1)\r\n\t\t\t\t\t}}>p</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t</tr>\r\n\t);\r\n\tif (!expanded) return splitNode;\r\n\treturn [splitNode].concat(<ActionSummary actions={splitActions} b={branchIndex} s={index} />);\r\n}","import Split from \"./Split\";\r\nimport { createSplitAt, mergeNextBranchWithCurrentBranch } from \"./util/data\";\r\n\r\nexport default function SplitList({ branchIndex, splits, isLastBranch, isFirstBranch, editing, actions, setEditing }) {\r\n\tconst splitNodes = splits.map((split, i) => (\r\n\t\t<Split\r\n\t\t\tkey={`branch_${branchIndex}_split_${i}_`}\r\n\t\t\tname={split.name}\r\n\t\t\tbranchIndex={branchIndex}\r\n\t\t\tindex={i}\r\n\t\t\texpanded={split.expanded}\r\n\t\t\tisLast={i === splits.length - 1}\r\n\t\t\tisLastBranch={isLastBranch}\r\n\t\t\tisFirstBranch={isFirstBranch}\r\n\t\t\tediting={editing}\r\n\t\t\tactions={actions}\r\n\t\t\tsplitActions={split.actions}\r\n\t\t\tsetEditing={setEditing}\r\n\t\t/>\r\n\t));\r\n\tsplitNodes.push(<tr key={`branch_${branchIndex}_split_actions`}>\r\n\t\t<td className=\"icon-button-width\">{editing && <button className=\"icon-button\" title=\"Merge branch\" disabled={isLastBranch} onClick={() => {\r\n\t\t\tactions.doToBranches(mergeNextBranchWithCurrentBranch(branchIndex), \"Branch merged - moosh!\");\r\n\t\t}}>^</button>}</td>\r\n\t\t<td colSpan=\"4\">\r\n\t\t\t<button onClick={() => {\r\n\t\t\t\tconst len = splits.length;\r\n\t\t\t\tactions.doToBranches(createSplitAt(branchIndex, len), \"Split created.\", branchIndex, len)\r\n\t\t\t\tsetEditing(true);\r\n\t\t\t}}>New Split</button>\r\n\t\t\t<button className=\"space-left-small\" disabled={actions.splitClipboard === undefined} onClick={() => {\r\n\t\t\t\tconst len = splits.length;\r\n\t\t\t\tactions.doToBranches(createSplitAt(branchIndex, len, actions.splitClipboard), \"Split pasted.\", branchIndex, len)\r\n\t\t\t}}>Paste Split</button>\r\n\t\t</td>\r\n\t</tr>);\r\n\treturn splitNodes;\r\n}","import ExpandButton from \"./ExpandButton\";\r\nimport SplitList from \"./SplitList\";\r\n\r\nimport { deleteBranchAt, setBranchPropertyAt, swapBranches, createBranchAt } from './util/data';\r\n\r\nexport default function Branch({ name, index, expanded, editing, actions, isLast, splits, setEditing }) {\r\n\tconst displayName = name || \"[Unnamed Branch]\";\r\n\tconst branchNode = (\r\n\t\t<tr key={\"branch_content_\" + index}>\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<ExpandButton expanded={expanded} setExpanded={(expanded) => {\r\n\t\t\t\t\tactions.doToBranches(setBranchPropertyAt(index, \"expanded\", expanded), `Branch ${expanded ? \"expanded\" : \"collapsed\"}.`)\r\n\t\t\t\t}} />\r\n\t\t\t</td>\r\n\t\t\t<td colSpan=\"6\">\r\n\t\t\t\t{editing ?\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclassName=\"full-width\"\r\n\t\t\t\t\t\tplaceholder=\"Branch Name\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={name}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\tactions.doToBranches(setBranchPropertyAt(index, \"name\", e.target.value))\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t\t: <strong>{displayName}</strong>}\r\n\r\n\t\t\t</td>\r\n\t\t\t{editing && <td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" disabled={index === 0} title=\"Move up\" onClick={() => {\r\n\t\t\t\t\tactions.doToBranches(swapBranches(index, index - 1), \"Branch moved.\", index - 1);\r\n\t\t\t\t}}>&uarr;</button>\r\n\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast} onClick={() => {\r\n\t\t\t\t\t\tactions.doToBranches(swapBranches(index, index + 1), \"Branch moved.\", index);\r\n\t\t\t\t\t}}>&darr;</button>\r\n\t\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\r\n\t\t\t\t\t\tactions.displayAlert(`Delete branch \"${name}\"? This will also delete all the splits in the branch. (Not reversible)`, \"Delete\", () => {\r\n\t\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t\t\tactions.doToBranches(deleteBranchAt(index), \"Branch deleted.\", index);\r\n\t\t\t\t\t\t}, \"Cancel\", () => {\r\n\t\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}}>X</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Branch Below\" onClick={() => {\r\n\t\t\t\t\t\tactions.doToBranches(createBranchAt(index + 1), \"Branch created.\", index + 1);\r\n\t\t\t\t\t\tsetEditing(true);\r\n\t\t\t\t\t}}>*</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t</tr>\r\n\t);\r\n\tif (!expanded) {\r\n\t\treturn branchNode;\r\n\t}\r\n\treturn [branchNode].concat(<SplitList\r\n\t\tkey={`branch_split_list_${index}`}\r\n\t\tbranchIndex={index}\r\n\t\tsplits={splits}\r\n\t\tisLastBranch={isLast}\r\n\t\tisFirstBranch={index === 0}\r\n\t\tediting={editing}\r\n\t\tactions={actions}\r\n\t\tsetEditing={setEditing}\r\n\t/>)\r\n}","import Branch from \"./Branch\";\r\n\r\nimport { createBranchAt } from './util/data';\r\n\r\nexport default function BranchList({ branches, editing, setEditing, actions }) {\r\n\tif (!branches) return null;\r\n\treturn (\r\n\t\t<table>\r\n\t\t\t<tbody>\r\n\t\t\t\t{branches.map((branch, i) => (\r\n\t\t\t\t\t<Branch\r\n\t\t\t\t\t\tname={branch.name}\r\n\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\tindex={i}\r\n\t\t\t\t\t\texpanded={branch.expanded}\r\n\t\t\t\t\t\tediting={editing}\r\n\t\t\t\t\t\tactions={actions}\r\n\t\t\t\t\t\tisLast={i === branches.length - 1}\r\n\t\t\t\t\t\tsplits={branch.splits}\r\n\t\t\t\t\t\tsetEditing={setEditing}\r\n\t\t\t\t\t/>\r\n\t\t\t\t))}\r\n\t\t\t\t<tr key=\"new_branch_button\">\r\n\t\t\t\t\t<td colSpan=\"5\">\r\n\t\t\t\t\t\t<button onClick={() => {\r\n\t\t\t\t\t\t\tconst len = branches.length;\r\n\t\t\t\t\t\t\tactions.doToBranches(createBranchAt(len), \"Branch created.\", len);\r\n\t\t\t\t\t\t\tsetEditing(true);\r\n\t\t\t\t\t\t}}>New Branch</button>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\r\n\t\t\t</tbody>\r\n\r\n\t\t</table>\r\n\t)\r\n}","import React from \"react\";\r\nimport Box from \"./components/Box\";\r\nimport BranchList from \"./components/BranchList\";\r\nimport ExpandButton from \"./components/ExpandButton\";\r\nimport { collapseAll } from \"./components/util/data\";\r\n\r\nexport default class SideNav extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tediting: false,\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tsetEditEnabled(enabled) {\r\n\t\tthis.setState({ editing: enabled });\r\n\t}\r\n\trender() {\r\n\t\tlet buttonSection = (\r\n\t\t\t<span>\r\n\t\t\t\t<button className=\"space-left-small\" onClick={() => this.setEditEnabled(!this.state.editing)}>{this.state.editing ? \"Finish\" : \"Edit\"}</button>\r\n\t\t\t\t<button className=\"space-left-small\" onClick={() => this.props.actions.doToBranches(collapseAll(), \"Collapsed all.\")} >Collapse All</button>\r\n\t\t\t</span>\r\n\t\t);\r\n\t\tlet branchSection =\r\n\t\t\t<BranchList\r\n\t\t\t\tbranches={this.props.branches}\r\n\t\t\t\tediting={this.state.editing}\r\n\t\t\t\tactions={this.props.actions}\r\n\t\t\t\tsetEditing={this.setEditEnabled.bind(this)} />;\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t<Box layout={this.props.layout.main} borderClass=\"overflow-auto\">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{!this.props.sideCollapsed && branchSection}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Box>\r\n\t\t\t\t<Box layout={this.props.layout.header} >\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<ExpandButton expanded={!this.props.sideCollapsed} setExpanded={(expanded) => {\r\n\t\t\t\t\t\t\tthis.props.actions.setSideCollapsed(!expanded);\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t\t\t{!this.props.sideCollapsed && buttonSection}\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<hr />\r\n\t\t\t\t</Box>\r\n\r\n\r\n\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","export function benchmarkTime() {\r\n\treturn new Date().getTime();\r\n}\r\n\r\nexport function benchmarkDelta(start) {\r\n\treturn new Date().getTime() - start;\r\n}","import { useState } from 'react';\r\nimport ExpandButton from './components/ExpandButton';\r\nimport { benchmarkTime } from './components/util/benchmark';\r\nimport { readFromFile } from './components/util/storage';\r\nexport default function Header({ autoSave, projectName, headerCollapsed, sideCollapsed, actions }) {\r\n\tconst [file, setFile] = useState(undefined);\r\n\tconst exportButton = (\r\n\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.download()}>Export</button>\r\n\t);\r\n\tconst saveButton = (\r\n\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.saveStateToLocalStorage()}>Save</button>\r\n\t);\r\n\tconst buttonSection = (\r\n\t\t<span>\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => {\r\n\t\t\t\tactions.setProjectName(prompt(\"Enter Project Name\", projectName));\r\n\t\t\t}}>Edit Project Name</button>\r\n\t\t\t<input className=\"vertical-center space-left-small\" type=\"file\" onChange={(e) => {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tsetFile(e.target.files);\r\n\t\t\t}} />\r\n\t\t\t<button className=\"vertical-center space-left-small\" disabled={!file} onClick={() => {\r\n\t\t\t\tif (file && file[0]) {\r\n\t\t\t\t\tconst startTime = benchmarkTime();\r\n\t\t\t\t\treadFromFile(file[0], (storedState) => {\r\n\t\t\t\t\t\tactions.loadStoredState(() => storedState, startTime);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t}}>Import</button>\r\n\t\t\t{exportButton}\r\n\t\t\t{saveButton}\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.setAutoSave(!autoSave)}>{autoSave ? \"Auto Save: Enabled\" : \"Auto Save: Disabled\"}</button>\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.setAutoSave(!autoSave)} disabled>{autoSave ? \"Map: Enabled\" : \"Map: Disabled\"}</button>\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.saveStateToLocalStorage()} disabled>Force Update Resources</button>\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.saveStateToLocalStorage()} disabled>Help</button>\r\n\t\t\t<button className=\"vertical-center space-left-small\" onClick={() => actions.saveStateToLocalStorage()} disabled>Reset</button>\r\n\t\t</span>\r\n\t)\r\n\tconst allButtons = (\r\n\t\t<span>\r\n\t\t\t{!headerCollapsed && buttonSection}\r\n\t\t\t{headerCollapsed && exportButton}\r\n\t\t\t{headerCollapsed && saveButton}\r\n\t\t</span>\r\n\t)\r\n\treturn (\r\n\t\t<div className=\"overflow-hidden\">\r\n\t\t\t{!(sideCollapsed && headerCollapsed) && <h3 className=\"overflow-hidden\">{projectName}</h3>}\r\n\t\t\t<ExpandButton expanded={!headerCollapsed} setExpanded={(expanded) => actions.setHeaderCollapsed(!expanded)} />\r\n\t\t\t{!(sideCollapsed && headerCollapsed) && allButtons}\r\n\r\n\t\t</div>\r\n\r\n\t)\r\n}","export function calc(...array) {\r\n\treturn `calc(${array.join(\" \")})`;\r\n}\r\n\r\nexport function min(a, b) {\r\n\treturn `min(${a}, ${b})`;\r\n}\r\n\r\nexport function max(a, b) {\r\n\treturn `max(${a}, ${b})`;\r\n}\r\n\r\n\r\nexport default function layout(sideCollapsed, resourceCollapsed, headerCollapsed) {\r\n\t//const resourceCollapsed = false;\r\n\t// const sideCollapsed = true;\r\n\r\n\tconst windowWidth = \"100vw\";\r\n\tconst windowHeight = \"100vh\";\r\n\tconst HEADER_HEIGHT = \"3.5rem\";\r\n\tconst FOOTER_HEIGHT = \"2rem\";\r\n\r\n\tconst SIDE_MIN_WIDTH = \"16rem\";\r\n\tconst SIDE_WIDTH = \"30%\";\r\n\tconst SIDE_MAX_WIDTH = \"24rem\";\r\n\r\n\tconst SIDE_COLLAPSE_WIDTH = \"2rem\";\r\n\r\n\tconst SIDE_HEADER_HEIGHT = \"2rem\";\r\n\r\n\tconst RESOURCE_MIN_HEIGHT = \"12rem\";\r\n\tconst RESOURCE_HEIGHT = \"20%\";\r\n\tconst RESOURCE_WIDTH_SHRINK = \"24rem\";\r\n\tconst RESOURCE_COLLAPSE_HEIGHT = \"1.8rem\";\r\n\tconst RESOURCE_HEADER_HEIGHT = \"3.2rem\";\r\n\r\n\tconst ACTION_MIN_WIDTH = \"50rem\";\r\n\r\n\tconst SHRINK_SIDE_WHEN_LESS_THAN = 1550;\r\n\tconst shrink = window.innerWidth < SHRINK_SIDE_WHEN_LESS_THAN\r\n\r\n\tconst HIDE_RESOURCES_WHEN_LESS_THAN = 700;\r\n\tconst noResources = window.innerWidth < HIDE_RESOURCES_WHEN_LESS_THAN\r\n\r\n\tconst NO_HEADER_WHEN_LESS_THAN = 1000;\r\n\tif (window.innerWidth < NO_HEADER_WHEN_LESS_THAN) {\r\n\t\theaderCollapsed = true;\r\n\t}\r\n\r\n\r\n\tconst centerHeight = calc(windowHeight, \"-\", HEADER_HEIGHT, \"-\", FOOTER_HEIGHT);\r\n\tconst sideWidth = sideCollapsed ? SIDE_COLLAPSE_WIDTH : max(SIDE_MIN_WIDTH, min(SIDE_MAX_WIDTH, SIDE_WIDTH));\r\n\tconst mainWidth = calc(windowWidth, \"-\", sideWidth);\r\n\tconst resourceHeight = resourceCollapsed ? RESOURCE_COLLAPSE_HEIGHT : max(RESOURCE_MIN_HEIGHT, RESOURCE_HEIGHT);\r\n\r\n\tconst mapHeight = calc(centerHeight, \"-\", resourceHeight);\r\n\tconst actionWidth = shrink ? calc(windowWidth, \"-\", RESOURCE_WIDTH_SHRINK) : min(mainWidth, max(ACTION_MIN_WIDTH, calc(\"60%\", \"-\", sideWidth)));\r\n\tconst actionY = calc(windowHeight, \"-\", FOOTER_HEIGHT, \"-\", resourceHeight);\r\n\r\n\treturn {\r\n\t\theader: {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\tw: headerCollapsed ? sideWidth : windowWidth,\r\n\t\t\th: HEADER_HEIGHT,\r\n\t\t},\r\n\t\tside: {\r\n\t\t\tx: 0,\r\n\t\t\ty: HEADER_HEIGHT,\r\n\t\t\tw: sideWidth,\r\n\t\t\th: shrink ? mapHeight : centerHeight,\r\n\t\t\theader: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: SIDE_HEADER_HEIGHT,\r\n\t\t\t},\r\n\t\t\tmain: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: SIDE_HEADER_HEIGHT,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: calc(\"100%\", \"-\", SIDE_HEADER_HEIGHT),\r\n\t\t\t},\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\tx: 0,\r\n\t\t\ty: calc(windowHeight, \"-\", FOOTER_HEIGHT),\r\n\t\t\tw: windowWidth,\r\n\t\t\th: FOOTER_HEIGHT,\r\n\t\t},\r\n\t\tresources: {\r\n\t\t\tx: shrink ? actionWidth : calc(sideWidth, \"+\", actionWidth),\r\n\t\t\ty: actionY,\r\n\t\t\tw: shrink ? RESOURCE_WIDTH_SHRINK : calc(mainWidth, \"-\", actionWidth),\r\n\t\t\th: resourceHeight,\r\n\t\t\thide: noResources,\r\n\t\t\theader: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: RESOURCE_HEADER_HEIGHT,\r\n\t\t\t},\r\n\t\t\tmain: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: RESOURCE_HEADER_HEIGHT,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: calc(\"100%\", \"-\", RESOURCE_HEADER_HEIGHT),\r\n\t\t\t},\r\n\t\t},\r\n\t\tactions: {\r\n\t\t\tx: shrink ? 0 : sideWidth,\r\n\t\t\ty: actionY,\r\n\t\t\tw: noResources ? windowWidth : actionWidth,\r\n\t\t\th: resourceHeight,\r\n\t\t\theader: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: SIDE_HEADER_HEIGHT,\r\n\t\t\t},\r\n\t\t\tmain: {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: SIDE_HEADER_HEIGHT,\r\n\t\t\t\tw: \"100%\",\r\n\t\t\t\th: calc(\"100%\", \"-\", SIDE_HEADER_HEIGHT),\r\n\t\t\t},\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\tx: sideWidth,\r\n\t\t\ty: headerCollapsed ? 0 : HEADER_HEIGHT,\r\n\t\t\tw: mainWidth,\r\n\t\t\th: headerCollapsed ? calc(windowHeight, \"-\", FOOTER_HEIGHT, \"-\", resourceHeight) : mapHeight,\r\n\t\t},\r\n\t}\r\n\r\n}\r\n\r\n","export default function Footer({ text }) {\r\n\treturn (\r\n\t\t<span className=\"vertical-center\">{text}</span>\r\n\t)\r\n}","\r\n\r\nfunction parseColor(name) {\r\n\tif (!name) return [\"\", \"auto\"];\r\n\tconst i = name.indexOf(\"#\");\r\n\tif (i >= 0) {\r\n\t\tconst color = name.substring(i + 1);\r\n\t\treturn [name.substring(0, i), color];\r\n\t}\r\n\treturn [name, \"auto\"];\r\n}\r\n\r\nfunction DeltaItem({ name, type, value, create }) {\r\n\tconst [displayName, color] = parseColor(name);\r\n\tlet op;\r\n\tswitch (type) {\r\n\t\tcase \"add\":\r\n\t\t\tif (value >= 0) {\r\n\t\t\t\top = \"+\";\r\n\t\t\t} else {\r\n\t\t\t\top = \"-\";\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"set\":\r\n\t\tcase \"ref_set\":\r\n\t\t\top = \"=\";\r\n\t\t\tbreak;\r\n\t\tcase \"ref_add\":\r\n\t\t\top = \"=\";\r\n\t\t\tbreak;\r\n\t\tcase \"ref_sub\":\r\n\t\t\top = \"-\";\r\n\t\t\tbreak;\r\n\t\tdefault: op = \"?\"; break;\r\n\t}\r\n\tif (type.startsWith(\"ref\")) {\r\n\t\tvalue = `[${value}]`\r\n\t}\r\n\treturn (\r\n\t\t<span style={{ backgroundColor: color }}>[{displayName}]{op}{value}</span>\r\n\t);\r\n}\r\n\r\nexport default function DeltaList({ deltas, deltaError }) {\r\n\tconst deltaItems = [];\r\n\tfor (const name in deltas) {\r\n\t\tdeltaItems.push(\r\n\t\t\t<DeltaItem name={name} key={name} {...deltas[name]} />\r\n\t\t);\r\n\t}\r\n\treturn (\r\n\t\t<tr key=\"delta\">\r\n\t\t\t<td className=\"icon-button-width align-right\">\r\n\t\t\t\t&#916;\r\n\t\t\t</td>\r\n\t\t\t<td colSpan=\"6\">\r\n\t\t\t\t{deltaError !== undefined ?\r\n\t\t\t\t\t<span className=\"deltastr-error\">{deltaError}</span>\r\n\t\t\t\t\t:\r\n\t\t\t\t\tdeltaItems\r\n\t\t\t\t}\r\n\r\n\t\t\t</td>\r\n\r\n\t\t</tr>\r\n\t)\r\n}","import ExpandButton from \"./ExpandButton\";\r\nimport { setActionPropertyAt } from \"./util/data\";\r\nimport DeltaItem from \"./DeltaList\";\r\n\r\nexport default function ActionItem({ name, branchIndex, splitIndex, index, expanded, editing, actions, isLast, deltaString, deltaError, deltas }) {\r\n\tconst displayName = name || \"[Unnamed Action]\";\r\n\tconst actionNode = (\r\n\t\t<tr key={\"action_\" + index}>\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t{deltaString && <ExpandButton expanded={expanded} setExpanded={(expanded) => {\r\n\t\t\t\t\tactions.doToBranches(setActionPropertyAt(branchIndex, splitIndex, index, \"expanded\", expanded), `Action ${expanded ? \"expanded\" : \"collapsed\"}.`)\r\n\t\t\t\t}} />\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t</td>\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"action-name-width\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclassName=\"action-name-width\"\r\n\t\t\t\t\t\tplaceholder=\"Action Title/Notes\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={name}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\tactions.doToBranches(setActionPropertyAt(branchIndex, splitIndex, index, \"name\", e.target.value));\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t</td>\r\n\r\n\t\t\t}\r\n\r\n\t\t\t{!editing &&\r\n\r\n\t\t\t\t<td colSpan=\"6\"><span>{deltaString ? <strong>{displayName}</strong> : <em>{displayName}</em>}</span></td>}\r\n\r\n\r\n\t\t\t{editing &&\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclassName=\"full-width\"\r\n\t\t\t\t\t\tplaceholder=\"Delta String\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tvalue={deltaString}\r\n\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\tactions.doToBranches(setActionPropertyAt(branchIndex, splitIndex, index, \"deltaString\", e.target.value), \"Delta string changed.\", branchIndex, splitIndex);\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t</td>\r\n\r\n\t\t\t}\r\n\t\t\t{editing && <td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" disabled={index === 0} title=\"Move up\" onClick={() => {\r\n\t\t\t\t\t//actions.doToBranches(swapBranches(index, index - 1), \"Branch moved.\", index - 1);\r\n\t\t\t\t}} >&uarr;</button>\r\n\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={isLast} onClick={() => {\r\n\t\t\t\t\t\t//actions.doToBranches(swapBranches(index, index + 1), \"Branch moved.\", index);\r\n\t\t\t\t\t}} >&darr;</button>\r\n\t\t\t\t</td>}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\r\n\r\n\t\t\t\t\t}} disabled>X</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t\t{editing &&\r\n\t\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t\t<button className=\"icon-button\" title=\"New Branch Below\" onClick={() => {\r\n\r\n\t\t\t\t\t}} disabled>*</button>\r\n\t\t\t\t</td>\r\n\t\t\t}\r\n\t\t</tr>\r\n\t);\r\n\r\n\tconst deltaNode = <DeltaItem key={\"action_\" + index + \"_delta\"} deltaError={deltaError} deltas={deltas} />;\r\n\r\n\tif (!expanded || !deltaString) return actionNode;\r\n\treturn [actionNode, deltaNode];\r\n}","import ActionItem from \"./ActionItem\";\r\n\r\nimport { createActionAt } from './util/data';\r\n\r\nexport default function ActionList({ actionList, editing, actions, branchIndex, splitIndex, resourceError }) {\r\n\treturn (\r\n\t\t<table>\r\n\t\t\t<tbody>\r\n\t\t\t\t{actionList.map((action, i) => {\r\n\t\t\t\t\tlet deltaError = undefined;\r\n\t\t\t\t\tif (actions.deltaError) {\r\n\t\t\t\t\t\tdeltaError = actions.deltaError;\r\n\t\t\t\t\t} else if (resourceError && resourceError.branch === branchIndex && resourceError.split === splitIndex && resourceError.action === i) {\r\n\t\t\t\t\t\tdeltaError = resourceError.message;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn <ActionItem\r\n\t\t\t\t\t\tname={action.name}\r\n\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\tindex={i}\r\n\t\t\t\t\t\tbranchIndex={branchIndex}\r\n\t\t\t\t\t\tsplitIndex={splitIndex}\r\n\t\t\t\t\t\texpanded={action.expanded}\r\n\t\t\t\t\t\tediting={editing}\r\n\t\t\t\t\t\tactions={actions}\r\n\t\t\t\t\t\tisLast={i === actionList.length - 1}\r\n\t\t\t\t\t\tdeltaString={action.deltaString}\r\n\t\t\t\t\t\tdeltaError={deltaError}\r\n\t\t\t\t\t\tdeltas={action.deltas}\r\n\t\t\t\t\t/>\r\n\t\t\t\t})}\r\n\t\t\t\t<tr key=\"new_action_button\">\r\n\t\t\t\t\t<td colSpan=\"3\">\r\n\t\t\t\t\t\t<button onClick={() => {\r\n\t\t\t\t\t\t\tactions.doToBranches(createActionAt(branchIndex, splitIndex, actionList.length), \"Action created.\", branchIndex, splitIndex);\r\n\t\t\t\t\t\t}}>Add Action/Notes</button>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\r\n\t\t\t</tbody>\r\n\r\n\t\t</table>\r\n\t)\r\n}","\r\nimport Box from './components/Box';\r\nimport ActionList from \"./components/ActionList\";\r\nimport { useState } from \"react\";\r\nimport ExpandButton from \"./components/ExpandButton\";\r\n\r\nexport default function Actions({ layout, resourcesCollapsed, actionList, actions, splitName, splitIndex, branchIndex }) {\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst buttonSection = (\r\n\t\t<span>\r\n\t\t\t<button className=\"space-left-small\" onClick={() => setEditing(!editing)}>{editing ? \"Finish\" : \"Edit\"}</button>\r\n\t\t\t<button className=\"space-left-small\" disabled>Previous</button>\r\n\t\t\t<button className=\"space-left-small\" disabled>Next</button>\r\n\t\t</span>\r\n\t);\r\n\tconst actionSection = actionList ? (\r\n\t\t<ActionList\r\n\t\t\tactionList={actionList}\r\n\t\t\tediting={editing}\r\n\t\t\tactions={actions}\r\n\t\t\tsplitIndex={splitIndex}\r\n\t\t\tbranchIndex={branchIndex} />\r\n\t) : (\r\n\t\t\t\"Click on a split to view details.\"\r\n\t\t);\r\n\treturn (\r\n\t\t<div >\r\n\t\t\t<Box layout={layout.main} borderClass=\"overflow-auto\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{!resourcesCollapsed && actionSection}\r\n\t\t\t\t</div>\r\n\t\t\t</Box>\r\n\t\t\t<Box layout={layout.header} >\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<ExpandButton\r\n\t\t\t\t\t\texpanded={!resourcesCollapsed} setExpanded={(expanded) => actions.setResourcesCollapsed(!expanded)} />\r\n\t\t\t\t\t<strong> Split Detail {actionList && (\" - \" + splitName)}</strong>\r\n\t\t\t\t\t{!resourcesCollapsed && buttonSection}\r\n\t\t\t\t\t{!resourcesCollapsed && <hr />}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</Box>\r\n\r\n\r\n\r\n\t\t</div>\r\n\t)\r\n}","import Box from \"./components/Box\";\r\n\r\nimport { calc } from \"./components/util/layout\";\r\nexport default function Alert({ enabled, text, okText, cancelText, onOk, onCancel }) {\r\n\tif (!enabled) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst width = \"50%\";\r\n\tconst height = \"12rem\";\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<div\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tbackgroundColor: \"rgba(0,0,0,0.6)\",\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\twidth: \"100vw\",\r\n\t\t\t\t\theight: \"100vh\"\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t\t<Box layout={{\r\n\t\t\t\tx: calc(calc(\"100vw\", \"-\", width), \"/\", 2),\r\n\t\t\t\ty: calc(calc(\"100vh\", \"-\", height), \"/\", 2),\r\n\t\t\t\tw: width,\r\n\t\t\t\th: height,\r\n\t\t\t}}>\r\n\t\t\t\t<div style={{ backgroundColor: \"white\", height: \"100%\", boxSizing: \"border-box\", padding: \"1rem\" }}>\r\n\t\t\t\t\t{text}\r\n\t\t\t\t\t<div style={{\r\n\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\tbottom: \"1rem\",\r\n\t\t\t\t\t\tright: \"1rem\"\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button onClick={() => onOk()}>{okText}</button>\r\n\t\t\t\t\t\t{onCancel !== undefined && <button className=\"margin-small\" onClick={() => onCancel()}>{cancelText}</button>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Box>\r\n\t\t</div>\r\n\t)\r\n}","export function shouldMakeTextWhiteForBackground(color) {\r\n\t//https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\r\n\r\n\tconst [r, g, b] = htmlColorToRGB(color).map(linerize);\r\n\tconst L = 0.2126 * r + 0.7152 * g + 0.0722 * b;\r\n\treturn L < 0.22;\r\n}\r\n\r\nfunction linerize(c) {\r\n\tc = c / 255.0;\r\n\tif (c <= 0.03928) {\r\n\t\tc = c / 12.92;\r\n\t} else {\r\n\t\tc = ((c + 0.055) / 1.055) ^ 2.4;\r\n\t}\r\n\treturn c;\r\n}\r\n\r\nfunction htmlColorToRGB(htmlColor) {\r\n\thtmlColor = htmlColor.toLowerCase();\r\n\tif (htmlColor.startsWith(\"rgb(\") && htmlColor.endsWith(\")\")) {\r\n\t\tconst htmlrgb = htmlColor.replace(\"rgb(\", \"\").replace(\")\", \"\").split(\",\").map(i => Number(i.trim())).map(i => Number.isNaN(i) ? 0 : i);\r\n\t\treturn htmlrgb;\r\n\t}\r\n\t//https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\r\n\tif (!window.getComputedStyle) return [255, 255, 255];\r\n\tconst div = document.getElementById(\"temp\");\r\n\tdiv.style.color = htmlColor;\r\n\tconst color = window.getComputedStyle(div).color;\r\n\r\n\tconst rgb = color.replace(\"rgb(\", \"\").replace(\")\", \"\").split(\",\").map(i => Number(i.trim()));\r\n\tif (rgb[0] === 0 && rgb[1] === 0 && rgb[2] === 0) {\r\n\t\tif (htmlColor !== \"black\") {\r\n\t\t\treturn [255, 255, 255];\r\n\t\t}\r\n\t}\r\n\treturn rgb;\r\n\r\n\r\n}","import { createItem, setItemPropertyAt } from './util/data';\r\nimport { shouldMakeTextWhiteForBackground } from \"./util/color\";\r\n\r\nfunction ItemDisplay({ name, color, delta }) {\r\n\tconst displayName = name || \"[Unnamed Item]\";\r\n\treturn <td style={{ backgroundColor: color, color: shouldMakeTextWhiteForBackground(color) ? \"white\" : \"\" }}>\r\n\t\t<span className=\"item-span\" >{displayName}</span>\r\n\t\t<span className=\"item-span\" >{(delta && deltaString(delta, name)) || \"\"}</span>\r\n\t</td>;\r\n}\r\n\r\nfunction ItemEdit({ name, color, index, isLast, actions, setEditing }) {\r\n\r\n\treturn (\r\n\t\t<tr key={\"item_\" + index}>\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t{index + 1}.\r\n\t\t\t</td>\r\n\t\t\t<td>\r\n\r\n\t\t\t\t<input\r\n\t\t\t\t\tclassName=\"full-width\"\r\n\t\t\t\t\tplaceholder=\"Item Name\"\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={name}\r\n\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\tactions.doToItems(setItemPropertyAt(index, \"name\", e.target.value))\r\n\t\t\t\t\t}} />\r\n\r\n\t\t\t</td>\r\n\t\t\t<td>\r\n\t\t\t\t<input\r\n\t\t\t\t\tclassName=\"full-width\"\r\n\t\t\t\t\tplaceholder=\"Color (e.g, red, #FF0000, rgb(255, 0, 0)\"\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={color}\r\n\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\tactions.doToItems(setItemPropertyAt(index, \"color\", e.target.value))\r\n\t\t\t\t\t}} />\r\n\t\t\t</td>\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" disabled={/*index === 0*/true} title=\"Move up\" onClick={() => {\r\n\t\t\t\t\t//actions.doToBranches(swapBranches(index, index - 1), \"Branch moved.\", index - 1);\r\n\t\t\t\t}}>&uarr;</button>\r\n\t\t\t</td>\r\n\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" title=\"Move down\" disabled={/*isLast*/true} onClick={() => {\r\n\t\t\t\t\t//actions.doToBranches(swapBranches(index, index + 1), \"Branch moved.\", index);\r\n\t\t\t\t}}>&darr;</button>\r\n\t\t\t</td>\r\n\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" title=\"Delete\" onClick={() => {\r\n\t\t\t\t\tactions.displayAlert(`Delete branch \"${name}\"? This will also delete all the splits in the branch. (Not reversible)`, \"Delete\", () => {\r\n\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t\t//actions.doToBranches(deleteBranchAt(index), \"Branch deleted.\", index);\r\n\t\t\t\t\t}, \"Cancel\", () => {\r\n\t\t\t\t\t\tactions.hideAlert();\r\n\t\t\t\t\t});\r\n\t\t\t\t}} disabled>X</button>\r\n\t\t\t</td>\r\n\r\n\r\n\t\t\t<td className=\"icon-button-width\">\r\n\t\t\t\t<button className=\"icon-button\" title=\"New Branch Below\" onClick={() => {\r\n\t\t\t\t\tactions.doToItems(createItem(index + 1), \"Item created.\");\r\n\t\t\t\t\tsetEditing(true);\r\n\t\t\t\t}} disabled>*</button>\r\n\t\t\t</td>\r\n\r\n\t\t</tr>\r\n\t);\r\n}\r\n\r\nfunction deltaString(delta, name) {\r\n\tconst { value, change } = delta[name];\r\n\treturn `${value} (${change >= 0 ? \"+\" : \"\"}${change})`\r\n}\r\n\r\nexport default function ItemList({ items, delta, editing, actions, setEditing, filter }) {\r\n\tconst filterObj = [];\r\n\tif (filter) {\r\n\t\tfilter.split(\",\").forEach(f => {\r\n\t\t\tconst name = f.trim();\r\n\t\t\tfilterObj.push(name);\r\n\t\t})\r\n\t}\r\n\r\n\tconst filteredItems = !filter ? items : items.filter(item => {\r\n\t\tif (!item.name) return true;\r\n\t\tfor (let i = 0; i < filterObj.length; i++) {\r\n\t\t\tif (item.name.includes(filterObj[i])) return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t});\r\n\tlet itemSection;\r\n\r\n\tif (editing) {\r\n\t\titemSection = filteredItems.map((item, i) => {\r\n\t\t\treturn <ItemEdit\r\n\t\t\t\tname={item.name}\r\n\t\t\t\tcolor={item.color}\r\n\t\t\t\tkey={i}\r\n\t\t\t\tindex={i}\r\n\t\t\t\tactions={actions}\r\n\t\t\t\tsetEditing={setEditing}\r\n\t\t\t\tisLast={i === items.length - 1}\r\n\t\t\t/>\r\n\t\t})\r\n\t} else {\r\n\t\titemSection = [];\r\n\t\tfor (let i = 0; i < filteredItems.length; i += 4) {\r\n\r\n\t\t\titemSection.push(\r\n\t\t\t\t<tr key={i}>\r\n\t\t\t\t\t{<ItemDisplay name={filteredItems[i].name} color={filteredItems[i].color} delta={delta} />}\r\n\t\t\t\t\t{filteredItems[i + 1] && <ItemDisplay name={filteredItems[i + 1].name} color={filteredItems[i + 1].color} delta={delta} />}\r\n\t\t\t\t\t{filteredItems[i + 2] && <ItemDisplay name={filteredItems[i + 2].name} color={filteredItems[i + 2].color} delta={delta} />}\r\n\t\t\t\t\t{filteredItems[i + 3] && <ItemDisplay name={filteredItems[i + 3].name} color={filteredItems[i + 3].color} delta={delta} />}\r\n\t\t\t\t</tr>\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\treturn (\r\n\t\t<table>\r\n\t\t\t<tbody>\r\n\t\t\t\t{itemSection}\r\n\t\t\t</tbody>\r\n\t\t\t<tr key=\"new_item_button\">\r\n\t\t\t\t<td colSpan=\"5\">\r\n\t\t\t\t\t<button onClick={() => {\r\n\t\t\t\t\t\tconst len = items.length;\r\n\t\t\t\t\t\tactions.doToItems(createItem(len), \"Item created.\");\r\n\t\t\t\t\t\tsetEditing(true);\r\n\t\t\t\t\t}}>New Item</button>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t);\r\n}","import ItemList from './components/ItemList';\r\nimport Box from './components/Box';\r\nimport { useState } from \"react\";\r\nimport ExpandButton from './components/ExpandButton';\r\n\r\nexport default function Items({ layout, resourcesCollapsed, resourceInfo, items, actions, actionResources, lastActionResources }) {\r\n\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [filter, setFilter] = useState(\"\");\r\n\r\n\tconst collapsed = resourcesCollapsed;\r\n\tconst buttonSection = (\r\n\t\t<span>\r\n\t\t\t<button className=\"space-left-small\" onClick={() => setEditing(!editing)}>{editing ? \"Finish\" : \"Edit\"}</button>\r\n\t\t\t<input\r\n\t\t\t\tclassName=\"space-left-small\"\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tvalue={filter}\r\n\t\t\t\tplaceholder=\"Filter (use , to separate)\"\r\n\t\t\t\tonChange={(e) => setFilter(e.target.value)}\r\n\t\t\t/>\r\n\t\t\t<button className=\"space-left-small icon-button\" title=\"Clear\" onClick={() => setFilter(\"\")}>X</button>\r\n\t\t</span>\r\n\t);\r\n\r\n\tlet delta = undefined;\r\n\tif (actionResources && lastActionResources) {\r\n\t\tdelta = {};\r\n\t\tfor (const key in actionResources) {\r\n\t\t\tdelta[key] = {\r\n\t\t\t\tvalue: actionResources[key],\r\n\t\t\t\tchange: actionResources[key] - ((key in lastActionResources) ? lastActionResources[key] : 0)\r\n\t\t\t}\r\n\t\t}\r\n\t\titems = items.filter(item => {\r\n\t\t\treturn item.name in actionResources;\r\n\t\t})\r\n\t}\r\n\r\n\tconst itemSection =\r\n\t\t<ItemList\r\n\t\t\titems={items}\r\n\t\t\tediting={editing}\r\n\t\t\tactions={actions}\r\n\t\t\tsetEditing={setEditing}\r\n\t\t\tfilter={filter}\r\n\t\t\tdelta={delta}\r\n\t\t/>\r\n\t\t;\r\n\treturn (\r\n\t\t<div >\r\n\t\t\t<Box layout={layout.main} borderClass=\"overflow-auto\">\r\n\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{!collapsed && itemSection}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</Box>\r\n\t\t\t<Box layout={layout.header} >\r\n\t\t\t\t<div>\r\n\r\n\t\t\t\t\t<strong>Resources</strong>\r\n\t\t\t\t\t{!collapsed && buttonSection}\r\n\r\n\t\t\t\t</div>\r\n\t\t\t\t{!collapsed &&\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\tresourceInfo\r\n\t\t\t\t\t</div>}\r\n\t\t\t\t{!resourcesCollapsed && <hr />}\r\n\t\t\t</Box>\r\n\r\n\r\n\r\n\t\t</div>\r\n\t)\r\n}","import React from 'react';\nimport './App.css';\nimport SideNav from './sections/SideNav';\nimport Header from './sections/Header';\nimport layout from './sections/components/util/layout';\nimport Footer from './sections/Footer';\nimport Box from './sections/components/Box';\nimport Actions from './sections/Actions';\nimport { readFromLocalStorage, saveToLocalStorage, downloadToFile, sanitizeSplit } from './sections/components/util/storage';\nimport Alert from './sections/Alert';\nimport { benchmarkTime, benchmarkDelta } from './sections/components/util/benchmark';\nimport { tryClearResourceErrorFrom, calculateResourcesAt, getPreviousActionIndices } from './sections/components/util/data';\nimport Items from './sections/Items';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      info: \"Loading...\",\n      projectName: \"Untitled Project\",\n\n      sideCollapsed: false,\n      resourcesCollapsed: false,\n      headerCollapsed: false,\n      dimensions: undefined,\n\n      branches: [],\n      items: [],\n      resources: {\n        content: [],\n        error: undefined,\n      },\n\n      activeBranch: -1,\n      activeSplit: -1,\n      activeAction: -1,\n      dirtyBranch: -1,\n      dirtySplit: -1,\n      dirtyAction: 0,\n\n      autoSave: true,\n      autoSaveHandle: undefined,\n\n      displayAlert: false,\n      onAlertOk: undefined,\n      onAlertCancel: undefined,\n      alertOkText: undefined,\n      alertCancelText: undefined,\n      alertText: undefined,\n\n      resourceUpdateHandle: undefined,\n      splitClipboard: undefined,\n    }\n  }\n\n\n\n  recalculateResources(branch, split) {\n    if (this.state.resourceUpdateHandle) {\n      if (branch > this.state.branches.length) return;\n      if (branch > this.state.dirtyBranch) return;\n      if (branch === this.state.dirtyBranch && split > this.state.dirtySplit) return;\n    }\n\n    if (this.state.resourceUpdateHandle) {\n      window.clearTimeout(this.state.resourceUpdateHandle);\n    }\n    this.setState({\n      dirtyBranch: branch,\n      dirtySplit: split,\n      dirtyAction: 0,\n      resourceUpdateHandle: undefined,\n      ...tryClearResourceErrorFrom(this.state.resources, branch, split),\n    }, () => {\n      const handle = window.setTimeout(() => {\n        this.doCalcResources();\n      }, 100);\n      this.setState({\n        resourceUpdateHandle: handle,\n        info: \"Updating Resources\",\n      })\n    });\n\n  }\n\n  doCalcResources() {\n    let b = this.state.dirtyBranch;\n    let s = this.state.dirtySplit;\n    let a = this.state.dirtyAction;\n    console.log(`calc resource, b=${b}, s=${s}, a=${a}`);\n    if (b >= this.state.branches.length) {\n      this.finishResourceUpdate();\n      return;\n    }\n    while (s >= this.state.branches[b].splits.length) {\n      b++;\n      if (b >= this.state.branches.length) {\n        this.finishResourceUpdate();\n        return;\n      }\n      s = 0;\n    }\n    while (a >= this.state.branches[b].splits[s].actions.length) {\n      s++;\n      while (s >= this.state.branches[b].splits.length) {\n        b++;\n        if (b >= this.state.branches.length) {\n          this.finishResourceUpdate();\n          return;\n        }\n        s = 0;\n      }\n      a = 0;\n    }\n\n    const newResources = calculateResourcesAt(this.state.resources, this.state.branches, this.state.items, b, s, a);\n    this.setState({\n      dirtyBranch: b,\n      dirtySplit: s,\n      dirtyAction: a + 1,\n      ...newResources,\n    }, () => {\n      const handle = window.setTimeout(() => {\n        this.doCalcResources();\n      }, 100);\n      this.setState({\n        resourceUpdateHandle: handle,\n        info: `Resources updated for \"${this.state.branches[b].name}\" Branch, \"${this.state.branches[b].splits[s].name}\" Split: ${this.state.branches[b].splits[s].actions[a].name}`,\n      });\n    })\n  }\n\n  finishResourceUpdate() {\n    if (this.state.resourceUpdateHandle) {\n      window.clearTimeout(this.state.resourceUpdateHandle);\n    }\n    this.setState({\n      resourceUpdateHandle: undefined,\n      info: `Resources update finished.`,\n    })\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.calculateDimensions.bind(this));\n    this.calculateDimensions();\n    this.loadStoredState(readFromLocalStorage);\n    this.setAutoSave(true);\n\n  }\n\n  setAutoSave(autoSave) {\n    if (!autoSave) {\n      if (this.state.autoSaveHandle) {\n        const handle = this.state.autoSaveHandle;\n        this.setState({\n          autoSaveHandle: undefined,\n          autoSave: false\n        }, () => {\n          window.clearInterval(handle)\n        })\n      } else {\n        this.setState({\n          autoSave: false\n        });\n      }\n      this.setInformation(\"Auto save is now off.\");\n    } else {\n      if (this.state.autoSaveHandle) {\n        const handle = this.state.autoSaveHandle;\n        this.setState({\n          autoSaveHandle: window.setInterval(() => {\n            this.saveStateToLocalStorage();\n          }, 20000),\n          autoSave: true\n        }, () => {\n          window.clearInterval(handle)\n        })\n      } else {\n        this.setState({\n          autoSaveHandle: window.setInterval(() => {\n            this.saveStateToLocalStorage();\n          }, 20000),\n          autoSave: true\n        })\n      };\n      this.saveStateToLocalStorage();\n    }\n  }\n\n\n  loadStoredState(storedStateLoadFunction, start) {\n    const startTime = start || benchmarkTime();\n    const storedState = storedStateLoadFunction();\n    if (storedState) {\n      this.setState({\n        branches: storedState.branches,\n        activeBranch: storedState.activeBranch,\n        activeSplit: storedState.activeSplit,\n        projectName: storedState.projectName,\n        items: storedState.items,\n      }, () => {\n        this.setInformation(`Data loaded in ${benchmarkDelta(startTime)} ms`);\n        this.recalculateResources(0, 0);\n      })\n    }\n  }\n\n  saveStateToLocalStorage() {\n    const startTime = benchmarkTime();\n    saveToLocalStorage(this.getStateToStore());\n    this.setInformation(`Saved to local storage in ${benchmarkDelta(startTime)} ms. Last saved at ${new Date()}`);\n  }\n\n  getStateToStore() {\n    return {\n      branches: this.state.branches,\n      activeBranch: this.state.activeBranch,\n      activeSplit: this.state.activeSplit,\n      activeAction: this.state.activeAction,\n      projectName: this.state.projectName,\n      itmes: this.state.items,\n    }\n  }\n\n  calculateDimensions() {\n    const dimensions = layout(this.state.sideCollapsed, this.state.resourcesCollapsed, this.state.headerCollapsed);\n    this.setState({ dimensions });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.calculateDimensions.bind(this));\n    if (this.state.autoSaveHandle) {\n      window.clearInterval(this.state.autoSaveHandle);\n    }\n    if (this.state.resourceUpdateHandle) {\n      window.clearTimeout(this.state.resourceUpdateHandle);\n    }\n  }\n\n  setSideCollapsed(sideCollapsed) {\n    this.setState({\n      sideCollapsed: sideCollapsed,\n      dimensions: layout(sideCollapsed, this.state.resourcesCollapsed, this.state.headerCollapsed),\n    });\n  }\n\n  setResourcesCollapsed(resourcesCollapsed) {\n    this.setState({\n      resourcesCollapsed: resourcesCollapsed,\n      dimensions: layout(this.state.sideCollapsed, resourcesCollapsed, this.state.headerCollapsed),\n    });\n  }\n\n  setHeaderCollapsed(headerCollapsed) {\n    this.setState({\n      headerCollapsed: headerCollapsed,\n      dimensions: layout(this.state.sideCollapsed, this.state.resourcesCollapsed, headerCollapsed),\n    });\n  }\n\n  setInformation(info) {\n    this.setState({ info });\n  }\n\n  setProjectName(name) {\n    this.setState({\n      projectName: name\n    })\n  }\n\n  doToBranches(transitionFunction, info, dirtyBranch, dirtySplit) {\n    const startTime = benchmarkTime();\n    this.setState({\n      ...transitionFunction({\n        branches: this.state.branches,\n        activeBranch: this.state.activeBranch,\n        activeAction: this.state.activeAction,\n        activeSplit: this.state.activeSplit,\n      })\n    }, () => {\n      if (info) {\n        this.setInformation(`${info} (${benchmarkDelta(startTime)}ms)`);\n      }\n      if (dirtyBranch !== undefined) {\n        this.recalculateResources(dirtyBranch, dirtySplit || 0);\n      }\n    })\n  }\n\n  doToItems(transitionFunction, info, doRecalculate) {\n    const startTime = benchmarkTime();\n    this.setState({\n      ...transitionFunction({\n        branches: this.state.branches,\n        items: this.state.items,\n      })\n    }, () => {\n      if (info) {\n        this.setInformation(`${info} (${benchmarkDelta(startTime)}ms)`);\n      }\n      if (doRecalculate) {\n        this.recalculateResources(0, 0);\n      }\n    })\n  }\n\n  displayAlert(text, okText, onOk, cancelText, onCancel) {\n    this.setState({\n      displayAlert: true,\n      onAlertOk: onOk,\n      onAlertCancel: onCancel,\n      alertOkText: okText,\n      alertCancelText: cancelText,\n      alertText: text,\n    });\n  }\n\n  hideAlert() {\n    this.setState({\n      displayAlert: false,\n      onAlertOk: undefined,\n      onAlertCancel: undefined,\n      alertOkText: undefined,\n      alertCancelText: undefined\n    })\n  }\n\n  downloadStateToFile() {\n    downloadToFile(this.getStateToStore());\n  }\n\n  openSplit(b, s) {\n    const startTime = benchmarkTime();\n    this.setState({\n      activeBranch: b,\n      activeSplit: s,\n      activeAction: -1,\n    }, () => {\n      this.setInformation(`Split detail opened. (${benchmarkDelta(startTime)}ms)`);\n    })\n  }\n\n  openAction(a) {\n    if (this.state.activeBranch >= 0 && this.state.activeSplit >= 0) {\n      const startTime = benchmarkTime();\n      this.setState({\n        activeAction: a,\n      }, () => {\n        this.setInformation(`Action resources opened. (${benchmarkDelta(startTime)}ms)`);\n      })\n    }\n\n  }\n  render() {\n    if (!this.state.dimensions) {\n      return null;\n    }\n\n    const actions = {\n      setSideCollapsed: this.setSideCollapsed.bind(this),\n      setResourcesCollapsed: this.setResourcesCollapsed.bind(this),\n      setHeaderCollapsed: this.setHeaderCollapsed.bind(this),\n      setInformation: this.setInformation.bind(this),\n      setAutoSave: this.setAutoSave.bind(this),\n      displayAlert: this.displayAlert.bind(this),\n      hideAlert: this.hideAlert.bind(this),\n      saveStateToLocalStorage: this.saveStateToLocalStorage.bind(this),\n      download: this.downloadStateToFile.bind(this),\n      setProjectName: this.setProjectName.bind(this),\n      loadStoredState: this.loadStoredState.bind(this),\n      recalculateResources: this.recalculateResources.bind(this),\n      doToBranches: this.doToBranches.bind(this),\n      copySplit: (split) => this.setState({ splitClipboard: sanitizeSplit(split), info: \"Split copied.\" }),\n      splitClipboard: this.state.splitClipboard,\n      openSplit: this.openSplit.bind(this),\n      doToItems: this.doToItems.bind(this),\n    }\n\n    const showAction = this.state.activeBranch >= 0 &&\n      this.state.activeBranch < this.state.branches.length &&\n      this.state.activeSplit >= 0 &&\n      this.state.activeSplit < this.state.branches[this.state.activeSplit].splits.length;\n\n    let actionResources, lastActionResources;\n    if (showAction) {\n      const rec = this.state.resources.content;\n      if (rec) {\n        const branchRec = this.state.resources.content[this.state.activeBranch];\n        if (branchRec) {\n          const splitRec = this.state.resources.content[this.state.activeBranch][this.state.activeSplit];\n          if (splitRec) {\n            actionResources = this.state.resources.content[this.state.activeBranch][this.state.activeSplit][this.state.activeAction];\n            const [prevB, prevS, prevA, hasPrev] = getPreviousActionIndices(this.state.branches, this.state.activeBranch, this.state.activeSplit, this.state.activeAction);\n            lastActionResources = {};\n            if (hasPrev) {\n              const prevBranchRec = this.state.resources.content[prevB];\n              if (prevBranchRec) {\n                const prevSplitRec = this.state.resources.content[prevB][prevS];\n                if (prevSplitRec) {\n                  lastActionResources = this.state.resources.content[prevB][prevS][prevA];\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    return (\n\n      <div style={{\n        width: \"100vw\",\n        height: \"100vh\"\n      }}>\n        <Box layout={this.state.dimensions.header} borderClass=\"border overflow-hidden\">\n          <Header\n            autoSave={this.state.autoSave}\n            sideCollapsed={this.state.sideCollapsed}\n            headerCollapsed={this.state.headerCollapsed}\n            projectName={this.state.projectName}\n            actions={actions} />\n        </Box>\n        <Box layout={this.state.dimensions.side} borderClass=\"border\">\n          <SideNav layout={this.state.dimensions.side} sideCollapsed={this.state.sideCollapsed} actions={actions} branches={this.state.branches} />\n        </Box>\n        <Box layout={this.state.dimensions.footer} borderClass=\"border\">\n          <Footer text={this.state.info} />\n        </Box>\n        <Box layout={this.state.dimensions.map}>\n          <iframe src=\"https://objmap.zeldamods.org/#/map/z3,0,4\" title=\"Object Map\" width=\"100%\" height=\"100%\"></iframe>\n        </Box>\n        <Box layout={this.state.dimensions.actions} borderClass=\"border\">\n          <Actions\n            layout={this.state.dimensions.actions}\n            resourcesCollapsed={this.state.resourcesCollapsed}\n            actions={actions}\n            actionList={showAction && this.state.branches[this.state.activeBranch].splits[this.state.activeSplit].actions}\n            splitName={showAction && this.state.branches[this.state.activeBranch].splits[this.state.activeSplit].name}\n            splitIndex={this.state.activeSplit}\n            branchIndex={this.state.activeBranch} />\n        </Box>\n        {!this.state.dimensions.resources.hide &&\n          <Box layout={this.state.dimensions.resources} borderClass=\"border\">\n            <Items\n              layout={this.state.dimensions.resources}\n              actions={actions}\n              resourcesCollapsed={this.state.resourcesCollapsed}\n              sideCollapsed={this.state.sideCollapsed}\n              items={this.state.items}\n              actionResources={actionResources}\n              lastActionResources={lastActionResources}\n            />\n          </Box>}\n\n        <Alert\n          enabled={this.state.displayAlert}\n          text={this.state.alertText}\n          okText={this.state.alertOkText}\n          cancelText={this.state.alertCancelText}\n          onOk={this.state.onAlertOk}\n          onCancel={this.state.onAlertCancel}\n        />\n\n      </div>\n    );\n  }\n\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}